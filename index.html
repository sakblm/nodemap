<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>testApp - èˆˆå‘³ãƒãƒƒãƒ”ãƒ³ã‚°ã‚¢ãƒ—ãƒª</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link rel="stylesheet" href="./css/styles.css">
</head>
<body class="bg-gray-50">
    <div id="root"></div>
    <canvas id="particle-canvas" class="particle-canvas"></canvas>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // ãƒ‡ãƒ¼ã‚¿ã‚’å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰èª­ã¿è¾¼ã¿
        let inlineData = {
            articles: [],
            hierarchical_tags: {}
        };

        // ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿é–¢æ•°
        const loadData = async () => {
            try {
                console.log('ğŸ”„ ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿é–‹å§‹...');
                
                const [articlesResponse, tagsResponse] = await Promise.all([
                    fetch('./data/articles.json'),
                    fetch('./data/hierarchical_tags.json')
                ]);
                
                if (!articlesResponse.ok) {
                    throw new Error(`Articles fetch failed: ${articlesResponse.status}`);
                }
                if (!tagsResponse.ok) {
                    throw new Error(`Tags fetch failed: ${tagsResponse.status}`);
                }
                
                const articles = await articlesResponse.json();
                const hierarchical_tags = await tagsResponse.json();
                
                inlineData = { articles, hierarchical_tags };
                console.log('âœ… å¤–éƒ¨ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰èª­ã¿è¾¼ã¿å®Œäº†');
                console.log(`ğŸ“° è¨˜äº‹æ•°: ${articles.length}`);
                console.log(`ğŸ·ï¸ ã‚¿ã‚°æ•°: ${Object.keys(hierarchical_tags).length}`);
                return true;
            } catch (error) {
                console.error('âŒ ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                console.warn('ğŸ”„ ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨');
                
                // å®Œå…¨ãªãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ï¼ˆå…ƒã®inlineDataã¨åŒã˜ï¼‰
                inlineData = {
                    articles: [
                        {
                            "title": "AIãŒç”Ÿæˆã™ã‚‹æ–°ã—ã„éŸ³æ¥½ã®å¯èƒ½æ€§",
                            "tags": ["AI", "éŸ³æ¥½", "æŠ€è¡“"],
                            "source": "Tech Journal",
                            "snippet": "äººå·¥çŸ¥èƒ½ã®é€²åŒ–ã«ã‚ˆã‚Šã€ä½œæ›²ã‚„æ¼”å¥ã®åˆ†é‡ã§æ–°ãŸãªå¯èƒ½æ€§ãŒåºƒãŒã£ã¦ã„ã¾ã™ã€‚"
                        },
                        {
                            "title": "é›»æ°—è‡ªå‹•è»Šã€ãƒãƒƒãƒ†ãƒªãƒ¼æŠ€è¡“ã®æ¬¡ä¸–ä»£ãƒˆãƒ¬ãƒ³ãƒ‰",
                            "tags": ["é›»æ°—è‡ªå‹•è»Š", "æŠ€è¡“", "ã‚¨ãƒãƒ«ã‚®ãƒ¼", "SDGs"],
                            "source": "Future Daily",
                            "snippet": "å…¨å›ºä½“é›»æ± ã‚„æ–°ã—ã„å……é›»æŠ€è¡“ãªã©ã€é›»æ°—è‡ªå‹•è»Šã®èˆªç¶šè·é›¢ã¨ã‚³ã‚¹ãƒˆã‚’æ”¹å–„ã™ã‚‹ã‚¤ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ãŒæ³¨ç›®ã‚’é›†ã‚ã¦ã„ã¾ã™ã€‚"
                        },
                        {
                            "title": "å®‡å®™æ—…è¡Œã€ä¸€èˆ¬äººå‘ã‘ãƒ„ã‚¢ãƒ¼ã®æœ€æ–°å‹•å‘",
                            "tags": ["å®‡å®™", "æ—…è¡Œ", "ãƒ­ã‚±ãƒƒãƒˆ"],
                            "source": "Space Today",
                            "snippet": "å®‡å®™ã¸ã®æ—…è¡ŒãŒã€ä¸€éƒ¨ã®å¯Œè£•å±¤ã ã‘ã§ãªãã€ä¸€èˆ¬ã®äººã€…ã«ã‚‚æ‰‹ã®å±Šãæ™‚ä»£ã«ãªã‚Šã¤ã¤ã‚ã‚Šã¾ã™ã€‚"
                        },
                        {
                            "title": "ãƒ¡ã‚¿ãƒãƒ¼ã‚¹ã¨VRãŒå¤‰ãˆã‚‹ãƒ“ã‚¸ãƒã‚¹ã®æœªæ¥",
                            "tags": ["ãƒ¡ã‚¿ãƒãƒ¼ã‚¹", "VR", "ãƒ“ã‚¸ãƒã‚¹"],
                            "source": "Business Insights",
                            "snippet": "ä»®æƒ³ç©ºé–“ã§ã®ä¼šè­°ã‚„å•†å“å±•ç¤ºã€ã‚¤ãƒ™ãƒ³ãƒˆé–‹å‚¬ãªã©ã€ãƒ¡ã‚¿ãƒãƒ¼ã‚¹ãŒã‚‚ãŸã‚‰ã™æ–°ã—ã„ãƒ“ã‚¸ãƒã‚¹ãƒ¢ãƒ‡ãƒ«ãŒæ¬¡ã€…ã¨ç™»å ´ã—ã¦ã„ã¾ã™ã€‚"
                        },
                        {
                            "title": "ã‚µã‚¹ãƒ†ã‚£ãƒŠãƒ–ãƒ«ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³ï¼šå¾ªç’°å‹ç¤¾ä¼šã¸ã®æŒ‘æˆ¦",
                            "tags": ["SDGs", "ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³", "ã‚µã‚¹ãƒ†ã‚£ãƒŠãƒ–ãƒ«"],
                            "source": "Eco Life",
                            "snippet": "ç’°å¢ƒã«é…æ…®ã—ãŸç´ æé¸ã³ã‚„è£½é€ ãƒ—ãƒ­ã‚»ã‚¹ã€å¤ç€ã®ãƒªã‚µã‚¤ã‚¯ãƒ«ãªã©ã€ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³æ¥­ç•Œã§ã‚‚ã‚µã‚¹ãƒ†ã‚£ãƒŠãƒ“ãƒªãƒ†ã‚£ã¸ã®å–ã‚Šçµ„ã¿ãŒåŠ é€Ÿã—ã¦ã„ã¾ã™ã€‚"
                        },
                        {
                            "title": "çŠ¬ç¨®å›³é‘‘ï¼šæŸ´çŠ¬ã®é­…åŠ›",
                            "tags": ["å‹•ç‰©", "çŠ¬", "ãƒšãƒƒãƒˆ"],
                            "source": "Animal World",
                            "snippet": "æ—¥æœ¬ã®ä»£è¡¨çš„ãªçŠ¬ç¨®ã§ã‚ã‚‹æŸ´çŠ¬ã€‚ãã®æ­´å²ã‚„æ€§æ ¼ã€é£¼è‚²ã®ãƒã‚¤ãƒ³ãƒˆã‚’è§£èª¬ã—ã¾ã™ã€‚"
                        }
                    ],
                    hierarchical_tags: {
                        "AI": ["æ©Ÿæ¢°å­¦ç¿’", "è‡ªç„¶è¨€èªå‡¦ç†", "ç”»åƒèªè­˜"],
                        "æŠ€è¡“": ["åŠå°ä½“", "é‡å­ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼", "ã‚¯ãƒ©ã‚¦ãƒ‰"],
                        "SDGs": ["å¾ªç’°å‹çµŒæ¸ˆ", "å†ç”Ÿå¯èƒ½ã‚¨ãƒãƒ«ã‚®ãƒ¼", "ã‚µã‚¹ãƒ†ã‚£ãƒŠãƒ–ãƒ«"],
                        "éŸ³æ¥½": ["DTM", "æ¥½å™¨", "ãƒ©ã‚¤ãƒ–"],
                        "é›»æ°—è‡ªå‹•è»Š": ["ãƒãƒƒãƒ†ãƒªãƒ¼", "å……é›»æŠ€è¡“"],
                        "å®‡å®™": ["ISS", "ã‚¹ãƒšãƒ¼ã‚¹ã‚·ãƒ£ãƒˆãƒ«", "å¤©ä½“è¦³æ¸¬"],
                        "æ—…è¡Œ": ["ç§˜å¢ƒ", "ãƒ„ã‚¢ãƒ¼", "ä¸–ç•Œéºç”£", "å›½å†…æ—…è¡Œ"],
                        "ãƒ“ã‚¸ãƒã‚¹": ["ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—", "ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°", "çµŒå–¶æˆ¦ç•¥"],
                        "ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³": ["ã‚¢ãƒ‘ãƒ¬ãƒ«", "ãƒ‡ã‚¶ã‚¤ãƒ³", "ZOZO"],
                        "å‹•ç‰©": ["çŠ¬", "çŒ«", "é­š"],
                        "çŠ¬": ["çŠ¬ç¨®", "é£¼è‚²"],
                        "ãƒšãƒƒãƒˆ": ["é£¼è‚²", "ç”¨å“", "ç—…æ°—"]
                    }
                };
                return false;
            }
        };

        // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚·ã‚¹ãƒ†ãƒ 
        function ParticleSystem() {
            const canvasRef = useRef();
            const particles = useRef([]);
            const animationFrame = useRef();

            const startParticleEffect = (startX, startY, tags) => {
                const canvas = canvasRef.current;
                if (!canvas) return;

                const ctx = canvas.getContext('2d');
                particles.current = [];

                // ãƒ‰ãƒƒãƒˆãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã®ç”Ÿæˆ
                for (let i = 0; i < 30; i++) {
                    const angle = Math.random() * Math.PI * 2;
                    const speed = 2 + Math.random() * 4;
                    particles.current.push({
                        x: startX,
                        y: startY,
                        vx: Math.cos(angle) * speed,
                        vy: Math.sin(angle) * speed - 2,
                        size: 2 + Math.random() * 3,
                        color: `hsl(${Math.random() * 360}, 70%, 65%)`,
                        opacity: 1,
                        type: 'dot'
                    });
                }

                // ã‚¿ã‚°ãƒ†ã‚­ã‚¹ãƒˆãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã®ç”Ÿæˆ
                tags.forEach((tag, index) => {
                    const angle = (index / tags.length) * Math.PI * 2;
                    const speed = 1.5 + Math.random() * 2;
                    particles.current.push({
                        x: startX,
                        y: startY,
                        vx: Math.cos(angle) * speed,
                        vy: Math.sin(angle) * speed - 1,
                        size: 14,
                        color: '#ffffff',
                        opacity: 1,
                        type: 'text',
                        text: tag
                    });
                });

                animateParticles(ctx);
            };

            const animateParticles = (ctx) => {
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);

                particles.current = particles.current.filter(particle => {
                    particle.x += particle.vx;
                    particle.y += particle.vy;
                    particle.vy += 0.03;
                    particle.opacity -= 0.008;
                    particle.vx *= 0.99;

                    if (particle.type === 'dot') {
                        ctx.save();
                        ctx.globalAlpha = particle.opacity;
                        ctx.fillStyle = particle.color;
                        ctx.beginPath();
                        ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
                        ctx.fill();
                        ctx.restore();
                    } else if (particle.type === 'text') {
                        ctx.save();
                        ctx.globalAlpha = particle.opacity;
                        ctx.font = `600 ${particle.size}px Inter`;
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'middle';
                        
                        const textWidth = ctx.measureText(particle.text).width;
                        const padding = 8;
                        const rectX = particle.x - textWidth / 2 - padding;
                        const rectY = particle.y - particle.size / 2 - padding;
                        const rectWidth = textWidth + padding * 2;
                        const rectHeight = particle.size + padding * 2;
                        
                        ctx.fillStyle = `rgba(255, 255, 255, ${0.9 * particle.opacity})`;
                        ctx.roundRect = ctx.roundRect || function(x, y, w, h, r) {
                            ctx.beginPath();
                            ctx.moveTo(x + r, y);
                            ctx.lineTo(x + w - r, y);
                            ctx.arcTo(x + w, y, x + w, y + r, r);
                            ctx.lineTo(x + w, y + h - r);
                            ctx.arcTo(x + w, y + h, x + w - r, y + h, r);
                            ctx.lineTo(x + r, y + h);
                            ctx.arcTo(x, y + h, x, y + h - r, r);
                            ctx.lineTo(x, y + r);
                            ctx.arcTo(x, y, x + r, y, r);
                            ctx.closePath();
                        };
                        
                        ctx.roundRect(rectX, rectY, rectWidth, rectHeight, rectHeight / 2);
                        ctx.fill();
                        
                        ctx.fillStyle = `rgba(30, 41, 59, ${particle.opacity})`;
                        ctx.fillText(particle.text, particle.x, particle.y);
                        ctx.restore();
                    }

                    return particle.opacity > 0;
                });

                if (particles.current.length > 0) {
                    animationFrame.current = requestAnimationFrame(() => animateParticles(ctx));
                }
            };

            useEffect(() => {
                const canvas = canvasRef.current;
                if (!canvas) return;

                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;

                window.startParticleEffect = startParticleEffect;

                const handleResize = () => {
                    canvas.width = window.innerWidth;
                    canvas.height = window.innerHeight;
                };

                window.addEventListener('resize', handleResize);

                return () => {
                    window.removeEventListener('resize', handleResize);
                    if (animationFrame.current) {
                        cancelAnimationFrame(animationFrame.current);
                    }
                };
            }, []);

            return <canvas ref={canvasRef} className="particle-canvas" />;
        }

        function App() {
            const [currentView, setCurrentView] = useState('map');
            const [collectedTags, setCollectedTags] = useState(new Map());
            const [tagLinks, setTagLinks] = useState([]);
            const [isArticleAreaExpanded, setIsArticleAreaExpanded] = useState(false);
            const [selectedTags, setSelectedTags] = useState([]);
            const [mapArticleAreaHeight, setMapArticleAreaHeight] = useState(50); // ãƒãƒƒãƒ—ç”»é¢ã§ã®è¨˜äº‹ã‚¨ãƒªã‚¢é«˜ã•(%)
            const [isDragging, setIsDragging] = useState(false);
            const [dataLoaded, setDataLoaded] = useState(false);
            const [articles, setArticles] = useState([]);
            const [hierarchicalTags, setHierarchicalTags] = useState({});
            const [showBalanceInfo, setShowBalanceInfo] = useState(false);
            const [showCameraMenu, setShowCameraMenu] = useState(false);
            const [showVoiceMenu, setShowVoiceMenu] = useState(false);
            const [viewMode, setViewMode] = useState('grid');
            const [mapViewMode, setMapViewMode] = useState('list');
            const [favoritesViewMode, setFavoritesViewMode] = useState('grid'); // ãŠæ°—ã«å…¥ã‚Šé›†ç´„ç”»é¢å°‚ç”¨
            const [selectedArticle, setSelectedArticle] = useState(null);
            const [showArticleDetail, setShowArticleDetail] = useState(false);
            const [showFavorites, setShowFavorites] = useState(false);
            const [showAiHelp, setShowAiHelp] = useState(false);
            const [previousView, setPreviousView] = useState(null); // å‰ã®ç”»é¢ã‚’è¿½è·¡
            const [interestDepth, setInterestDepth] = useState(50); // èˆˆå‘³ã®æ·±ã•ï¼ˆ0-100ï¼‰
            //const [favoriteReports, setFavoriteReports] = useState([]); // ãŠæ°—ã«å…¥ã‚Šãƒ¬ãƒãƒ¼ãƒˆãƒªã‚¹ãƒˆ
            const [favoriteReports, setFavoriteReports] = useState(() => {
                // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰ãŠæ°—ã«å…¥ã‚Šã‚’èª­ã¿è¾¼ã¿
                try {
                    const saved = localStorage.getItem('favoriteReports');
                    return saved ? JSON.parse(saved) : [];
                } catch (error) {
                    console.error('ãŠæ°—ã«å…¥ã‚Šèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                    return [];
                }
            }); // ãŠæ°—ã«å…¥ã‚Šãƒ¬ãƒãƒ¼ãƒˆãƒªã‚¹ãƒˆ
            const [showFavoritesList, setShowFavoritesList] = useState(false); // ãŠæ°—ã«å…¥ã‚Šãƒªã‚¹ãƒˆè¡¨ç¤ºçŠ¶æ…‹
            // åˆæœŸã‚¿ã‚°ã®è¨­å®š
            const initializeDefaultTags = () => {
                const defaultTags = new Map();
                const defaultLinks = [];
                
                // ä¸€èˆ¬çš„ãªå¤§ã‚«ãƒ†ã‚´ãƒªã‚¿ã‚°ã‚’äº‹å‰é…ç½®
                const initialTags = [
                    { id: 'AI', size: 1.5, x: 200, y: 150 },
                    { id: 'æŠ€è¡“', size: 1.3, x: 350, y: 200 },
                    { id: 'ãƒ“ã‚¸ãƒã‚¹', size: 1.2, x: 500, y: 150 },
                    { id: 'æ–™ç†', size: 1.0, x: 150, y: 300 },
                    { id: 'æ—…è¡Œ', size: 1.1, x: 400, y: 350 },
                    { id: 'å‹•ç‰©', size: 0.9, x: 600, y: 280 },
                    { id: 'SDGs', size: 1.1, x: 300, y: 100 },
                    { id: 'ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³', size: 0.8, x: 550, y: 400 }
                ];
                
                initialTags.forEach(tag => {
                    defaultTags.set(tag.id, {
                        id: tag.id,
                        count: 1,
                        size: tag.size,
                        x: tag.x,
                        y: tag.y
                    });
                });
                
                // ã‚¿ã‚°é–“ã®é–¢é€£æ€§ãƒªãƒ³ã‚¯
                const tagRelations = [
                    ['AI', 'æŠ€è¡“'],
                    ['æŠ€è¡“', 'ãƒ“ã‚¸ãƒã‚¹'],
                    ['SDGs', 'ãƒ“ã‚¸ãƒã‚¹'],
                    ['æ—…è¡Œ', 'æ–™ç†'],
                    ['ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³', 'ãƒ“ã‚¸ãƒã‚¹']
                ];
                
                tagRelations.forEach(([source, target]) => {
                    defaultLinks.push({ source, target });
                });
                
                return { defaultTags, defaultLinks };
            };
            
            // è¨˜äº‹ã®è©±é¡Œæ€§ã‚¹ã‚³ã‚¢ã‚’è¨ˆç®—ï¼ˆåˆæœŸèª­ã¿è¾¼ã¿æ™‚ã®ã¿ï¼‰
            const calculateTopicalityScore = (article) => {
                let score = 0;
                
                // ã‚¿ã‚°æ•°ã«ã‚ˆã‚‹åŸºæœ¬ã‚¹ã‚³ã‚¢ï¼ˆå¤šã„ã»ã©è©±é¡Œæ€§ãŒé«˜ã„ï¼‰
                score += article.tags.length * 15;
                
                // ç‰¹å®šã®è©±é¡Œæ€§ã®é«˜ã„ã‚¿ã‚°ã«ã‚ˆã‚‹è¿½åŠ ã‚¹ã‚³ã‚¢
                const hotTags = ['AI', 'æŠ€è¡“', 'ãƒ“ã‚¸ãƒã‚¹', 'SDGs', 'ã‚¤ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³'];
                const trendingTags = article.tags.filter(tag => hotTags.includes(tag));
                score += trendingTags.length * 25;
                
                // ãƒ©ãƒ³ãƒ€ãƒ è¦ç´ ï¼ˆè¨˜äº‹ã®å¤šæ§˜æ€§ã‚’ç¢ºä¿ï¼‰
                score += Math.random() * 20;
                
                return Math.max(10, Math.min(100, score)); // 10-100ã®ç¯„å›²
            };

            // è©±é¡Œæ€§ã‚¹ã‚³ã‚¢ã«åŸºã¥ãã‚°ãƒªãƒƒãƒ‰ã‚µã‚¤ã‚ºã‚’æ±ºå®šï¼ˆã™ã¹ã¦æ­£æ–¹å½¢ã®çµ„ã¿åˆã‚ã›ï¼‰
            const getStaticGridSize = (score) => {
                if (score >= 80) return { gridColumn: 'span 2', gridRow: 'span 2' }; // å¤§æ­£æ–¹å½¢ (2x2)
                if (score >= 60) return { gridColumn: 'span 2', gridRow: 'span 2' }; // å¤§æ­£æ–¹å½¢ (2x2)
                if (score >= 40) return { gridColumn: 'span 1', gridRow: 'span 1' }; // å°æ­£æ–¹å½¢ (1x1)
                return { gridColumn: 'span 1', gridRow: 'span 1' }; // å°æ­£æ–¹å½¢ (1x1)
            };

            // èˆˆå‘³ã®æ·±ã•æƒ…å ±ã‚’å–å¾—ã™ã‚‹é–¢æ•°
            const getDepthInfo = (depth) => {
                if (depth <= 30) {
                    return {
                        label: 'ç§çš„èˆˆå‘³',
                        description: 'å€‹äººçš„ãªè¶£å‘³ã‚„é–¢å¿ƒäº‹ã«ç„¦ç‚¹ã‚’å½“ã¦ãŸè¨˜äº‹ãŒä¸­å¿ƒã¨ãªã‚Šã¾ã™ã€‚'
                    };
                } else if (depth <= 70) {
                    return {
                        label: 'ãƒãƒ©ãƒ³ã‚¹',
                        description: 'æ§˜ã€…ãªã‚¸ãƒ£ãƒ³ãƒ«ã®è¨˜äº‹ã‚’ãƒãƒ©ãƒ³ã‚¹è‰¯ãè¡¨ç¤ºã—ã¾ã™ã€‚'
                    };
                } else {
                    return {
                        label: 'ãƒ‘ãƒ¼ã‚½ãƒŠãƒ«',
                        description: 'ãƒ“ã‚¸ãƒã‚¹ãƒ»æŠ€è¡“ç³»ã®å°‚é–€çš„ãªè¨˜äº‹ãŒä¸­å¿ƒã¨ãªã‚Šã¾ã™ã€‚'
                    };
                }
            };

            // ãŠæ°—ã«å…¥ã‚Šãƒ¬ãƒãƒ¼ãƒˆç®¡ç†ï¼ˆãƒˆã‚°ãƒ«æ©Ÿèƒ½ä»˜ãï¼‰
            const toggleFavorites = (reportData, event) => {
                const newReport = {
                    title: reportData.title,
                    type: reportData.type,
                    tags: reportData.tags,
                    timestamp: new Date().toISOString(),
                    articleCount: reportData.articleCount
                };
                
                setFavoriteReports(prev => {
                    // æ—¢å­˜ãƒã‚§ãƒƒã‚¯
                    const existingIndex = prev.findIndex(report =>
                        report.type === newReport.type &&
                        JSON.stringify(report.tags.sort()) === JSON.stringify(newReport.tags.sort())
                    );

                    let updatedReports;
                    if (existingIndex !== -1) {
                        // æ—¢å­˜ã®å ´åˆã¯å‰Šé™¤ï¼ˆè§£é™¤ï¼‰
                        if (event) {
                            showCompletionAnimation(event.target, 'delete');
                        }
                        updatedReports = prev.filter((_, index) => index !== existingIndex);
                    } else {
                        // æ–°è¦ã®å ´åˆã¯è¿½åŠ 
                        const reportId = `${reportData.type}_${reportData.tags.join('_')}_${Date.now()}`;
                        const reportWithId = { ...newReport, id: reportId };

                        if (event) {
                            showCompletionAnimation(event.target, 'success');
                        }
                        updatedReports = [...prev, reportWithId];
                    }

                    // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
                    try {
                        localStorage.setItem('favoriteReports', JSON.stringify(updatedReports));
                        console.log('ãŠæ°—ã«å…¥ã‚Šä¿å­˜å®Œäº†:', updatedReports);
                    } catch (error) {
                        console.error('ãŠæ°—ã«å…¥ã‚Šä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
                    }

                    return updatedReports;
                });
            };
            
            // æ—§é–¢æ•°åã¨ã®äº’æ›æ€§ã®ãŸã‚
            const addToFavorites = toggleFavorites;
            
            // ãŠæ°—ã«å…¥ã‚ŠçŠ¶æ…‹ãƒã‚§ãƒƒã‚¯
            const isFavorite = (reportData) => {
                return favoriteReports.some(report => 
                    report.type === reportData.type && 
                    JSON.stringify(report.tags.sort()) === JSON.stringify(reportData.tags.sort())
                );
            };

            const removeFromFavorites = (reportId, event) => {
                setFavoriteReports(prev => {
                    const updatedReports = prev.filter(report => report.id !== reportId);

                    // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
                    try {
                        localStorage.setItem('favoriteReports', JSON.stringify(updatedReports));
                    } catch (error) {
                        console.error('ãŠæ°—ã«å…¥ã‚Šå‰Šé™¤ä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
                    }

                    return updatedReports;
                });

                // å‰Šé™¤æ™‚ã®å®Œäº†ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
                if (event) {
                    showCompletionAnimation(event.target, 'delete');
                }
            };

            // ä½œæ¥­å®Œäº†æ„Ÿã®ã‚ã‚‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
            const showCompletionAnimation = (target, type) => {
                if (!target) return;
                
                // ãƒœã‚¿ãƒ³ã®ä¸€æ™‚çš„ãªå¤‰æ›´
                const originalHTML = target.innerHTML;
                const originalClass = target.getAttribute('class') || target.className || '';
                
                // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹ã«å¤‰æ›´
                target.style.transform = 'scale(1.2)';
                target.style.transition = 'all 0.2s cubic-bezier(0.68, -0.55, 0.265, 1.55)';
                
                if (type === 'success') {
                    target.innerHTML = `
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                            <path d="M20 6L9 17l-5-5"/>
                        </svg>
                    `;
                    target.setAttribute('class', String(originalClass).replace('text-gray-400', 'text-green-500'));
                } else if (type === 'existing') {
                    target.innerHTML = `
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="M12 6v6l4 2"/>
                        </svg>
                    `;
                    target.setAttribute('class', String(originalClass).replace('text-gray-400', 'text-orange-500'));
                } else if (type === 'delete') {
                    target.innerHTML = `
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                            <path d="M20 6L9 17l-5-5"/>
                        </svg>
                    `;
                    target.setAttribute('class', String(originalClass).replace('text-gray-400', 'text-red-500'));
                }
                
                // æ³¢ç´‹ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
                const ripple = document.createElement('div');
                ripple.style.position = 'absolute';
                ripple.style.borderRadius = '50%';
                ripple.style.background = type === 'success' ? 'rgba(34, 197, 94, 0.3)' : 
                                         type === 'existing' ? 'rgba(249, 115, 22, 0.3)' : 
                                         'rgba(239, 68, 68, 0.3)';
                ripple.style.transform = 'scale(0)';
                ripple.style.animation = 'ripple 0.6s linear';
                ripple.style.width = '40px';
                ripple.style.height = '40px';
                ripple.style.left = '-12px';
                ripple.style.top = '-12px';
                ripple.style.pointerEvents = 'none';
                
                target.style.position = 'relative';
                target.appendChild(ripple);
                
                // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³çµ‚äº†å¾Œã«å…ƒã«æˆ»ã™
                setTimeout(() => {
                    target.style.transform = 'scale(1)';
                    setTimeout(() => {
                        target.innerHTML = originalHTML;
                        target.setAttribute('class', String(originalClass));
                        target.style.transform = '';
                        target.style.transition = '';
                        if (ripple.parentNode) {
                            ripple.parentNode.removeChild(ripple);
                        }
                    }, 200);
                }, 400);
            };

            // ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
            useEffect(() => {
                const initializeData = async () => {
                    await loadData();
                    
                    console.log('âœ… ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨');
                    console.log('è¨˜äº‹æ•°:', inlineData.articles.length);
                    
                    // è¨˜äº‹ã«è©±é¡Œæ€§ã‚¹ã‚³ã‚¢ã¨é™çš„ã‚µã‚¤ã‚ºã‚’è¿½åŠ 
                    const articlesWithTopicality = inlineData.articles.map(article => {
                        const topicalityScore = calculateTopicalityScore(article);
                        const staticGridSize = getStaticGridSize(topicalityScore);
                        return {
                            ...article,
                            topicalityScore,
                            staticGridSize
                        };
                    });
                    
                    console.log('è©±é¡Œæ€§ã‚¹ã‚³ã‚¢ä»˜ãè¨˜äº‹:', articlesWithTopicality.map(a => ({ 
                        title: a.title, 
                        score: a.topicalityScore,
                        size: a.staticGridSize
                    })));
                    
                    setArticles(articlesWithTopicality);
                    setHierarchicalTags(inlineData.hierarchical_tags);
                    
                    // åˆæœŸã‚¿ã‚°ã¨ãƒªãƒ³ã‚¯ã‚’è¨­å®š
                    const { defaultTags, defaultLinks } = initializeDefaultTags();
                    setCollectedTags(defaultTags);
                    setTagLinks(defaultLinks);
                    
                    setDataLoaded(true);
                };
                
                initializeData();
            }, []);

            const handleArticleRead = (article, event) => {
                console.log('handleArticleReadå®Ÿè¡Œ:', { article, showFavorites, currentView });
                // ç¾åœ¨ã®ç”»é¢çŠ¶æ…‹ã‚’ä¿å­˜
                if (showFavorites) {
                    setPreviousView('favorites');
                } else if (currentView === 'favorites') {
                    setPreviousView('favoritesList');
                } else {
                    setPreviousView('main');
                }

                // è¨˜äº‹è©³ç´°è¡¨ç¤º
                console.log('è¨˜äº‹è©³ç´°è¡¨ç¤ºè¨­å®šä¸­...');
                setSelectedArticle(article);
                setShowArticleDetail(true);
                console.log('è¨˜äº‹è©³ç´°è¡¨ç¤ºè¨­å®šå®Œäº†');

                // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹
                const rect = event.target.getBoundingClientRect();
                const startX = rect.left + rect.width / 2;
                const startY = rect.top + rect.height / 2;
                
                if (window.startParticleEffect) {
                    window.startParticleEffect(startX, startY, article.tags);
                }

                // ã‚¿ã‚°ã‚’åé›†
                const newTags = new Map(collectedTags);
                const newLinks = [...tagLinks];

                article.tags.forEach(tagId => {
                    if (newTags.has(tagId)) {
                        const existingTag = newTags.get(tagId);
                        existingTag.count++;
                        existingTag.size = 1 + existingTag.count * 0.3;
                        newTags.set(tagId, existingTag);
                    } else {
                        newTags.set(tagId, {
                            id: tagId,
                            count: 1,
                            size: 1,
                            x: Math.random() * 800 + 100,
                            y: Math.random() * 400 + 100
                        });
                    }
                });

                // ã‚¿ã‚°é–“ã®ãƒªãƒ³ã‚¯ã‚’ç”Ÿæˆ
                for (let i = 0; i < article.tags.length; i++) {
                    for (let j = i + 1; j < article.tags.length; j++) {
                        const sourceTag = article.tags[i];
                        const targetTag = article.tags[j];
                        
                        const linkExists = newLinks.some(link =>
                            (link.source === sourceTag && link.target === targetTag) ||
                            (link.source === targetTag && link.target === sourceTag)
                        );

                        if (!linkExists) {
                            newLinks.push({ source: sourceTag, target: targetTag });
                        }
                    }
                }

                setCollectedTags(newTags);
                setTagLinks(newLinks);
            };

            const handleTagClick = (tagId) => {
                // ã‚¿ã‚°é¸æŠã®åˆ‡ã‚Šæ›¿ãˆ
                setSelectedTags(prev => {
                    if (prev.includes(tagId)) {
                        return prev.filter(id => id !== tagId);
                    } else {
                        return [...prev, tagId];
                    }
                });
            };

            const handleTagExpand = (tagId) => {
                const children = hierarchicalTags[tagId];
                if (!children) return;

                const newTags = new Map(collectedTags);
                const newLinks = [...tagLinks];
                
                if (newTags.has(tagId)) {
                    const parentTag = newTags.get(tagId);
                    parentTag.isExpanded = true;
                    newTags.set(tagId, parentTag);
                }

                children.forEach(childTag => {
                    if (!newTags.has(childTag)) {
                        newTags.set(childTag, {
                            id: childTag,
                            count: 1,
                            size: 0.7,
                            x: Math.random() * 800 + 100,
                            y: Math.random() * 400 + 100,
                            parent: tagId,
                            isChild: true
                        });

                        newLinks.push({ source: tagId, target: childTag });
                    }
                });

                setCollectedTags(newTags);
                setTagLinks(newLinks);
            };

            // ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³è‰²ã‚’å–å¾—ã™ã‚‹é–¢æ•°
            const getGradientColor = (depth) => {
                // ãƒãƒ©ãƒ³ã‚¹ãƒãƒ¼ã¨åŒã˜ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³: ãƒ”ãƒ³ã‚¯ -> é’ -> æ°´è‰² -> ç·‘
                if (depth <= 33) {
                    // ãƒ”ãƒ³ã‚¯ã‹ã‚‰é’ã¸ (0-33%)
                    const ratio = depth / 33;
                    const r = Math.round(236 + (59 - 236) * ratio);  // #ec4899 -> #3b82f6
                    const g = Math.round(72 + (130 - 72) * ratio);
                    const b = Math.round(153 + (246 - 153) * ratio);
                    return `rgb(${r}, ${g}, ${b})`;
                } else if (depth <= 66) {
                    // é’ã‹ã‚‰æ°´è‰²ã¸ (33-66%)
                    const ratio = (depth - 33) / 33;
                    const r = Math.round(59 + (6 - 59) * ratio);     // #3b82f6 -> #06b6d4
                    const g = Math.round(130 + (182 - 130) * ratio);
                    const b = Math.round(246 + (212 - 246) * ratio);
                    return `rgb(${r}, ${g}, ${b})`;
                } else {
                    // æ°´è‰²ã‹ã‚‰ç·‘ã¸ (66-100%)
                    const ratio = (depth - 66) / 34;
                    const r = Math.round(6 + (16 - 6) * ratio);      // #06b6d4 -> #10b981
                    const g = Math.round(182 + (185 - 182) * ratio);
                    const b = Math.round(212 + (129 - 212) * ratio);
                    return `rgb(${r}, ${g}, ${b})`;
                }
            };
            

            // ãƒãƒƒãƒ—ç”»é¢ç”¨ï¼šé¸æŠã•ã‚ŒãŸã‚¿ã‚°ã«é–¢é€£ã™ã‚‹è¨˜äº‹ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
            const getMapFilteredArticles = () => {
                let baseArticles = articles;
                
                if (selectedTags.length > 0) {
                    const mainSelectedTag = selectedTags[0];
                    
                    // 1. é¸æŠã‚¿ã‚°ã«ç›´æ¥é–¢é€£ã™ã‚‹è¨˜äº‹ã‚’å–å¾—
                    const directMatches = baseArticles.filter(article =>
                        article.tags.includes(mainSelectedTag)
                    );
                    
                    // 2. é¸æŠã‚¿ã‚°ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼ˆç§çš„/å…¬çš„ï¼‰ã«åŸºã¥ã„ã¦è¨˜äº‹ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
                    const contextualTags = getContextualTags(mainSelectedTag, 50);
                    const contextualMatches = baseArticles.filter(article =>
                        article.tags.some(tag => contextualTags.includes(tag))
                    );
                    
                    // 3. å…¨è¨˜äº‹ã‚’è¿½åŠ ï¼ˆãƒ•ã‚£ãƒ¼ãƒ‰ãƒ“ãƒ¥ãƒ¼ãŒå‰Šé™¤ã•ã‚ŒãŸãŸã‚ï¼‰
                    const additionalArticles = baseArticles;
                    
                    // 4. é‡è¤‡ã‚’é™¤ã„ã¦å„ªå…ˆé †ä½ã§ã‚½ãƒ¼ãƒˆ
                    const allArticles = [...directMatches, ...contextualMatches, ...additionalArticles];
                    const uniqueArticles = Array.from(
                        new Map(allArticles.map(article => [article.title, article])).values()
                    );
                    
                    // 5. é–¢é€£åº¦ã§ã‚½ãƒ¼ãƒˆ
                    uniqueArticles.sort((a, b) => {
                        const aDirectMatch = a.tags.includes(mainSelectedTag) ? 3 : 0;
                        const aContextMatch = a.tags.some(tag => contextualTags.includes(tag)) ? 2 : 0;
                        const aTagCount = a.tags.filter(tag => selectedTags.includes(tag)).length;
                        
                        const bDirectMatch = b.tags.includes(mainSelectedTag) ? 3 : 0;
                        const bContextMatch = b.tags.some(tag => contextualTags.includes(tag)) ? 2 : 0;
                        const bTagCount = b.tags.filter(tag => selectedTags.includes(tag)).length;
                        
                        const aScore = aDirectMatch + aContextMatch + aTagCount;
                        const bScore = bDirectMatch + bContextMatch + bTagCount;
                        
                        return bScore - aScore;
                    });
                    
                    return uniqueArticles;
                } else {
                    // é¸æŠã‚¿ã‚°ãªã—ã®å ´åˆã¯å…¨è¨˜äº‹è¡¨ç¤º
                    return articles;
                }
            };

            const tagsArray = Array.from(collectedTags.values());
            
            // ãƒãƒƒãƒ—ãƒ“ãƒ¥ãƒ¼å°‚ç”¨ã®ãŸã‚ã€å…¨è¨˜äº‹ã‚’è¡¨ç¤º
            const filteredArticles = articles;

            // D3.jsãƒãƒƒãƒ—ã®åˆæœŸåŒ–ã¨ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ
            useEffect(() => {
                if (currentView !== 'map' || tagsArray.length === 0) return;

                const container = document.getElementById('map-container');
                const svg = d3.select("#mapSvg");
                
                if (!container || !svg.node()) return;

                const width = container.clientWidth;
                const height = container.clientHeight;

                // æ—¢å­˜ã®è¦ç´ ã‚’ã‚¯ãƒªã‚¢
                svg.selectAll("*").remove();

                // èƒŒæ™¯ã®é€æ˜ãªçŸ©å½¢ã‚’è¿½åŠ ï¼ˆã‚¯ãƒªãƒƒã‚¯é ˜åŸŸã¨ã—ã¦ï¼‰
                const background = svg.append("rect")
                    .attr("width", width)
                    .attr("height", height)
                    .attr("fill", "transparent")
                    .style("cursor", "pointer");

                // ã‚°ãƒ«ãƒ¼ãƒ—ã®ä½œæˆ
                const linkGroup = svg.append("g").attr("class", "links");
                const nodeGroup = svg.append("g").attr("class", "nodes");
                const textGroup = svg.append("g").attr("class", "texts");

                // ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆå®‰å®šåŒ–ï¼‰
                const simulation = d3.forceSimulation(tagsArray)
                    .force("link", d3.forceLink(tagLinks)
                        .id(d => d.id)
                        .distance(80)
                        .strength(0.3))
                    .force("charge", d3.forceManyBody()
                        .strength(-150)
                        .distanceMin(30)
                        .distanceMax(200))
                    .force("center", d3.forceCenter(width / 2, height / 2)
                        .strength(0.05))
                    .force("collision", d3.forceCollide()
                        .radius(d => 25 + d.size * 5)
                        .strength(0.7))
                    .alphaDecay(0.02)
                    .velocityDecay(0.3);

                // ãƒªãƒ³ã‚¯ã®æç”»
                const links = linkGroup
                    .selectAll("line")
                    .data(tagLinks)
                    .enter()
                    .append("line")
                    .style("stroke", "rgba(255, 255, 255, 0.2)")
                    .style("stroke-width", 2);

                // ãƒãƒ¼ãƒ‰ã®æç”»
                const nodes = nodeGroup
                    .selectAll("circle")
                    .data(tagsArray)
                    .enter()
                    .append("circle")
                    .attr("r", d => 15 + d.size * 8)
                    .style("fill", d => {
                        if (d.isChild) {
                            // å­ã‚¿ã‚°ã¯å°‘ã—æš—ã‚ã«
                            const baseColor = getGradientColor(interestDepth);
                            const rgb = baseColor.match(/\d+/g);
                            const r = Math.max(0, parseInt(rgb[0]) - 30);
                            const g = Math.max(0, parseInt(rgb[1]) - 30);
                            const b = Math.max(0, parseInt(rgb[2]) - 30);
                            return `rgb(${r}, ${g}, ${b})`;
                        }
                        return getGradientColor(interestDepth);
                    })
                    .style("stroke", "rgba(255, 255, 255, 0.8)")
                    .style("stroke-width", 2)
                    .style("cursor", "pointer")
                    .style("filter", "drop-shadow(0 4px 8px rgba(0,0,0,0.3))")
                    .style("stroke-width", d => selectedTags.includes(d.id) ? 4 : 2)
                    .style("stroke", d => selectedTags.includes(d.id) ? "#fbbf24" : "rgba(255, 255, 255, 0.8)")
                    .on("click", (event, d) => {
                        event.stopPropagation();
                        if (event.shiftKey) {
                            // Shiftã‚¯ãƒªãƒƒã‚¯ã§é¸æŠã®ã¿
                            handleTagClick(d.id);
                        } else {
                            // é€šå¸¸ã‚¯ãƒªãƒƒã‚¯ã§å±•é–‹
                            const children = hierarchicalTags[d.id];
                            if (children && !d.isExpanded) {
                                handleTagExpand(d.id);
                            } else {
                                // å±•é–‹æ¸ˆã¿ã¾ãŸã¯å­ã‚¿ã‚°ãŒãªã„å ´åˆã¯é¸æŠ
                                handleTagClick(d.id);
                            }
                        }
                    })
                    .on("mouseover", function(event, d) {
                        d3.select(this)
                            .transition()
                            .duration(200)
                            .attr("r", (15 + d.size * 8) * 1.2)
                            .style("filter", "drop-shadow(0 6px 12px rgba(0,0,0,0.4))");
                    })
                    .on("mouseout", function(event, d) {
                        d3.select(this)
                            .transition()
                            .duration(200)
                            .attr("r", 15 + d.size * 8)
                            .style("filter", "drop-shadow(0 4px 8px rgba(0,0,0,0.3))");
                    });

                // ãƒ†ã‚­ã‚¹ãƒˆãƒ©ãƒ™ãƒ«ã®æç”»
                const texts = textGroup
                    .selectAll("text")
                    .data(tagsArray)
                    .enter()
                    .append("text")
                    .text(d => d.id)
                    .style("fill", "white")
                    .style("font-size", d => `${12 + d.size * 2}px`)
                    .style("font-weight", "600")
                    .style("text-anchor", "middle")
                    .style("dominant-baseline", "central")
                    .style("pointer-events", "none")
                    .style("text-shadow", "1px 1px 2px rgba(0,0,0,0.8)");

                // ãƒ‰ãƒ©ãƒƒã‚°å‡¦ç†ï¼ˆæ»‘ã‚‰ã‹ã«ï¼‰
                const drag = d3.drag()
                    .on("start", (event, d) => {
                        if (!event.active) simulation.alphaTarget(0.1).restart();
                        d.fx = d.x;
                        d.fy = d.y;
                        // ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã¯é€Ÿåº¦ã‚’åˆ¶é™
                        d.vx = d.vx * 0.1;
                        d.vy = d.vy * 0.1;
                    })
                    .on("drag", (event, d) => {
                        d.fx = event.x;
                        d.fy = event.y;
                    })
                    .on("end", (event, d) => {
                        if (!event.active) simulation.alphaTarget(0.05);
                        // ãƒ‰ãƒ©ãƒƒã‚°çµ‚äº†å¾Œã‚‚ä½ç½®ã‚’ä¿æŒã—ãªã„
                        setTimeout(() => {
                            d.fx = null;
                            d.fy = null;
                        }, 500);
                    });

                nodes.call(drag);

                // ã‚ºãƒ¼ãƒ å‡¦ç†
                const zoom = d3.zoom()
                    .scaleExtent([0.5, 3])
                    .filter((event) => {
                        // èƒŒæ™¯çŸ©å½¢ã®ã‚¯ãƒªãƒƒã‚¯ã¯é€šã™ã€ä»–ã®ã‚ºãƒ¼ãƒ æ“ä½œã¯åˆ¶é™
                        return !event.button && (event.type !== 'click');
                    })
                    .on("zoom", (event) => {
                        linkGroup.attr("transform", event.transform);
                        nodeGroup.attr("transform", event.transform);
                        textGroup.attr("transform", event.transform);
                    });

                svg.call(zoom);
                
                // ãƒãƒ¼ãƒ‰ã‚’ä¸­å¤®ã«ãƒªã‚»ãƒƒãƒˆã™ã‚‹é–¢æ•°
                const resetNodesPosition = () => {
                    console.log("ãƒªã‚»ãƒƒãƒˆé–‹å§‹");
                    
                    // 1. å›ºå®šä½ç½®ã¨é€Ÿåº¦ã‚’ã‚¯ãƒªã‚¢
                    tagsArray.forEach(d => {
                        d.fx = null;
                        d.fy = null;
                        d.vx = 0;
                        d.vy = 0;
                        // ä¸­å¤®ä»˜è¿‘ã«ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆã«é…ç½®
                        d.x = width/2 + (Math.random() - 0.5) * 60;
                        d.y = height/2 + (Math.random() - 0.5) * 60;
                    });
                    
                    // 2. ã‚ºãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ
                    svg.call(zoom.transform, d3.zoomIdentity);
                    
                    // 3. ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç©ã‚„ã‹ã«å†é–‹
                    simulation
                        .alpha(0.2)
                        .alphaTarget(0.05)
                        .restart();
                    
                    console.log("ãƒªã‚»ãƒƒãƒˆå®Œäº†");
                };
                
                // èƒŒæ™¯çŸ©å½¢ã®ã‚¯ãƒªãƒƒã‚¯ã§ãƒªã‚»ãƒƒãƒˆ
                background.on("click", (event) => {
                    console.log("èƒŒæ™¯ã‚¯ãƒªãƒƒã‚¯æ¤œçŸ¥!", event);
                    resetNodesPosition();
                });
                
                // SVGã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚ºãƒ¼ãƒ å‹•ä½œã‚’ç„¡åŠ¹åŒ–
                svg.on("dblclick.zoom", null);

                // ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®æ›´æ–°
                simulation.on("tick", () => {
                    links
                        .attr("x1", d => d.source.x)
                        .attr("y1", d => d.source.y)
                        .attr("x2", d => d.target.x)
                        .attr("y2", d => d.target.y);

                    nodes
                        .attr("cx", d => d.x)
                        .attr("cy", d => d.y);

                    texts
                        .attr("x", d => d.x)
                        .attr("y", d => d.y);
                });

            }, [currentView, tagsArray, tagLinks, interestDepth, selectedTags]);
            
            // é¸æŠãƒãƒ¼ãƒ‰ã«é–¢é€£ã™ã‚‹ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚¿ã‚°ã‚’å–å¾—
            const getContextualTags = (selectedTag, interestLevel) => {
                const tagContexts = {
                    'æ—…è¡Œ': {
                        private: ['æ–™ç†', 'æ¸©æ³‰', 'ã‚°ãƒ«ãƒ¡', 'ãƒªã‚¾ãƒ¼ãƒˆ', 'ãƒ•ã‚©ãƒˆ', 'ä¼‘æ—¥'],
                        professional: ['å‡ºå¼µ', 'ä¼šè­°', 'ãƒ“ã‚¸ãƒã‚¹ãƒ›ãƒ†ãƒ«', 'ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚­ãƒ³ã‚°', 'æ–‡åŒ–äº¤æµ'],
                        balanced: ['æ–™ç†', 'æ–‡åŒ–', 'æ­´å²', 'äº¤é€š', 'ãƒ›ãƒ†ãƒ«']
                    },
                    'æ–™ç†': {
                        private: ['æ‰‹æ–™ç†', 'ã‚¹ã‚¤ãƒ¼ãƒ„', 'å®¶åº­æ–™ç†', 'ãƒ¬ã‚·ãƒ”', 'ãŠã‚„ã¤'],
                        professional: ['ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³', 'ãƒ•ãƒ¼ãƒ‰ãƒ“ã‚¸ãƒã‚¹', 'æ „é¤Šå­¦', 'ãƒ•ãƒ¼ãƒ‰ãƒ†ãƒƒã‚¯'],
                        balanced: ['å’Œé£Ÿ', 'å¯¿å¸', 'ã‚°ãƒ«ãƒ¡', 'æ—…è¡Œ', 'æ–‡åŒ–']
                    },
                    'AI': {
                        private: ['ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆ', 'ã‚²ãƒ¼ãƒ ', 'ã‚¢ãƒ—ãƒª', 'éŸ³å£°ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ'],
                        professional: ['æ©Ÿæ¢°å­¦ç¿’', 'æŠ€è¡“', 'ãƒ“ã‚¸ãƒã‚¹', 'ãƒ‡ãƒ¼ã‚¿åˆ†æ', 'è‡ªå‹•åŒ–'],
                        balanced: ['æŠ€è¡“', 'ã‚¤ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³', 'æœªæ¥', 'ç¤¾ä¼š']
                    },
                    'å‹•ç‰©': {
                        private: ['ãƒšãƒƒãƒˆ', 'çŒ«', 'çŠ¬', 'ã‚¢ãƒ‹ãƒãƒ«ã‚«ãƒ•ã‚§', 'å‹•ç‰©åœ’'],
                        professional: ['ç£åŒ»å­¦', 'ç”Ÿæ…‹å­¦', 'çµ¶æ»…ä¿è­·', 'SDGs', 'ç’°å¢ƒ'],
                        balanced: ['ãƒšãƒƒãƒˆ', 'è‡ªç„¶', 'ç’°å¢ƒ', 'ä¿è­·']
                    }
                };
                
                const context = tagContexts[selectedTag];
                if (!context) return [];
                
                if (interestLevel < 30) return context.private || [];
                if (interestLevel > 70) return context.professional || [];
                return context.balanced || [];
            };
            
            // èˆˆå‘³ã®æ·±ã•ã«å¿œã˜ãŸå‹•çš„ã‚¿ã‚°ç”Ÿæˆ
            const generateDynamicTags = (depth) => {
                if (depth <= 30) {
                    // ç§çš„èˆˆå‘³ï¼šå…·ä½“çš„ã§å€‹äººçš„ãªã‚¿ã‚°
                    return [
                        { id: 'åŒ—æµ·é“', size: 1.2, x: 180, y: 120, category: 'private' },
                        { id: 'æ²–ç¸„', size: 1.1, x: 320, y: 100, category: 'private' },
                        { id: 'æ¸©æ³‰', size: 1.0, x: 460, y: 130, category: 'private' },
                        { id: 'å®¶åº­æ–™ç†', size: 1.0, x: 200, y: 280, category: 'private' },
                        { id: 'ãƒšãƒƒãƒˆ', size: 1.0, x: 380, y: 320, category: 'private' },
                        { id: 'çŒ«', size: 0.9, x: 520, y: 260, category: 'private' },
                        { id: 'ã‚¢ãƒ‹ãƒ¡', size: 0.8, x: 150, y: 350, category: 'private' },
                        { id: 'ã‚²ãƒ¼ãƒ ', size: 0.8, x: 580, y: 180, category: 'private' }
                    ];
                } else if (depth <= 70) {
                    // ãƒãƒ©ãƒ³ã‚¹ï¼šä¸€èˆ¬çš„ãªã‚¿ã‚°
                    return [
                        { id: 'AI', size: 1.2, x: 180, y: 120, category: 'balanced' },
                        { id: 'æŠ€è¡“', size: 1.1, x: 320, y: 100, category: 'balanced' },
                        { id: 'ãƒ“ã‚¸ãƒã‚¹', size: 1.0, x: 460, y: 130, category: 'balanced' },
                        { id: 'æ–™ç†', size: 1.0, x: 200, y: 280, category: 'balanced' },
                        { id: 'æ—…è¡Œ', size: 1.0, x: 380, y: 320, category: 'balanced' },
                        { id: 'å‹•ç‰©', size: 0.9, x: 520, y: 260, category: 'balanced' },
                        { id: 'ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³', size: 0.8, x: 150, y: 350, category: 'balanced' },
                        { id: 'SDGs', size: 0.8, x: 580, y: 180, category: 'balanced' }
                    ];
                } else {
                    // ãƒ‘ãƒ¼ã‚½ãƒŠãƒ«ï¼šãƒ“ã‚¸ãƒã‚¹ãƒ»å°‚é–€çš„ãªã‚¿ã‚°
                    return [
                        { id: 'æ©Ÿæ¢°å­¦ç¿’', size: 1.2, x: 180, y: 120, category: 'professional' },
                        { id: 'ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—', size: 1.1, x: 320, y: 100, category: 'professional' },
                        { id: 'ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°', size: 1.0, x: 460, y: 130, category: 'professional' },
                        { id: 'ãƒ•ãƒ¼ãƒ‰ãƒ†ãƒƒã‚¯', size: 1.0, x: 200, y: 280, category: 'professional' },
                        { id: 'æµ·å¤–æ—…è¡Œ', size: 1.0, x: 380, y: 320, category: 'professional' },
                        { id: 'ãƒ„ã‚¢ãƒ¼', size: 0.9, x: 520, y: 260, category: 'professional' },
                        { id: 'Eã‚³ãƒãƒ¼ã‚¹', size: 0.8, x: 150, y: 350, category: 'professional' },
                        { id: 'ãƒ‡ãƒ¼ã‚¿åˆ†æ', size: 0.8, x: 580, y: 180, category: 'professional' }
                    ];
                }
            };

            // ãƒãƒƒãƒ—ç”¨ã®ã‚¿ã‚°ã‚»ãƒƒãƒˆã‚’åˆæœŸåŒ–
            useEffect(() => {
                if (currentView === 'map') {
                    const currentTags = generateDynamicTags(interestDepth);
                    
                    // ã‚¿ã‚°ãƒãƒƒãƒ—ã‚’ä½œæˆ
                    const updatedTags = new Map();
                    currentTags.forEach(tag => {
                        const existingTag = collectedTags.get(tag.id);
                        updatedTags.set(tag.id, {
                            id: tag.id,
                            count: existingTag ? existingTag.count : 1,
                            size: tag.size,
                            x: existingTag ? existingTag.x : tag.x,
                            y: existingTag ? existingTag.y : tag.y,
                            category: tag.category,
                            fx: existingTag ? existingTag.fx : null,
                            fy: existingTag ? existingTag.fy : null
                        });
                    });
                    
                    // å‹•çš„ãƒªãƒ³ã‚¯é–¢ä¿‚ã‚’ä½œæˆ
                    let updatedLinks = [];
                    if (interestDepth <= 30) {
                        // ç§çš„èˆˆå‘³ã®ãƒªãƒ³ã‚¯
                        updatedLinks = [
                            { source: 'åŒ—æµ·é“', target: 'æ¸©æ³‰' },
                            { source: 'æ²–ç¸„', target: 'æ¸©æ³‰' },
                            { source: 'å®¶åº­æ–™ç†', target: 'ãƒšãƒƒãƒˆ' },
                            { source: 'çŒ«', target: 'ãƒšãƒƒãƒˆ' },
                            { source: 'ã‚¢ãƒ‹ãƒ¡', target: 'ã‚²ãƒ¼ãƒ ' }
                        ];
                    } else if (interestDepth <= 70) {
                        // ãƒãƒ©ãƒ³ã‚¹ã®ãƒªãƒ³ã‚¯
                        updatedLinks = [
                            { source: 'AI', target: 'æŠ€è¡“' },
                            { source: 'æŠ€è¡“', target: 'ãƒ“ã‚¸ãƒã‚¹' },
                            { source: 'æ–™ç†', target: 'æ—…è¡Œ' },
                            { source: 'å‹•ç‰©', target: 'ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³' },
                            { source: 'ãƒ“ã‚¸ãƒã‚¹', target: 'SDGs' }
                        ];
                    } else {
                        // ãƒ‘ãƒ¼ã‚½ãƒŠãƒ«ãƒ»å°‚é–€çš„ãªãƒªãƒ³ã‚¯
                        updatedLinks = [
                            { source: 'æ©Ÿæ¢°å­¦ç¿’', target: 'ãƒ‡ãƒ¼ã‚¿åˆ†æ' },
                            { source: 'ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—', target: 'ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°' },
                            { source: 'ãƒ•ãƒ¼ãƒ‰ãƒ†ãƒƒã‚¯', target: 'Eã‚³ãƒãƒ¼ã‚¹' },
                            { source: 'æµ·å¤–æ—…è¡Œ', target: 'ãƒ„ã‚¢ãƒ¼' },
                            { source: 'ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°', target: 'ãƒ‡ãƒ¼ã‚¿åˆ†æ' }
                        ];
                    }
                    
                    setCollectedTags(updatedTags);
                    setTagLinks(updatedLinks);
                }
            }, [currentView, interestDepth, selectedTags]);

            // ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ä¸­ã®è¡¨ç¤º
            if (!dataLoaded) {
                return (
                    <div className="min-h-screen bg-gray-50 flex items-center justify-center">
                        <div className="text-center">
                            <div className="w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
                            <p className="text-gray-600">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...</p>
                        </div>
                    </div>
                );
            }

            // ç¾åœ¨ã®ãƒ“ãƒ¥ãƒ¼ã«å¿œã˜ã¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’è¡¨ç¤º
            if (currentView === 'favorites') {
                return (
                    <div className="min-h-screen bg-gray-50">
                        <ParticleSystem />

                        {/* è¨˜äº‹è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ« */}
                        {showArticleDetail && selectedArticle && (
                            <div className="fixed inset-0 bg-black/50 backdrop-blur-sm z-[60] flex items-center justify-center p-4">
                                <div className="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden shadow-2xl">
                                    {/* å›ºå®šãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆé–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ã®ã¿ï¼‰ */}
                                    <div className="absolute top-0 left-0 right-0 z-10 p-4 flex justify-end">
                                        <button
                                            onClick={() => {
                                                setShowArticleDetail(false);
                                                // å‰ã®ç”»é¢ã«æˆ»ã‚‹
                                                if (previousView === 'favorites') {
                                                    setShowFavorites(true);
                                                } else if (previousView === 'favoritesList') {
                                                    // ãŠæ°—ã«å…¥ã‚Šãƒªã‚¹ãƒˆç”»é¢ã«ã¯ãã®ã¾ã¾æ®‹ã‚‹
                                                } else {
                                                    setCurrentView('map');
                                                }
                                            }}
                                            className="w-10 h-10 bg-black/20 hover:bg-black/40 rounded-full flex items-center justify-center text-white transition-all"
                                        >
                                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M15 5L5 15M5 5l10 10" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
                                            </svg>
                                        </button>
                                    </div>

                                    {/* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ãªã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */}
                                    <div className="overflow-y-auto max-h-[90vh]">
                                        {/* è¨˜äº‹ç”»åƒ */}
                                        <div className="relative">
                                            <div className="h-48 bg-gradient-to-br from-blue-500 to-purple-600 relative overflow-hidden">
                                                <img
                                                    src="https://s.yimg.jp/images/ksk/tool/img/photo01.png"
                                                    alt={selectedArticle.title}
                                                    className="w-full h-full object-cover opacity-80"
                                                />
                                                <div className="absolute inset-0 bg-gradient-to-t from-black/40 to-transparent"></div>

                                                {/* è©±é¡Œåº¦ãƒãƒƒã‚¸ */}
                                                <div className={`absolute top-4 left-4 px-3 py-1 rounded-full text-white text-sm font-medium ${
                                                    (selectedArticle.topicalityScore || 50) >= 80 ? 'bg-red-500' :
                                                    (selectedArticle.topicalityScore || 50) >= 60 ? 'bg-orange-500' :
                                                    (selectedArticle.topicalityScore || 50) >= 40 ? 'bg-yellow-500' : 'bg-gray-500'
                                                }`}>
                                                    è©±é¡Œåº¦ {Math.round(selectedArticle.topicalityScore || 50)}
                                                </div>
                                            </div>
                                        </div>

                                        {/* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */}
                                        <div className="p-6">
                                            {/* ã‚¿ã‚¤ãƒˆãƒ« */}
                                            <h1 className="text-2xl font-bold text-gray-900 mb-4 leading-tight">
                                                {selectedArticle.title}
                                            </h1>

                                            {/* ãƒ¡ã‚¿æƒ…å ± */}
                                            <div className="flex items-center gap-4 mb-6 text-sm text-gray-500">
                                                <span className="flex items-center gap-2">
                                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                        <path d="M8 0C3.6 0 0 3.6 0 8s3.6 8 8 8 8-3.6 8-8-3.6-8-8-8zm0 14c-3.3 0-6-2.7-6-6s2.7-6 6-6 6 2.7 6 6-2.7 6-6 6zm1-10H7v5l4 2.4.8-1.2-3.8-2.2V4z" fill="currentColor"/>
                                                    </svg>
                                                    {new Date().toLocaleDateString('ja-JP')}
                                                </span>
                                                <span className="flex items-center gap-2">
                                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                        <path d="M2 4.5C2 3.67157 2.67157 3 3.5 3H12.5C13.3284 3 14 3.67157 14 4.5V11.5C14 12.3284 13.3284 13 12.5 13H3.5C2.67157 13 2 12.3284 2 11.5V4.5ZM3.5 4C3.22386 4 3 4.22386 3 4.5V5.5L8 8.5L13 5.5V4.5C13 4.22386 12.7761 4 12.5 4H3.5ZM13 6.5L8 9.5L3 6.5V11.5C3 11.7761 3.22386 12 3.5 12H12.5C12.7761 12 13 11.7761 13 11.5V6.5Z" fill="currentColor"/>
                                                    </svg>
                                                    {selectedArticle.source}
                                                </span>
                                            </div>

                                            {/* è¨˜äº‹æœ¬æ–‡ */}
                                            <div className="prose max-w-none mb-6">
                                                <p className="text-gray-700 leading-relaxed text-base mb-4">
                                                    {selectedArticle.snippet}
                                                </p>

                                                {/* è©³ç´°å†…å®¹ï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰ */}
                                                <p className="text-gray-700 leading-relaxed text-base mb-4">
                                                    ã“ã®è¨˜äº‹ã§ã¯ã€{selectedArticle.title}ã«ã¤ã„ã¦è©³ã—ãè§£èª¬ã—ã¾ã™ã€‚æœ€æ–°ã®å‹•å‘ã‚„æŠ€è¡“çš„ãªè©³ç´°ã€ä»Šå¾Œã®å±•æœ›ã«ã¤ã„ã¦ã‚‚è§¦ã‚ŒãªãŒã‚‰ã€èª­è€…ã®çš†æ§˜ã«ã¨ã£ã¦æœ‰ç›Šãªæƒ…å ±ã‚’ãŠå±Šã‘ã—ã¾ã™ã€‚
                                                </p>

                                                <p className="text-gray-700 leading-relaxed text-base mb-4">
                                                    {(selectedArticle.tags || []).includes('AI') && 'AIæŠ€è¡“ã®é€²æ­©ã«ã‚ˆã‚Šã€ç§ãŸã¡ã®ç”Ÿæ´»ã¯å¤§ããå¤‰åŒ–ã—ã¦ã„ã¾ã™ã€‚'}
                                                    {(selectedArticle.tags || []).includes('æŠ€è¡“') && 'ã“ã®æŠ€è¡“é©æ–°ã¯ã€ç”£æ¥­ç•Œå…¨ä½“ã«å½±éŸ¿ã‚’ä¸ãˆã¦ã„ã¾ã™ã€‚'}
                                                    {(selectedArticle.tags || []).includes('ãƒ“ã‚¸ãƒã‚¹') && 'ãƒ“ã‚¸ãƒã‚¹ã®ä¸–ç•Œã§ã¯ã€æ–°ã—ã„ãƒ“ã‚¸ãƒã‚¹ãƒ¢ãƒ‡ãƒ«ãŒæ¬¡ã€…ã¨ç”Ÿã¾ã‚Œã¦ã„ã¾ã™ã€‚'}
                                                    {(selectedArticle.tags || []).includes('æ–™ç†') && 'é£Ÿæ–‡åŒ–ã®å¤šæ§˜æ€§ã¨ä¼çµ±ã®ç¶™æ‰¿ã«ã¤ã„ã¦è€ƒãˆã‚‹æ©Ÿä¼šã¨ãªã‚Šã¾ã™ã€‚'}
                                                    ä»Šå¾Œã®å‹•å‘ã«ã‚‚æ³¨ç›®ã—ã¦ã„ãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
                                                </p>
                                            </div>

                                            {/* ã‚¿ã‚° */}
                                            <div className="mb-6">
                                                <h3 className="text-sm font-semibold text-gray-600 mb-3">é–¢é€£ã‚¿ã‚°</h3>
                                                <div className="flex flex-wrap gap-2">
                                                    {(selectedArticle.tags || []).map((tag, index) => (
                                                        <span
                                                            key={index}
                                                            className="px-3 py-1.5 bg-blue-100 text-blue-700 text-sm rounded-full font-medium hover:bg-blue-200 transition-colors cursor-pointer"
                                                            onClick={() => {
                                                                handleTagClick(tag);
                                                                setShowArticleDetail(false);
                                                                setCurrentView('map');
                                                            }}
                                                        >
                                                            #{tag}
                                                        </span>
                                                    ))}
                                                </div>
                                            </div>

                                            {/* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ */}
                                            <div className="flex justify-center pt-4 border-t">
                                                <button
                                                    onClick={() => setShowArticleDetail(false)}
                                                    className="px-6 py-3 border border-gray-300 hover:border-gray-400 text-gray-700 rounded-lg font-medium transition-colors"
                                                >
                                                    é–‰ã˜ã‚‹
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}
                        <header className="bg-white shadow-sm border-b relative">
                            <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                                <div className="flex items-center justify-center h-16 relative">
                                    <h1 className="text-lg font-medium text-gray-900">ãŠæ°—ã«å…¥ã‚Šé›†ç´„</h1>
                                    <button
                                        onClick={() => setShowAiHelp(!showAiHelp)}
                                        className="absolute right-0 w-8 h-8 bg-gray-100 hover:bg-gray-200 rounded-full flex items-center justify-center text-sm font-bold text-gray-600 transition-colors"
                                        title="AIè¦ç´„ã«ã¤ã„ã¦"
                                    >
                                        i
                                    </button>
                                </div>

                                {/* AIãƒ˜ãƒ«ãƒ—ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— */}
                                {showAiHelp && (
                                    <div className="absolute top-full right-4 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg p-4 w-80 z-30">
                                        <div className="flex justify-between items-start mb-3">
                                            <h4 className="font-semibold text-gray-900">AIè¦ç´„æ©Ÿèƒ½ã«ã¤ã„ã¦</h4>
                                            <button
                                                onClick={() => setShowAiHelp(false)}
                                                className="text-gray-400 hover:text-gray-600 ml-2"
                                            >
                                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                    <path d="M12 4L4 12M4 4l8 8" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"/>
                                                </svg>
                                            </button>
                                        </div>
                                        <div className="text-sm text-gray-600 space-y-2">
                                            <p>å„ãƒ¬ãƒãƒ¼ãƒˆã«ã¯è¦ç´„æ©Ÿèƒ½ãŒã‚ã‚Šã¾ã™ï¼š</p>
                                            <ul className="list-disc pl-4 space-y-1">
                                                <li>ãƒ¬ãƒãƒ¼ãƒˆã‚’é–‹ãã¨ã€é–¢é€£è¨˜äº‹ã®è¦ç´„ãŒè‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã™</li>
                                                <li>è¤‡æ•°ã®è¨˜äº‹ã‹ã‚‰ä¸»è¦ãªãƒã‚¤ãƒ³ãƒˆã‚’æŠ½å‡ºã—ã¾ã™</li>
                                                <li>åŠ¹ç‡çš„ã«æƒ…å ±ã‚’æŠŠæ¡ã§ãã¾ã™</li>
                                            </ul>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </header>

                        {/* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */}
                        <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                            {/* é›†ç´„ãƒ¬ãƒãƒ¼ãƒˆ ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */}
                            <div className="mb-8">
                                <h2 className="text-xl font-bold text-gray-900 mb-6">ãƒ¬ãƒãƒ¼ãƒˆ</h2>
                                {favoriteReports.length === 0 ? (
                                <div className="text-center py-12">
                                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1" className="mx-auto mb-4 text-gray-300">
                                        <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/>
                                    </svg>
                                    <h3 className="text-lg font-medium text-gray-900 mb-2">ãŠæ°—ã«å…¥ã‚Šãƒ¬ãƒãƒ¼ãƒˆãŒã‚ã‚Šã¾ã›ã‚“</h3>
                                    <p className="text-gray-500">ãƒ¬ãƒãƒ¼ãƒˆã®ãƒ”ãƒ³ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦è¿½åŠ ã§ãã¾ã™</p>
                                </div>
                            ) : (
                                    <div className="space-y-3">
                                    {favoriteReports.map((report, index) => (
                                        <div
                                            key={report.id || index}
                                            className="bg-white rounded-xl border border-gray-200 p-4 hover:shadow-md hover:border-blue-200 transition-all cursor-pointer"
                                            onClick={() => {
                                                // ãƒ¬ãƒãƒ¼ãƒˆã‚’å†ç¾ã—ã¦ãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹
                                                setSelectedTags(report.tags || []);
                                                setPreviousView('favoritesList'); // ãŠæ°—ã«å…¥ã‚Šãƒªã‚¹ãƒˆã‹ã‚‰æ¥ãŸã“ã¨ã‚’è¨˜éŒ²
                                                setShowFavorites(true);
                                                setCurrentView('map');
                                            }}
                                        >
                                                <div className="flex items-center justify-between">
                                                    <div className="flex items-center flex-1">
                                                        <span className="text-lg font-medium text-gray-900">
                                                            {(report.tags || []).join(' Ã— ') || 'ç„¡é¡Œã®ãƒ¬ãƒãƒ¼ãƒˆ'}
                                                        </span>
                                                    </div>
                                                    <div className="flex items-center space-x-3 ml-4">
                                                        {/* æ™‚è¨ˆã‚¢ã‚¤ã‚³ãƒ³ */}
                                                        <button
                                                            className="p-2 text-gray-400 hover:text-gray-600 transition-colors"
                                                            title="æœ€çµ‚æ›´æ–°æ—¥æ™‚"
                                                        >
                                                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                                                                <circle cx="12" cy="12" r="10"/>
                                                                <polyline points="12,6 12,12 16,14"/>
                                                            </svg>
                                                        </button>
                                                        {/* ã‚´ãƒŸç®±ã‚¢ã‚¤ã‚³ãƒ³ */}
                                                        <button
                                                            onClick={(e) => {
                                                                e.stopPropagation();
                                                                removeFromFavorites(report.id, e);
                                                            }}
                                                            className="p-2 text-gray-400 hover:text-red-500 transition-colors"
                                                            title="å‰Šé™¤"
                                                        >
                                                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                                                                <path d="M3 6h18M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6m3 0V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
                                                            </svg>
                                                        </button>
                                                    </div>
                                                </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                            </div>

                            {/* è¨˜äº‹ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */}
                            <div>
                                <div className="flex items-center justify-between mb-4">
                                    <h2 className="text-lg font-medium text-gray-900">è¨˜äº‹</h2>
                                    <div className="flex bg-gray-100 rounded-lg p-1 shadow-sm">
                                        <button
                                            onClick={() => setFavoritesViewMode('grid')}
                                            className={`p-1.5 rounded transition-all ${
                                                favoritesViewMode === 'grid'
                                                ? 'bg-white text-gray-900 shadow-sm'
                                                : 'text-gray-500 hover:text-gray-700'
                                            }`}
                                        >
                                            <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <rect x="1" y="1" width="5" height="5" rx="1" fill="currentColor"/>
                                                <rect x="8" y="1" width="5" height="5" rx="1" fill="currentColor"/>
                                                <rect x="1" y="8" width="5" height="5" rx="1" fill="currentColor"/>
                                                <rect x="8" y="8" width="5" height="5" rx="1" fill="currentColor"/>
                                            </svg>
                                        </button>
                                        <button
                                            onClick={() => setFavoritesViewMode('list')}
                                            className={`p-1.5 rounded transition-all ${
                                                favoritesViewMode === 'list'
                                                ? 'bg-white text-gray-900 shadow-sm'
                                                : 'text-gray-500 hover:text-gray-700'
                                            }`}
                                        >
                                            <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <rect x="1" y="2" width="12" height="1.5" rx="0.75" fill="currentColor"/>
                                                <rect x="1" y="6" width="12" height="1.5" rx="0.75" fill="currentColor"/>
                                                <rect x="1" y="10" width="12" height="1.5" rx="0.75" fill="currentColor"/>
                                            </svg>
                                        </button>
                                    </div>
                                </div>

                                {/* è¨˜äº‹è¡¨ç¤º */}
                                {(() => {
                                    const favoriteArticles = favoriteReports.filter(report => report.type === 'article');
                                    console.log('ãŠæ°—ã«å…¥ã‚Šè¨˜äº‹ä¸€è¦§:', favoriteArticles);

                                    if (favoritesViewMode === 'grid') {
                                        return (
                                            <div className="grid grid-cols-3 gap-2">
                                                {favoriteArticles.length === 0 ? (
                                                    <div className="col-span-3 text-center py-8 text-gray-500">
                                                        ãŠæ°—ã«å…¥ã‚Šè¨˜äº‹ãŒã‚ã‚Šã¾ã›ã‚“
                                                    </div>
                                                ) : (
                                                    favoriteArticles.map((report, index) => (
                                                        <div
                                                            key={report.id || index}
                                                            className="aspect-square bg-white border border-gray-200 rounded cursor-pointer hover:shadow-md transition-shadow overflow-hidden"
                                                            onClick={(e) => {
                                                                console.log('ãŠæ°—ã«å…¥ã‚Šè¨˜äº‹ã‚¯ãƒªãƒƒã‚¯:', report);
                                                                const article = report.articleData || {
                                                                    title: report.title?.replace('è¨˜äº‹: ', '') || 'ç„¡é¡Œã®è¨˜äº‹',
                                                                    tags: report.tags || [],
                                                                    snippet: 'è¨˜äº‹ã®è©³ç´°',
                                                                    source: 'ãŠæ°—ã«å…¥ã‚Š'
                                                                };
                                                                console.log('è¨˜äº‹ãƒ‡ãƒ¼ã‚¿:', article);
                                                                try {
                                                                    handleArticleRead(article, e);
                                                                } catch (error) {
                                                                    console.error('è¨˜äº‹è©³ç´°è¡¨ç¤ºã‚¨ãƒ©ãƒ¼:', error);
                                                                }
                                                            }}
                                                        >
                                                            <div className="h-full flex flex-col p-2">
                                                                <div className="flex-1 flex items-center justify-center bg-gray-100 rounded mb-2">
                                                                    <img
                                                                        src="https://s.yimg.jp/images/ksk/tool/img/photo01.png"
                                                                        alt={report.articleData?.title || 'Article'}
                                                                        className="w-full h-full object-cover rounded"
                                                                    />
                                                                </div>
                                                                <div className="text-xs text-gray-900 font-medium line-clamp-2">
                                                                    {report.articleData?.title || report.title?.replace('è¨˜äº‹: ', '')}
                                                                </div>
                                                            </div>
                                                        </div>
                                                    ))
                                                )}
                                            </div>
                                        );
                                    } else {
                                        // ãƒªã‚¹ãƒˆãƒ“ãƒ¥ãƒ¼
                                        return (
                                            <div className="space-y-3">
                                                {favoriteArticles.length === 0 ? (
                                                    <div className="text-center py-8 text-gray-500">
                                                        ãŠæ°—ã«å…¥ã‚Šè¨˜äº‹ãŒã‚ã‚Šã¾ã›ã‚“
                                                    </div>
                                                ) : (
                                                    favoriteArticles.map((report, index) => (
                                                        <div
                                                            key={report.id || index}
                                                            className="bg-white rounded-lg p-3 shadow-sm border hover:shadow-md transition-all cursor-pointer"
                                                            onClick={(e) => {
                                                                console.log('ãŠæ°—ã«å…¥ã‚Šè¨˜äº‹ã‚¯ãƒªãƒƒã‚¯:', report);
                                                                const article = report.articleData || {
                                                                    title: report.title?.replace('è¨˜äº‹: ', '') || 'ç„¡é¡Œã®è¨˜äº‹',
                                                                    tags: report.tags || [],
                                                                    snippet: 'è¨˜äº‹ã®è©³ç´°',
                                                                    source: 'ãŠæ°—ã«å…¥ã‚Š'
                                                                };
                                                                console.log('è¨˜äº‹ãƒ‡ãƒ¼ã‚¿:', article);
                                                                try {
                                                                    handleArticleRead(article, e);
                                                                } catch (error) {
                                                                    console.error('è¨˜äº‹è©³ç´°è¡¨ç¤ºã‚¨ãƒ©ãƒ¼:', error);
                                                                }
                                                            }}
                                                        >
                                                            <div className="flex gap-3">
                                                                <div className="w-16 h-16 bg-gray-100 rounded overflow-hidden flex-shrink-0">
                                                                    <img
                                                                        src="https://s.yimg.jp/images/ksk/tool/img/photo01.png"
                                                                        alt={report.articleData?.title || 'Article'}
                                                                        className="w-full h-full object-cover"
                                                                    />
                                                                </div>
                                                                <div className="flex-1 min-w-0">
                                                                    <h4 className="font-medium text-gray-900 line-clamp-2 mb-1">
                                                                        {report.articleData?.title || report.title?.replace('è¨˜äº‹: ', '')}
                                                                    </h4>
                                                                    <p className="text-sm text-gray-600 line-clamp-2 mb-2">
                                                                        {report.articleData?.snippet || 'è¨˜äº‹ã®è©³ç´°'}
                                                                    </p>
                                                                    <div className="flex items-center justify-between text-xs text-gray-400">
                                                                        <span>{report.articleData?.source || 'ã‚½ãƒ¼ã‚¹ä¸æ˜'}</span>
                                                                        <span>ãŠæ°—ã«å…¥ã‚Š</span>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    ))
                                                )}
                                            </div>
                                        );
                                    }
                                })()}
                            </div>
                        </main>

                        {/* ä¸‹éƒ¨ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */}
                        <nav className="fixed bottom-0 left-0 right-0 bg-white/20 backdrop-blur-sm border-t border-gray-200/30 shadow-lg z-50">
                            <div className="flex items-center justify-between px-4 py-2">
                                {/* å·¦å¯„ã›: ãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³ */}
                                <button
                                    onClick={() => setCurrentView('map')}
                                    className="w-10 h-10 rounded-full flex items-center justify-center transition-all bg-gray-100 text-gray-600 hover:bg-gray-200"
                                >
                                    <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path fillRule="evenodd" clipRule="evenodd" d="M17.3892 7.44191L10.4827 0.60791C9.66124 -0.20459 8.33874 -0.20459 7.51724 0.60791L0.614244 7.43891C0.221244 7.82741 0.000244141 8.35791 0.000244141 8.91091V16.9999C0.000244141 17.5524 0.447744 17.9999 1.00024 17.9999H7.00024V12.2499C7.00024 12.1119 7.11174 11.9999 7.25024 11.9999H10.7502C10.8882 11.9999 11.0002 12.1119 11.0002 12.2499V17.9999H17.0002C17.5522 17.9999 18.0002 17.5524 18.0002 16.9999V8.90591C18.0002 8.35591 17.7797 7.82891 17.3892 7.44191" fill="black" fillOpacity="0.73"/>
                                    </svg>
                                </button>

                                {/* å³å¯„ã›: ã‚«ãƒ¡ãƒ©ãƒ»éŸ³å£°ãƒ»ãƒãƒƒãƒ—ãƒœã‚¿ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ */}
                                <div className="flex items-center bg-gray-100 rounded-full px-1">
                                    {/* ã‚«ãƒ¡ãƒ©ãƒœã‚¿ãƒ³ */}
                                    <button
                                        onClick={() => setShowCameraMenu(!showCameraMenu)}
                                        className="w-10 h-10 rounded-full bg-white flex items-center justify-center text-gray-700 hover:bg-gray-50 transition-all mx-0.5"
                                    >
                                        <svg width="18" height="16" viewBox="0 0 18 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path fillRule="evenodd" clipRule="evenodd" d="M15.5 6C14.948 6 14.5 5.5525 14.5 4.999C14.5 4.4475 14.948 4 15.5 4C16.052 4 16.5 4.4475 16.5 4.999C16.5 5.5525 16.052 6 15.5 6M9 13.5C6.515 13.5 4.5 11.483 4.5 9C4.5 6.5165 6.515 4.5 9 4.5C11.483 4.5 13.5 6.5165 13.5 9C13.5 11.483 11.483 13.5 9 13.5M16 2H13.5L11.793 0.293C11.6055 0.1055 11.351 0 11.0855 0H6.9145C6.649 0 6.3945 0.1055 6.207 0.293L4.5 2H2C0.9 2 0 2.9 0 4V14C0 15.1 0.9 16 2 16H16C17.1 16 18 15.1 18 14V4C18 2.9 17.1 2 16 2M9 6.30005C7.511 6.30005 6.3 7.51105 6.3 9.00005C6.3 10.4886 7.511 11.7001 9 11.7001C10.489 11.7001 11.7 10.4886 11.7 9.00005C11.7 7.51105 10.489 6.30005 9 6.30005" fill="black" fillOpacity="0.73"/>
                                        </svg>
                                    </button>

                                    {/* éŸ³å£°ãƒœã‚¿ãƒ³ */}
                                    <button
                                        onClick={() => setShowVoiceMenu(!showVoiceMenu)}
                                        className="w-10 h-10 rounded-full bg-white flex items-center justify-center text-gray-700 hover:bg-gray-50 transition-all mx-0.5"
                                    >
                                        <svg width="12" height="20" viewBox="0 0 12 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M1.5 9.5V10.5C1.5 12.9815 3.519 15 6 15C8.481 15 10.5 12.9815 10.5 10.5V9.5H12V10.5C12 13.4675 9.83297 15.9312 7 16.4092V18H8.75C9.1645 18 9.5 18.3355 9.5 18.75C9.5 19.1645 9.1645 19.5 8.75 19.5H3.25C2.8355 19.5 2.5 19.1645 2.5 18.75C2.5 18.3355 2.8355 18 3.25 18H5V16.4092C2.16703 15.9312 0 13.4675 0 10.5V9.5H1.5ZM6 0.5C7.6565 0.5 9 1.8435 9 3.5V10.5C9 12.1565 7.6565 13.5 6 13.5C4.3435 13.5 3 12.1565 3 10.5V3.5C3 1.8435 4.3435 0.5 6 0.5Z" fill="black" fillOpacity="0.73"/>
                                        </svg>
                                    </button>

                                    {/* ãŠæ°—ã«å…¥ã‚Šãƒªã‚¹ãƒˆãƒœã‚¿ãƒ³ï¼ˆã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ï¼‰ */}
                                    <button
                                        onClick={() => {
                                            try {
                                                console.log('ãŠæ°—ã«å…¥ã‚Šãƒšãƒ¼ã‚¸ã§ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ã€ãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹');
                                                setCurrentView('map');
                                            } catch (error) {
                                                console.error('ãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸æˆ»ã‚Šã‚¨ãƒ©ãƒ¼:', error);
                                            }
                                        }}
                                        className="w-10 h-10 rounded-full bg-blue-500 hover:bg-blue-600 flex items-center justify-center text-white transition-all mx-0.5 relative"
                                        title="ãŠæ°—ã«å…¥ã‚Šãƒªã‚¹ãƒˆï¼ˆãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹ï¼‰"
                                    >
                                        <svg width="16" height="20" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                            <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/>
                                        </svg>
                                        {favoriteReports.length > 0 && (
                                            <div className="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">
                                                {favoriteReports.length}
                                            </div>
                                        )}
                                    </button>
                                </div>
                            </div>
                        </nav>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gray-50">
                    <ParticleSystem />
                    
                    {/* è¨˜äº‹è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ« */}
                    {console.log('ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºãƒã‚§ãƒƒã‚¯:', { showArticleDetail, selectedArticle: !!selectedArticle, currentView })}
                    {showArticleDetail && selectedArticle && (
                        <div className="fixed inset-0 bg-black/50 backdrop-blur-sm z-[60] flex items-center justify-center p-4">
                            <div className="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden shadow-2xl">
                                {/* å›ºå®šãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆé–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ã®ã¿ï¼‰ */}
                                <div className="absolute top-0 left-0 right-0 z-10 p-4 flex justify-end">
                                    <button
                                        onClick={() => {
                                            setShowArticleDetail(false);
                                            // å‰ã®ç”»é¢ã«æˆ»ã‚‹
                                            if (previousView === 'favorites') {
                                                setShowFavorites(true);
                                            } else if (previousView === 'favoritesList') {
                                                setCurrentView('favorites');
                                            }
                                            // ãƒ¡ã‚¤ãƒ³ç”»é¢ã®å ´åˆã¯ä½•ã‚‚ã—ãªã„ï¼ˆæ—¢ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ï¼‰
                                            setPreviousView(null); // ãƒªã‚»ãƒƒãƒˆ
                                        }}
                                        className="w-10 h-10 bg-black/20 hover:bg-black/40 rounded-full flex items-center justify-center text-white transition-all"
                                    >
                                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M15 5L5 15M5 5l10 10" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
                                        </svg>
                                    </button>
                                </div>

                                {/* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ãªã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */}
                                <div className="overflow-y-auto max-h-[90vh]">
                                    {/* è¨˜äº‹ç”»åƒ */}
                                    <div className="relative">
                                        <div className="h-48 bg-gradient-to-br from-blue-500 to-purple-600 relative overflow-hidden">
                                            <img 
                                                src="https://s.yimg.jp/images/ksk/tool/img/photo01.png" 
                                                alt={selectedArticle.title}
                                                className="w-full h-full object-cover opacity-80"
                                            />
                                            <div className="absolute inset-0 bg-gradient-to-t from-black/40 to-transparent"></div>
                                            
                                            {/* è©±é¡Œåº¦ãƒãƒƒã‚¸ */}
                                            <div className={`absolute top-4 left-4 px-3 py-1 rounded-full text-white text-sm font-medium ${
                                                selectedArticle.topicalityScore >= 80 ? 'bg-red-500' : 
                                                selectedArticle.topicalityScore >= 60 ? 'bg-orange-500' : 
                                                selectedArticle.topicalityScore >= 40 ? 'bg-yellow-500' : 'bg-gray-500'
                                            }`}>
                                                è©±é¡Œåº¦ {Math.round(selectedArticle.topicalityScore)}
                                            </div>
                                        </div>
                                    </div>

                                    {/* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */}
                                    <div className="p-6">
                                    {/* ã‚¿ã‚¤ãƒˆãƒ« */}
                                    <h1 className="text-2xl font-bold text-gray-900 mb-4 leading-tight">
                                        {selectedArticle.title}
                                    </h1>
                                    
                                    {/* ãƒ¡ã‚¿æƒ…å ± */}
                                    <div className="flex items-center gap-4 mb-6 text-sm text-gray-500">
                                        <span className="flex items-center gap-2">
                                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M8 0C3.6 0 0 3.6 0 8s3.6 8 8 8 8-3.6 8-8-3.6-8-8-8zm0 14c-3.3 0-6-2.7-6-6s2.7-6 6-6 6 2.7 6 6-2.7 6-6 6zm1-10H7v5l4 2.4.8-1.2-3.8-2.2V4z" fill="currentColor"/>
                                            </svg>
                                            {new Date().toLocaleDateString('ja-JP')}
                                        </span>
                                        <span className="flex items-center gap-2">
                                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M2 4.5C2 3.67157 2.67157 3 3.5 3H12.5C13.3284 3 14 3.67157 14 4.5V11.5C14 12.3284 13.3284 13 12.5 13H3.5C2.67157 13 2 12.3284 2 11.5V4.5ZM3.5 4C3.22386 4 3 4.22386 3 4.5V5.5L8 8.5L13 5.5V4.5C13 4.22386 12.7761 4 12.5 4H3.5ZM13 6.5L8 9.5L3 6.5V11.5C3 11.7761 3.22386 12 3.5 12H12.5C12.7761 12 13 11.7761 13 11.5V6.5Z" fill="currentColor"/>
                                            </svg>
                                            {selectedArticle.source}
                                        </span>
                                    </div>
                                    
                                    {/* è¨˜äº‹æœ¬æ–‡ */}
                                    <div className="prose max-w-none mb-6">
                                        <p className="text-gray-700 leading-relaxed text-base mb-4">
                                            {selectedArticle.snippet}
                                        </p>
                                        
                                        {/* è©³ç´°å†…å®¹ï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰ */}
                                        <p className="text-gray-700 leading-relaxed text-base mb-4">
                                            ã“ã®è¨˜äº‹ã§ã¯ã€{selectedArticle.title}ã«ã¤ã„ã¦è©³ã—ãè§£èª¬ã—ã¾ã™ã€‚æœ€æ–°ã®å‹•å‘ã‚„æŠ€è¡“çš„ãªè©³ç´°ã€ä»Šå¾Œã®å±•æœ›ã«ã¤ã„ã¦ã‚‚è§¦ã‚ŒãªãŒã‚‰ã€èª­è€…ã®çš†æ§˜ã«ã¨ã£ã¦æœ‰ç›Šãªæƒ…å ±ã‚’ãŠå±Šã‘ã—ã¾ã™ã€‚
                                        </p>
                                        
                                        <p className="text-gray-700 leading-relaxed text-base mb-4">
                                            {selectedArticle.tags.includes('AI') && 'AIæŠ€è¡“ã®é€²æ­©ã«ã‚ˆã‚Šã€ç§ãŸã¡ã®ç”Ÿæ´»ã¯å¤§ããå¤‰åŒ–ã—ã¦ã„ã¾ã™ã€‚'}
                                            {selectedArticle.tags.includes('æŠ€è¡“') && 'ã“ã®æŠ€è¡“é©æ–°ã¯ã€ç”£æ¥­ç•Œå…¨ä½“ã«å½±éŸ¿ã‚’ä¸ãˆã¦ã„ã¾ã™ã€‚'}
                                            {selectedArticle.tags.includes('ãƒ“ã‚¸ãƒã‚¹') && 'ãƒ“ã‚¸ãƒã‚¹ã®ä¸–ç•Œã§ã¯ã€æ–°ã—ã„ãƒ“ã‚¸ãƒã‚¹ãƒ¢ãƒ‡ãƒ«ãŒæ¬¡ã€…ã¨ç”Ÿã¾ã‚Œã¦ã„ã¾ã™ã€‚'}
                                            {selectedArticle.tags.includes('æ–™ç†') && 'é£Ÿæ–‡åŒ–ã®å¤šæ§˜æ€§ã¨ä¼çµ±ã®ç¶™æ‰¿ã«ã¤ã„ã¦è€ƒãˆã‚‹æ©Ÿä¼šã¨ãªã‚Šã¾ã™ã€‚'}
                                            ä»Šå¾Œã®å‹•å‘ã«ã‚‚æ³¨ç›®ã—ã¦ã„ãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
                                        </p>
                                    </div>
                                    
                                    {/* ã‚¿ã‚° */}
                                    <div className="mb-6">
                                        <h3 className="text-sm font-semibold text-gray-600 mb-3">é–¢é€£ã‚¿ã‚°</h3>
                                        <div className="flex flex-wrap gap-2">
                                            {selectedArticle.tags.map(tag => (
                                                <span
                                                    key={tag}
                                                    className="px-3 py-1.5 bg-blue-100 text-blue-700 text-sm rounded-full font-medium hover:bg-blue-200 transition-colors cursor-pointer"
                                                    onClick={() => {
                                                        handleTagClick(tag);
                                                        setShowArticleDetail(false);
                                                        setCurrentView('map');
                                                    }}
                                                >
                                                    #{tag}
                                                </span>
                                            ))}
                                        </div>
                                    </div>
                                    
                                    {/* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ */}
                                    <div className="flex justify-center pt-4 border-t">
                                        <button
                                            onClick={() => setShowArticleDetail(false)}
                                            className="px-6 py-3 border border-gray-300 hover:border-gray-400 text-gray-700 rounded-lg font-medium transition-colors"
                                        >
                                            é–‰ã˜ã‚‹
                                        </button>
                                    </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* ãŠæ°—ã«å…¥ã‚Šé›†ç´„ãƒšãƒ¼ã‚¸ */}
                    {showFavorites && (
                        <div className="fixed inset-0 bg-white z-50 overflow-y-auto">
                            {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}
                            <div className="bg-white border-b border-gray-200 sticky top-0 z-10 relative">
                                <div className="flex items-center justify-between p-4">
                                    {/* å·¦å´ï¼šé–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ */}
                                    <button
                                        onClick={() => {
                                            console.log('é›†ç´„ãƒ¬ãƒãƒ¼ãƒˆé–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ã€previousView:', previousView);
                                            setShowFavorites(false);
                                            // å‰ã®ç”»é¢ã«æˆ»ã‚‹
                                            if (previousView === 'favoritesList') {
                                                console.log('ãŠæ°—ã«å…¥ã‚Šãƒªã‚¹ãƒˆã«æˆ»ã‚‹');
                                                setCurrentView('favorites');
                                                setPreviousView(null);
                                            } else if (previousView === 'main') {
                                                console.log('ãƒãƒƒãƒ—ãƒ“ãƒ¥ãƒ¼ã«æˆ»ã‚‹');
                                                setCurrentView('map');
                                                setPreviousView(null);
                                            } else {
                                                console.log('ãƒ¡ã‚¤ãƒ³ç”»é¢ã«æˆ»ã‚‹');
                                            }
                                        }}
                                        className="w-10 h-10 rounded-full bg-gray-200 hover:bg-gray-300 flex items-center justify-center transition-colors"
                                    >
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                            <line x1="18" y1="6" x2="6" y2="18"></line>
                                            <line x1="6" y1="6" x2="18" y2="18"></line>
                                        </svg>
                                    </button>

                                    {/* ä¸­å¤®ï¼šé›†ç´„ãƒ¬ãƒãƒ¼ãƒˆãƒ©ãƒ™ãƒ«ã¨ã‚¿ã‚° */}
                                    <div className="flex-1 flex flex-col items-center">
                                        <div className="flex items-center gap-3">
                                            <div className="text-lg font-medium text-gray-900">
                                                {selectedTags.length > 0 ? selectedTags.join(' Ã— ') : 'æœªé¸æŠ'}
                                            </div>
                                            {/* ãŠæ°—ã«å…¥ã‚Šãƒœã‚¿ãƒ³ */}
                                            <button
                                                onClick={(e) => {
                                                    e.stopPropagation();
                                                    toggleFavorites({
                                                        title: `é›†ç´„ãƒ¬ãƒãƒ¼ãƒˆ: ${selectedTags.join(' Ã— ')}`,
                                                        type: 'aggregated',
                                                        tags: selectedTags,
                                                        articleCount: getMapFilteredArticles().length
                                                    }, e);
                                                }}
                                                className={`w-8 h-8 rounded-full flex items-center justify-center transition-colors ${
                                                    isFavorite({
                                                        title: `é›†ç´„ãƒ¬ãƒãƒ¼ãƒˆ: ${selectedTags.join(' Ã— ')}`,
                                                        type: 'aggregated',
                                                        tags: selectedTags
                                                    }) ? 'text-blue-600' : 'text-gray-400 hover:text-gray-600'
                                                }`}
                                                title={isFavorite({
                                                    title: `é›†ç´„ãƒ¬ãƒãƒ¼ãƒˆ: ${selectedTags.join(' Ã— ')}`,
                                                    type: 'aggregated',
                                                    tags: selectedTags
                                                }) ? "ãŠæ°—ã«å…¥ã‚Šã‹ã‚‰å‰Šé™¤" : "ãŠæ°—ã«å…¥ã‚Šã«è¿½åŠ "}
                                            >
                                                <svg width="16" height="16" viewBox="0 0 24 24" fill={isFavorite({
                                                    title: `é›†ç´„ãƒ¬ãƒãƒ¼ãƒˆ: ${selectedTags.join(' Ã— ')}`,
                                                    type: 'aggregated',
                                                    tags: selectedTags
                                                }) ? "currentColor" : "none"} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                                    <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/>
                                                </svg>
                                            </button>
                                        </div>
                                    </div>

                                    {/* å³å´ï¼šã‚¹ãƒšãƒ¼ã‚¹ */}
                                    <div className="w-10 h-10"></div>
                                </div>
                                
                                {/* AIãƒ˜ãƒ«ãƒ—ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— */}
                                {showAiHelp && (
                                    <div className="absolute top-full right-4 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg p-4 w-80 z-30">
                                        <div className="flex justify-between items-start mb-3">
                                            <h4 className="font-semibold text-gray-900">AIè¦ç´„æ©Ÿèƒ½ã«ã¤ã„ã¦</h4>
                                            <button
                                                onClick={() => setShowAiHelp(false)}
                                                className="text-gray-400 hover:text-gray-600"
                                            >
                                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                    <path d="M12 4L4 12M4 4l8 8" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"/>
                                                </svg>
                                            </button>
                                        </div>
                                        <p className="text-sm text-gray-600 leading-relaxed">
                                            é¸æŠã•ã‚ŒãŸã‚¿ã‚°ã«é–¢é€£ã™ã‚‹è¨˜äº‹ã‹ã‚‰ã€æœ€æ–°ã®ãƒˆãƒ¬ãƒ³ãƒ‰ã¨é‡è¦ãªãƒã‚¤ãƒ³ãƒˆã‚’æŠ½å‡ºã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚‰ã®åˆ†é‡ã§ã®æƒ…å ±ã‚„å‹•å‘ã«ã¤ã„ã¦ã€åŒ…æ‹¬çš„ãªè¦–ç‚¹ã§åˆ†æã—ã€è¦ç´„ã‚’ç”Ÿæˆã—ã¦ã„ã¾ã™ã€‚
                                        </p>
                                    </div>
                                )}
                            </div>

                            {/* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */}
                            <div className="py-4">
                                {selectedTags.length > 0 ? (
                                    <>
                                        {/* é¸æŠã‚¿ã‚°ã®è¦ç´„ */}
                                        <div className="bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg mx-4 px-4 mb-4">
                                            <div className="mb-3">
                                                <div className="flex-1">
                                                </div>
                                            </div>
                                        </div>

                                        {/* ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚¿ãƒ– */}
                                        <div className="mb-4">
                                            <div className="flex gap-2 overflow-x-auto pb-2 px-4">
                                                {(() => {
                                                    // é¸æŠã‚¿ã‚°ã«å¿œã˜ãŸã‚«ãƒ†ã‚´ãƒªãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’å‹•çš„ã«ç”Ÿæˆ
                                                    if (selectedTags.includes('æ—…è¡Œ') || selectedTags.includes('æ²–ç¸„')) {
                                                        return ['ãƒ—ãƒ©ãƒ³', 'ã‚°ãƒ«ãƒ¡', 'è¦³å…‰', 'å†™çœŸ', 'ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£'];
                                                    } else if (selectedTags.includes('æ–™ç†') || selectedTags.includes('å’Œé£Ÿ')) {
                                                        return ['ãƒ¬ã‚·ãƒ”', 'ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³', 'é£Ÿæ', 'èª¿ç†æ³•', 'æ „é¤Š'];
                                                    } else if (selectedTags.includes('AI') || selectedTags.includes('æŠ€è¡“')) {
                                                        return ['ãƒˆãƒ¬ãƒ³ãƒ‰', 'ãƒ„ãƒ¼ãƒ«', 'äº‹ä¾‹', 'å­¦ç¿’', 'ç ”ç©¶'];
                                                    } else if (selectedTags.includes('ãƒ“ã‚¸ãƒã‚¹')) {
                                                        return ['æˆ¦ç•¥', 'ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°', 'äº‹ä¾‹', 'ãƒ„ãƒ¼ãƒ«', 'ãƒ‹ãƒ¥ãƒ¼ã‚¹'];
                                                    } else if (selectedTags.includes('å‹•ç‰©') || selectedTags.includes('ãƒšãƒƒãƒˆ')) {
                                                        return ['é£¼è‚²', 'å¥åº·', 'ç”¨å“', 'ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°', 'ç¨®é¡'];
                                                    } else if (selectedTags.includes('ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³')) {
                                                        return ['ãƒˆãƒ¬ãƒ³ãƒ‰', 'ãƒ–ãƒ©ãƒ³ãƒ‰', 'ã‚³ãƒ¼ãƒ‡', 'ã‚¢ã‚¤ãƒ†ãƒ ', 'ã‚»ãƒ¼ãƒ«'];
                                                    } else {
                                                        return ['ãŠã™ã™ã‚', 'ãƒˆãƒ¬ãƒ³ãƒ‰', 'ãƒ‹ãƒ¥ãƒ¼ã‚¹', 'ã‚¬ã‚¤ãƒ‰', 'ãƒ¬ãƒ“ãƒ¥ãƒ¼'];
                                                    }
                                                })().map((category, index) => (
                                                    <button
                                                        key={category}
                                                        className={`px-4 py-2 rounded-full whitespace-nowrap transition-all ${
                                                            index === 0 
                                                                ? 'bg-blue-600 text-white'
                                                                : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                                                        }`}
                                                    >
                                                        {category}
                                                    </button>
                                                ))}
                                            </div>
                                        </div>

                                        {/* é–¢é€£è¨˜äº‹ */}
                                        <div>
                                            {/* ãƒˆãƒƒãƒ—5è¨˜äº‹ï¼ˆã‚«ãƒ«ãƒ¼ã‚»ãƒ«ï¼‰ */}
                                            <div className="mb-6">
                                                <h3 className="text-lg font-semibold text-gray-900 mb-3 mx-4">æ³¨ç›®è¨˜äº‹</h3>
                                                <div className="flex gap-4 overflow-x-auto pb-4 scrollbar-hide pl-4">
                                                    {getMapFilteredArticles().slice(0, 5).map((article, index) => (
                                                        <div
                                                            key={index}
                                                            className={`flex-shrink-0 w-72 bg-white rounded-lg border border-gray-200 overflow-hidden hover:shadow-lg transition-shadow cursor-pointer ${index === 4 ? 'mr-4' : ''}`}
                                                            onClick={(e) => {
                                                                console.log('ã‚«ãƒ«ãƒ¼ã‚»ãƒ«è¨˜äº‹ã‚¯ãƒªãƒƒã‚¯:', article.title);
                                                                handleArticleRead(article, e);
                                                            }}
                                                        >
                                                            <div className="aspect-video bg-gray-200 relative">
                                                                <img 
                                                                    src="https://s.yimg.jp/images/ksk/tool/img/photo01.png"
                                                                    alt={article.title}
                                                                    className="w-full h-full object-cover"
                                                                />
                                                                <div className="absolute top-2 right-2 bg-black/70 text-white px-2 py-1 rounded text-xs">
                                                                    #{index + 1}
                                                                </div>
                                                            </div>
                                                            <div className="p-4">
                                                                <h3 className="font-semibold text-gray-900 mb-2 line-clamp-2">
                                                                    {article.title}
                                                                </h3>
                                                                <p className="text-sm text-gray-600 mb-3 line-clamp-2">
                                                                    {article.snippet}
                                                                </p>
                                                                <div className="flex items-center justify-between text-xs text-gray-400">
                                                                    <span>{article.source}</span>
                                                                    <span>è©±é¡Œåº¦: {Math.round(article.topicalityScore)}</span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>

                                            {/* æ®‹ã‚Šã®è¨˜äº‹ï¼ˆãƒªã‚¹ãƒˆï¼‰ */}
                                            {getMapFilteredArticles().length > 5 && (
                                                <div className="mx-4">
                                                    <h3 className="text-lg font-semibold text-gray-900 mb-3">ãã®ä»–ã®è¨˜äº‹</h3>
                                                    <div className="space-y-3">
                                                        {getMapFilteredArticles().slice(5).map((article, index) => (
                                                            <div
                                                                key={index + 5}
                                                                className="bg-white rounded-lg border border-gray-200 p-4 hover:shadow-md transition-shadow cursor-pointer"
                                                                onClick={(e) => {
                                                                    console.log('ãƒªã‚¹ãƒˆè¨˜äº‹ã‚¯ãƒªãƒƒã‚¯:', article.title);
                                                                    handleArticleRead(article, e);
                                                                }}
                                                            >
                                                                <div className="flex gap-4">
                                                                    <div className="w-20 h-20 bg-gray-200 rounded-lg overflow-hidden flex-shrink-0">
                                                                        <img 
                                                                            src="https://s.yimg.jp/images/ksk/tool/img/photo01.png"
                                                                            alt={article.title}
                                                                            className="w-full h-full object-cover"
                                                                        />
                                                                    </div>
                                                                    <div className="flex-1 min-w-0">
                                                                        <div className="flex items-start justify-between mb-2">
                                                                            <h4 className="font-medium text-gray-900 line-clamp-2 flex-1">
                                                                                {article.title}
                                                                            </h4>
                                                                        </div>
                                                                        <p className="text-sm text-gray-600 mb-2 line-clamp-1">
                                                                            {article.snippet}
                                                                        </p>
                                                                        <div className="flex items-center justify-between text-xs text-gray-400">
                                                                            <span>{article.source}</span>
                                                                            <span>è©±é¡Œåº¦: {Math.round(article.topicalityScore)}</span>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    </>
                                ) : (
                                    /* ã‚¿ã‚°æœªé¸æŠæ™‚ã®è¡¨ç¤º */
                                    <div className="text-center py-16 mx-4">
                                        <div className="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                            <svg width="32" height="26" viewBox="0 0 22 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path fillRule="evenodd" clipRule="evenodd" d="M20.4119 1.54257C18.2944 -0.514191 14.8606 -0.514191 12.7426 1.54257L11.0003 3.23455L9.25744 1.54257C7.13997 -0.514191 3.70618 -0.514191 1.5881 1.54257C-0.529368 3.59754 -0.529368 6.93108 1.5881 8.98665L3.33158 10.6792L3.33097 10.6798L10.7834 17.9127C10.9025 18.0291 11.0975 18.0291 11.2172 17.9127L11.8528 17.2953C11.8534 17.2953 11.8534 17.2953 11.8534 17.2947L18.669 10.6798L18.6684 10.6792L20.4119 8.98665C22.5294 6.93108 22.5294 3.59754 20.4119 1.54257Z" fill="#d1d5db"/>
                                            </svg>
                                        </div>
                                        <h3 className="text-lg font-medium text-gray-900 mb-2">ã‚¿ã‚°ã‚’é¸æŠã—ã¦ãã ã•ã„</h3>
                                        <p className="text-gray-600 mb-6">ãƒãƒƒãƒ—ã§ã‚¿ã‚°ã‚’é¸æŠã™ã‚‹ã¨ã€é–¢é€£è¨˜äº‹ã®é›†ç´„ãƒ¬ãƒãƒ¼ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™</p>
                                        <button
                                            onClick={() => {
                                                setShowFavorites(false);
                                                setCurrentView('map');
                                            }}
                                            className="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-colors"
                                        >
                                            ãƒãƒƒãƒ—ã«æˆ»ã‚‹
                                        </button>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}

                    <main className="max-w-6xl mx-auto p-4 relative z-10 pb-20">
                        {/* ãƒãƒƒãƒ—ãƒ“ãƒ¥ãƒ¼ï¼šå…¨ç”»é¢ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */}
                        {currentView === 'map' && (
                            <div className="fixed inset-0 top-0 bg-gray-50">
                                {/* ãƒãƒƒãƒ—ã‚¨ãƒªã‚¢ï¼ˆä¸ŠåŠåˆ†ï¼‰ */}
                                <div 
                                    className="relative"
                                    style={{ height: `${100 - mapArticleAreaHeight}vh` }}
                                >
                                    
                                    <div 
                                        id="map-container" 
                                        className="w-full h-full bg-gray-900 relative"
                                    >
                                        <svg 
                                            id="mapSvg" 
                                            className="w-full h-full network-bg"
                                        ></svg>
                                        

                                        {/* ãƒãƒ©ãƒ³ã‚¹ãƒãƒ¼ (ãƒãƒƒãƒ—ä¸‹éƒ¨) */}
                                        <div className="absolute bottom-2 left-6 right-6 z-10">
                                            <div className="flex items-center gap-3">
                                                <input
                                                    type="range"
                                                    min="0"
                                                    max="100"
                                                    value={interestDepth}
                                                    onChange={(e) => setInterestDepth(Number(e.target.value))}
                                                    className="flex-1 h-2 bg-gray-300 rounded-full appearance-none cursor-pointer slider-thumb balance-bar-bg"
                                                />
                                                <button
                                                    onClick={() => setShowBalanceInfo(!showBalanceInfo)}
                                                    className="w-8 h-8 bg-black text-white rounded-full flex items-center justify-center hover:bg-gray-800 transition-colors border-2 border-white/30 hover:border-white/50"
                                                >
                                                    <span className="text-sm font-bold">!</span>
                                                </button>
                                            </div>
                                            
                                            {/* æƒ…å ±ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— */}
                                            {showBalanceInfo && (
                                                <div className="absolute bottom-12 right-0 bg-black text-white p-4 rounded-lg shadow-lg w-80 text-sm">
                                                    <div className="mb-3">
                                                        {(() => {
                                                            const depthInfo = getDepthInfo(interestDepth);
                                                            return (
                                                                <>
                                                                    <div className="font-semibold text-lg mb-2">{depthInfo.label} ({interestDepth}%)</div>
                                                                    <div className="text-gray-300">{depthInfo.description}</div>
                                                                </>
                                                            );
                                                        })()}
                                                    </div>
                                                    
                                                    <div className="space-y-2 text-xs">
                                                        <div className="flex items-center gap-2">
                                                            <span>ğŸ’œ</span>
                                                            <span className="text-purple-300">0-30%: ç§çš„èˆˆå‘³</span>
                                                        </div>
                                                        <div className="flex items-center gap-2">
                                                            <span>ğŸ’™</span>
                                                            <span className="text-blue-300">30-70%: ãƒãƒ©ãƒ³ã‚¹</span>
                                                        </div>
                                                        <div className="flex items-center gap-2">
                                                            <span>ğŸ’š</span>
                                                            <span className="text-green-300">70-100%: ãƒ‘ãƒ¼ã‚½ãƒŠãƒ«</span>
                                                        </div>
                                                    </div>
                                                    
                                                    <button
                                                        onClick={() => setShowBalanceInfo(false)}
                                                        className="absolute top-2 right-2 w-6 h-6 bg-gray-600 hover:bg-gray-500 rounded-full flex items-center justify-center text-xs"
                                                    >
                                                        Ã—
                                                    </button>
                                                </div>
                                            )}
                                        </div>

                                    </div>
                                </div>

                                {/* è¨˜äº‹ã‚¨ãƒªã‚¢ï¼ˆä¸‹åŠåˆ†ï¼‰ */}
                                <div 
                                    className="relative bg-white border-t-2 border-gray-200"
                                    style={{ 
                                        height: `${mapArticleAreaHeight}vh`,
                                        transition: isDragging ? 'none' : 'height 0.3s ease'
                                    }}
                                >
                                    {/* ãƒ‰ãƒ©ãƒƒã‚°ãƒãƒ³ãƒ‰ãƒ« */}
                                    <div 
                                        className="absolute top-0 left-0 right-0 h-6 flex items-center justify-center cursor-grab active:cursor-grabbing bg-gray-100 hover:bg-gray-200 transition-colors z-10"
                                        onMouseDown={(e) => {
                                            setIsDragging(true);
                                            const startY = e.clientY;
                                            const startHeight = mapArticleAreaHeight;

                                            const handleMouseMove = (e) => {
                                                const deltaY = startY - e.clientY;
                                                const newHeight = Math.min(Math.max(20, startHeight + (deltaY / window.innerHeight) * 100), 80);
                                                setMapArticleAreaHeight(newHeight);
                                            };

                                            const handleMouseUp = () => {
                                                setIsDragging(false);
                                                document.removeEventListener('mousemove', handleMouseMove);
                                                document.removeEventListener('mouseup', handleMouseUp);
                                            };

                                            document.addEventListener('mousemove', handleMouseMove);
                                            document.addEventListener('mouseup', handleMouseUp);
                                        }}
                                        onTouchStart={(e) => {
                                            setIsDragging(true);
                                            const startY = e.touches[0].clientY;
                                            const startHeight = mapArticleAreaHeight;

                                            const handleTouchMove = (e) => {
                                                const deltaY = startY - e.touches[0].clientY;
                                                const newHeight = Math.min(Math.max(20, startHeight + (deltaY / window.innerHeight) * 100), 80);
                                                setMapArticleAreaHeight(newHeight);
                                            };

                                            const handleTouchEnd = () => {
                                                setIsDragging(false);
                                                document.removeEventListener('touchmove', handleTouchMove);
                                                document.removeEventListener('touchend', handleTouchEnd);
                                            };

                                            document.addEventListener('touchmove', handleTouchMove);
                                            document.addEventListener('touchend', handleTouchEnd);
                                        }}
                                    >
                                        <div className="w-12 h-1 bg-gray-300 rounded-full"></div>
                                    </div>

                                    {/* ãƒ“ãƒ¥ãƒ¼åˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ï¼ˆå³ç«¯å›ºå®šï¼‰ */}
                                    <div className="absolute top-0 right-4 z-20 flex bg-gray-100 rounded-lg p-1 shadow-lg">
                                        <button
                                            onClick={() => setMapViewMode('grid')}
                                            className={`p-1.5 rounded transition-all ${
                                                mapViewMode === 'grid' 
                                                ? 'bg-white text-gray-900 shadow-sm' 
                                                : 'text-gray-500 hover:text-gray-700'
                                            }`}
                                        >
                                            <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <rect x="1" y="1" width="5" height="5" rx="1" fill="currentColor"/>
                                                <rect x="8" y="1" width="5" height="5" rx="1" fill="currentColor"/>
                                                <rect x="1" y="8" width="5" height="5" rx="1" fill="currentColor"/>
                                                <rect x="8" y="8" width="5" height="5" rx="1" fill="currentColor"/>
                                            </svg>
                                        </button>
                                        <button
                                            onClick={() => setMapViewMode('list')}
                                            className={`p-1.5 rounded transition-all ${
                                                mapViewMode === 'list' 
                                                ? 'bg-white text-gray-900 shadow-sm' 
                                                : 'text-gray-500 hover:text-gray-700'
                                            }`}
                                        >
                                            <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <rect x="1" y="2" width="12" height="1.5" rx="0.75" fill="currentColor"/>
                                                <rect x="1" y="6" width="12" height="1.5" rx="0.75" fill="currentColor"/>
                                                <rect x="1" y="10" width="12" height="1.5" rx="0.75" fill="currentColor"/>
                                            </svg>
                                        </button>
                                        <button
                                            onClick={() => {
                                                console.log('é›†ç´„ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯: ãƒãƒƒãƒ—ãƒ“ãƒ¥ãƒ¼ã‹ã‚‰');
                                                setPreviousView('main'); // ãƒãƒƒãƒ—ãƒ“ãƒ¥ãƒ¼ã‹ã‚‰æ¥ãŸã“ã¨ã‚’è¨˜éŒ²
                                                setShowFavorites(true);
                                            }}
                                            className="p-1.5 rounded transition-all text-gray-500 hover:text-blue-600"
                                            title="ãŠæ°—ã«å…¥ã‚Šé›†ç´„"
                                        >
                                            <svg width="16" height="17" viewBox="0 0 302 318" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M200.186 58.1534C199.13 58.0267 198.571 56.8128 199.194 55.9578L223.25 22.4859C227.198 17.0075 226.586 9.48138 221.815 4.71024C216.611 -0.49368 208.229 -0.694237 202.793 4.26691L148.041 54.1633C147.524 54.6383 146.722 54.6489 146.194 54.1739L105.819 18.1053C100.277 13.1547 91.8326 13.387 86.5864 18.6437C81.8153 23.4042 81.1186 30.8882 84.9292 36.451L98.641 56.4961C99.2321 57.3511 98.6832 58.5228 97.6593 58.66C33.4389 67.1995 0.420898 96.6603 0.420898 176.313C0.420898 260.536 37.3234 288.646 108.996 295.254C112.437 295.57 115.889 295.697 119.341 295.644C120.238 295.634 120.924 296.457 120.734 297.333L117.831 310.813C117.092 314.961 121.082 318.392 125.083 317.041L235.642 287.231C236.666 286.915 237.669 286.566 238.672 286.229L238.841 286.165C280.303 271.736 301.499 240.132 301.499 176.313C301.499 94.9819 267.098 65.9856 200.186 58.1534ZM255.709 222.483C252.183 231.329 247.327 237.715 240.403 242.571C224.802 253.538 196.375 258.647 150.955 258.647C105.534 258.647 77.1181 253.538 61.5168 242.571C54.6029 237.715 49.7368 231.318 46.2112 222.483C41.6828 211.125 39.3817 195.588 39.3817 176.313C39.3817 157.038 41.6828 141.511 46.2112 130.153C49.7368 121.308 54.5924 114.921 61.5168 110.066C77.1181 99.0881 105.544 93.9897 150.955 93.9897C196.365 93.9897 224.791 99.0881 240.403 110.066C247.317 114.921 252.183 121.308 255.709 130.153C260.237 141.511 262.538 157.038 262.538 176.313C262.538 195.588 260.237 211.125 255.709 222.483Z" fill="currentColor"/>
                                                <path d="M110.971 146.142C94.6836 146.142 91.2002 161.046 91.2002 176.32C91.2002 191.594 94.6836 206.499 110.971 206.499C127.258 206.499 130.742 191.594 130.742 176.32C130.742 161.046 127.258 146.142 110.971 146.142Z" fill="currentColor"/>
                                                <path d="M190.95 146.142C174.663 146.142 171.18 161.047 171.18 176.321C171.18 191.595 174.663 206.499 190.95 206.499C207.238 206.499 210.732 191.595 210.732 176.321C210.732 161.047 207.248 146.142 190.95 146.142Z" fill="currentColor"/>
                                            </svg>
                                        </button>
                                    </div>

                                    {/* è¨˜äº‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */}
                                    <div className="pt-11 pb-4 px-4 h-full overflow-y-auto">
                                        {/* ãƒ•ã‚£ãƒ«ã‚¿ãƒ˜ãƒƒãƒ€ãƒ¼ */}
                                        <div className="mb-3">
                                            {/* ãƒ•ã‚£ãƒ«ã‚¿è¡¨ç¤ºï¼ˆæ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«1è¡Œï¼‰ */}
                                            {selectedTags.length > 0 && (
                                                <div className="flex items-center gap-2 text-sm text-gray-500 overflow-x-auto scrollbar-hide">
                                                    <div className="flex gap-2 flex-nowrap">
                                                        {selectedTags.map(tag => (
                                                            <button
                                                                key={tag}
                                                                onClick={() => {
                                                                    const newTags = selectedTags.filter(t => t !== tag);
                                                                    setSelectedTags(newTags);
                                                                }}
                                                                className="px-2 py-1 bg-blue-100 hover:bg-blue-200 text-blue-600 rounded-full text-xs whitespace-nowrap flex-shrink-0 transition-colors cursor-pointer flex items-center gap-1"
                                                                title={`${tag}ã‚’å‰Šé™¤`}
                                                            >
                                                                {tag}
                                                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                                                                    <path d="M18 6L6 18M6 6l12 12"/>
                                                                </svg>
                                                            </button>
                                                        ))}
                                                        <button
                                                            onClick={() => setSelectedTags([])}
                                                            className="text-blue-600 hover:text-blue-800 text-xs whitespace-nowrap flex-shrink-0"
                                                        >
                                                            ã‚¯ãƒªã‚¢
                                                        </button>
                                                    </div>
                                                </div>
                                            )}
                                        </div>

                                        {/* è¨˜äº‹ä¸€è¦§ */}
                                        {mapViewMode === 'list' && (
                                            <div className="grid gap-3">
                                            {getMapFilteredArticles().map((article, index) => {
                                                const matchingTags = article.tags.filter(tag => selectedTags.includes(tag));
                                                return (
                                                    <div
                                                        key={index}
                                                        className={`bg-white rounded-lg p-3 shadow-sm border hover:shadow-md transition-all cursor-pointer ${
                                                            matchingTags.length > 0 ? 'ring-2 ring-blue-200 bg-blue-50/30' : ''
                                                        }`}
                                                        onClick={(e) => handleArticleRead(article, e)}
                                                    >
                                                        <div className="flex gap-3">
                                                            <div className="w-12 h-12 bg-gradient-to-br from-blue-100 to-blue-200 rounded-lg overflow-hidden flex-shrink-0 relative">
                                                                <img 
                                                                    src="https://s.yimg.jp/images/ksk/tool/img/photo01.png" 
                                                                    alt={article.title}
                                                                    className="w-full h-full object-cover hover:scale-105 transition-transform duration-300"
                                                                />
                                                                {/* è©±é¡Œåº¦ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ */}
                                                                <div className={`absolute top-0.5 right-0.5 text-white px-1 py-0.5 rounded text-xs-small ${
                                                                    article.topicalityScore >= 80 ? 'bg-red-500' : 
                                                                    article.topicalityScore >= 60 ? 'bg-orange-500' : 
                                                                    article.topicalityScore >= 40 ? 'bg-yellow-600' : 'bg-gray-500/70'
                                                                }`}>
                                                                    {Math.round(article.topicalityScore)}
                                                                </div>
                                                            </div>
                                                            
                                                            <div className="flex-1 min-w-0">
                                                                <div className="flex justify-between items-start mb-1">
                                                                    <h4 className="font-medium text-gray-900 text-sm line-clamp-2 flex-1">{article.title}</h4>
                                                                    {/* ãŠæ°—ã«å…¥ã‚Šãƒœã‚¿ãƒ³ */}
                                                                    <button
                                                                        onClick={(e) => {
                                                                            e.stopPropagation();
                                                                            toggleFavorites({
                                                                                title: `è¨˜äº‹: ${article.title}`,
                                                                                type: 'article',
                                                                                tags: article.tags,
                                                                                articleCount: 1,
                                                                                articleData: article
                                                                            }, e);
                                                                        }}
                                                                        className={`ml-2 flex-shrink-0 ${
                                                                            isFavorite({
                                                                                title: `è¨˜äº‹: ${article.title}`,
                                                                                type: 'article',
                                                                                tags: article.tags
                                                                            }) ? 'text-blue-600' : 'text-gray-400 hover:text-gray-600'
                                                                        } transition-colors`}
                                                                        title={isFavorite({
                                                                            title: `è¨˜äº‹: ${article.title}`,
                                                                            type: 'article',
                                                                            tags: article.tags
                                                                        }) ? "ãŠæ°—ã«å…¥ã‚Šã‹ã‚‰å‰Šé™¤" : "ãŠæ°—ã«å…¥ã‚Šã«è¿½åŠ "}
                                                                    >
                                                                        <svg width="14" height="14" viewBox="0 0 24 24" fill={isFavorite({
                                                                            title: `è¨˜äº‹: ${article.title}`,
                                                                            type: 'article',
                                                                            tags: article.tags
                                                                        }) ? "currentColor" : "none"} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                                                            <polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26"/>
                                                                        </svg>
                                                                    </button>
                                                                </div>
                                                                <p className="text-xs text-gray-600 mb-2 line-clamp-2">{article.snippet}</p>
                                                                <div className="flex items-center justify-between">
                                                                    <span className="text-xs text-gray-400">{article.source}</span>
                                                                    <div className="flex gap-1">
                                                                        {article.tags.slice(0, 2).map(tag => (
                                                                            <span
                                                                                key={tag}
                                                                                className={`px-1.5 py-0.5 text-xs rounded-full ${
                                                                                    selectedTags.includes(tag) 
                                                                                        ? 'bg-yellow-200 text-yellow-800 font-medium'
                                                                                        : 'bg-gray-100 text-gray-600'
                                                                                }`}
                                                                            >
                                                                                {tag}
                                                                            </span>
                                                                        ))}
                                                                        {article.tags.length > 2 && (
                                                                            <span className="px-1.5 py-0.5 bg-gray-100 text-gray-500 text-xs rounded-full">
                                                                                +{article.tags.length - 2}
                                                                            </span>
                                                                        )}
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                            </div>
                                        )}
                                        
                                        {/* ã‚°ãƒªãƒƒãƒ‰ãƒ“ãƒ¥ãƒ¼ï¼ˆæ­£æ–¹å½¢å›ºå®šï¼‰ */}
                                        {mapViewMode === 'grid' && (
                                            <div className="grid gap-1 w-full overflow-hidden -mx-1 article-grid">
                                                {getMapFilteredArticles().map((article, index) => {
                                                    const matchingTags = article.tags.filter(tag => selectedTags.includes(tag));
                                                    
                                                    return (
                                                        <div
                                                            key={index}
                                                            className={`relative overflow-hidden cursor-pointer group aspect-square ${
                                                                matchingTags.length > 0 ? 'ring-2 ring-yellow-300' : ''
                                                            }`}
                                                            style={article.staticGridSize}
                                                            onClick={(e) => handleArticleRead(article, e)}
                                                        >
                                                            <img 
                                                                src="https://s.yimg.jp/images/ksk/tool/img/photo01.png" 
                                                                alt={article.title}
                                                                className="w-full h-full object-cover group-hover:scale-110 transition-transform duration-300"
                                                            />
                                                            
                                                            {/* ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ - å¤§ããªã‚¢ã‚¤ãƒ†ãƒ ã¯å¸¸æ™‚è¡¨ç¤ºã€å°ã•ãªã‚¢ã‚¤ãƒ†ãƒ ã¯ãƒ›ãƒãƒ¼æ™‚ã®ã¿ */}
                                                            <div className={`absolute inset-0 bg-gradient-to-t from-black/70 via-transparent to-transparent transition-opacity duration-300 ${
                                                                article.topicalityScore >= 60 
                                                                ? 'opacity-100' 
                                                                : 'opacity-0 group-hover:opacity-100'
                                                            }`}>
                                                                <div className="absolute bottom-0 left-0 right-0 p-2">
                                                                    <h4 className="text-white font-medium text-xs line-clamp-2 mb-1">
                                                                        {article.title}
                                                                    </h4>
                                                                    <div className="text-white/80 text-xs">
                                                                        è©±é¡Œåº¦: {Math.round(article.topicalityScore)}
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            
                                                            {/* ãƒãƒƒãƒãƒ³ã‚°æ•°ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ */}
                                                            {matchingTags.length > 0 && (
                                                                <div className="absolute top-2 left-2 bg-yellow-500 text-black text-xs px-1.5 py-0.5 rounded-full font-medium">
                                                                    {matchingTags.length}
                                                                </div>
                                                            )}
                                                            
                                                            {/* è©±é¡Œåº¦ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ */}
                                                            <div className={`absolute top-2 right-2 text-white text-xs px-1.5 py-0.5 rounded-full ${
                                                                article.topicalityScore >= 80 ? 'bg-red-500' : 
                                                                article.topicalityScore >= 60 ? 'bg-orange-500' : 
                                                                article.topicalityScore >= 40 ? 'bg-yellow-600' : 'bg-gray-500/70'
                                                            }`}>
                                                                {Math.round(article.topicalityScore)}
                                                            </div>
                                                            
                                                            {/* HOTãƒãƒƒã‚¸ */}
                                                            {article.topicalityScore >= 80 && (
                                                                <div className="absolute bottom-2 left-2 bg-red-500 text-white text-xs px-1.5 py-0.5 rounded-full font-bold">
                                                                    HOT
                                                                </div>
                                                            )}
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        )}

                                        {getMapFilteredArticles().length === 0 && (
                                            <div className="text-center py-8 text-gray-500">
                                                <div className="text-4xl mb-2">ğŸ“°</div>
                                                <p className="text-sm">é–¢é€£è¨˜äº‹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</p>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>

                    {/* ä¸‹éƒ¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ */}
                    <nav className="fixed bottom-0 left-0 right-0 bg-white/20 backdrop-blur-sm border-t border-gray-200/30 shadow-lg z-50">
                        <div className="flex items-center justify-between px-4 py-2">
                            {/* å·¦å¯„ã›: ãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³ï¼ˆå°†æ¥çš„ã«åˆ¥ç”»é¢é·ç§»ç”¨ï¼‰ */}
                            <button
                                onClick={() => {
                                    // å°†æ¥çš„ã«ãƒ›ãƒ¼ãƒ ç”»é¢ã‚„åˆ¥ã®ç”»é¢ã«é·ç§»äºˆå®š
                                    console.log('ãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ');
                                }}
                                className="w-10 h-10 rounded-full flex items-center justify-center transition-all bg-gray-100 text-gray-600 hover:bg-gray-200"
                            >
                                <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path fillRule="evenodd" clipRule="evenodd" d="M17.3892 7.44191L10.4827 0.60791C9.66124 -0.20459 8.33874 -0.20459 7.51724 0.60791L0.614244 7.43891C0.221244 7.82741 0.000244141 8.35791 0.000244141 8.91091V16.9999C0.000244141 17.5524 0.447744 17.9999 1.00024 17.9999H7.00024V12.2499C7.00024 12.1119 7.11174 11.9999 7.25024 11.9999H10.7502C10.8882 11.9999 11.0002 12.1119 11.0002 12.2499V17.9999H17.0002C17.5522 17.9999 18.0002 17.5524 18.0002 16.9999V8.90591C18.0002 8.35591 17.7797 7.82891 17.3892 7.44191" fill="black" fillOpacity="0.73"/>
                                </svg>
                            </button>
                            
                            {/* å³å¯„ã›: ã‚«ãƒ¡ãƒ©ãƒ»éŸ³å£°ãƒ»ãƒãƒƒãƒ—ãƒœã‚¿ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ */}
                            <div className="flex items-center bg-gray-100 rounded-full px-1">
                                {/* ã‚«ãƒ¡ãƒ©ãƒœã‚¿ãƒ³ */}
                                <button
                                    onClick={() => setShowCameraMenu(!showCameraMenu)}
                                    className="w-10 h-10 rounded-full bg-white flex items-center justify-center text-gray-700 hover:bg-gray-50 transition-all mx-0.5"
                                >
                                    <svg width="18" height="16" viewBox="0 0 18 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path fillRule="evenodd" clipRule="evenodd" d="M15.5 6C14.948 6 14.5 5.5525 14.5 4.999C14.5 4.4475 14.948 4 15.5 4C16.052 4 16.5 4.4475 16.5 4.999C16.5 5.5525 16.052 6 15.5 6M9 13.5C6.515 13.5 4.5 11.483 4.5 9C4.5 6.5165 6.515 4.5 9 4.5C11.483 4.5 13.5 6.5165 13.5 9C13.5 11.483 11.483 13.5 9 13.5M16 2H13.5L11.793 0.293C11.6055 0.1055 11.351 0 11.0855 0H6.9145C6.649 0 6.3945 0.1055 6.207 0.293L4.5 2H2C0.9 2 0 2.9 0 4V14C0 15.1 0.9 16 2 16H16C17.1 16 18 15.1 18 14V4C18 2.9 17.1 2 16 2M9 6.30005C7.511 6.30005 6.3 7.51105 6.3 9.00005C6.3 10.4886 7.511 11.7001 9 11.7001C10.489 11.7001 11.7 10.4886 11.7 9.00005C11.7 7.51105 10.489 6.30005 9 6.30005" fill="black" fillOpacity="0.73"/>
                                    </svg>
                                </button>
                                
                                {/* éŸ³å£°ãƒœã‚¿ãƒ³ */}
                                <button
                                    onClick={() => setShowVoiceMenu(!showVoiceMenu)}
                                    className="w-10 h-10 rounded-full bg-white flex items-center justify-center text-gray-700 hover:bg-gray-50 transition-all mx-0.5"
                                >
                                    <svg width="12" height="20" viewBox="0 0 12 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M1.5 9.5V10.5C1.5 12.9815 3.519 15 6 15C8.481 15 10.5 12.9815 10.5 10.5V9.5H12V10.5C12 13.4675 9.83297 15.9312 7 16.4092V18H8.75C9.1645 18 9.5 18.3355 9.5 18.75C9.5 19.1645 9.1645 19.5 8.75 19.5H3.25C2.8355 19.5 2.5 19.1645 2.5 18.75C2.5 18.3355 2.8355 18 3.25 18H5V16.4092C2.16703 15.9312 0 13.4675 0 10.5V9.5H1.5ZM6 0.5C7.6565 0.5 9 1.8435 9 3.5V10.5C9 12.1565 7.6565 13.5 6 13.5C4.3435 13.5 3 12.1565 3 10.5V3.5C3 1.8435 4.3435 0.5 6 0.5Z" fill="black" fillOpacity="0.73"/>
                                    </svg>
                                </button>
                                
                                {/* ãŠæ°—ã«å…¥ã‚Šãƒªã‚¹ãƒˆãƒœã‚¿ãƒ³ */}
                                <button
                                    onClick={() => {
                                        try {
                                            console.log('ãŠæ°—ã«å…¥ã‚Šãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ã€ç¾åœ¨ã®ãƒ“ãƒ¥ãƒ¼:', currentView);
                                            console.log('ãŠæ°—ã«å…¥ã‚Šãƒ¬ãƒãƒ¼ãƒˆæ•°:', favoriteReports.length);
                                            if (currentView === 'favorites') {
                                                setCurrentView('map');
                                            } else {
                                                setCurrentView('favorites');
                                            }
                                        } catch (error) {
                                            console.error('ãŠæ°—ã«å…¥ã‚Šãƒšãƒ¼ã‚¸è¡¨ç¤ºã‚¨ãƒ©ãƒ¼:', error);
                                        }
                                    }}
                                    className="w-10 h-10 rounded-full bg-white flex items-center justify-center text-gray-700 hover:bg-gray-50 transition-all mx-0.5 relative"
                                    title="ãŠæ°—ã«å…¥ã‚Šãƒªã‚¹ãƒˆ"
                                >
                                    <svg width="16" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                        <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/>
                                    </svg>
                                    {favoriteReports.length > 0 && (
                                        <div className="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">
                                            {favoriteReports.length}
                                        </div>
                                    )}
                                </button>
                            </div>
                        </div>
                        
                        {/* ã‚«ãƒ¡ãƒ©ãƒ¡ãƒ‹ãƒ¥ãƒ¼ */}
                        {showCameraMenu && (
                            <div className="absolute bottom-20 right-4 bg-white rounded-lg shadow-xl border p-4 w-48">
                                <div className="text-sm font-medium text-gray-900 mb-3">ã‚«ãƒ¡ãƒ©æ©Ÿèƒ½</div>
                                <div className="space-y-2">
                                    <button className="w-full text-left px-3 py-2 text-sm text-gray-600 hover:bg-gray-50 rounded">
                                        ğŸ” ç”»åƒæ¤œç´¢
                                    </button>
                                </div>
                                <button
                                    onClick={() => setShowCameraMenu(false)}
                                    className="absolute top-2 right-2 w-6 h-6 bg-gray-100 hover:bg-gray-200 rounded-full flex items-center justify-center text-xs"
                                >
                                    Ã—
                                </button>
                            </div>
                        )}
                        
                        {/* éŸ³å£°ãƒ¡ãƒ‹ãƒ¥ãƒ¼ */}
                        {showVoiceMenu && (
                            <div className="absolute bottom-20 right-4 bg-white rounded-lg shadow-xl border p-4 w-48">
                                <div className="text-sm font-medium text-gray-900 mb-3">éŸ³å£°æ©Ÿèƒ½</div>
                                <div className="space-y-2">
                                    <button className="w-full text-left px-3 py-2 text-sm text-gray-600 hover:bg-gray-50 rounded">
                                        ğŸ—£ï¸ éŸ³å£°æ¤œç´¢
                                    </button>
                                </div>
                                <button
                                    onClick={() => setShowVoiceMenu(false)}
                                    className="absolute top-2 right-2 w-6 h-6 bg-gray-100 hover:bg-gray-200 rounded-full flex items-center justify-center text-xs"
                                >
                                    Ã—
                                </button>
                            </div>
                        )}
                        
                    </nav>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
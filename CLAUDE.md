# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## プロジェクト概要

testAppは、記事をネットワークノードとグリッドレイアウトの両方で表示する、インタラクティブな記事マッピング・可視化アプリケーションです。日本語コンテンツを中心とし、階層的なタグ関係を使用して動的な可視化を作成します。

## アーキテクチャ

### コアコンポーネント
- **単一HTMLファイル構成**: アプリケーション全体が`index.html`に含まれ、BabelによるJSXコンパイルを使用した埋め込みReactコンポーネント
- **外部データ構成**: 記事とタグデータはJSONファイルに分離され、フォールバックインラインデータサポート付き
- **D3.jsネットワーク可視化**: 動的配置と関係性を持つインタラクティブノードネットワークの作成にD3.jsを使用
- **パーティクルシステム**: ユーザーインタラクションによってトリガーされるCanvasベースのパーティクルアニメーション

### データ構造
- `data/articles.json`: 記事メタデータ（タイトル、タグ、ソース、スニペット）を含む
- `data/hierarchical_tags.json`: ネットワーク可視化のためのタグ関係と階層を定義
- オフライン/CORSシナリオ用のHTMLに埋め込まれたフォールバックデータ

### 主要な状態管理
- 興味の深さスライダー（0-100）: タグ選択コンテキストと記事フィルタリングをコントロール
- ビューモード: グリッドビュー（Masonryレイアウト）vs ネットワークビュー（D3.jsノード）
- タグ選択: 階層的タグ展開とフィルタリングシステム
- 記事モーダル: パーティクル効果付きの詳細記事ビュー

## 開発セットアップ

### アプリケーションの実行
```bash
# ローカルHTTPサーバーを開始（CORS問題を回避するために必要）
python3 -m http.server 8000
# または利用可能なポートで
python3 -m http.server 8001

# http://localhost:8000/index.html でアクセス
```

**重要**: `file://` プロトコルでは動作しません。必ずHTTPサーバー経由でアクセスしてください。

### ファイル構造
```
nodemap/
├── index.html              # メインアプリケーションファイル
├── css/styles.css          # 外部スタイルシート
├── data/
│   ├── articles.json       # 記事データ
│   └── hierarchical_tags.json  # タグ階層データ
└── old/                    # バックアップファイル
```

## 重要な実装詳細

### データ読み込み戦略
- プライマリ: HTTP経由で外部JSONファイルを取得
- フォールバック: 外部ファイルが失敗した場合、埋め込みインラインデータを使用
- 詳細なコンソールログによるエラーハンドリング

### ネットワーク可視化
- ノード配置にD3.js force simulationを使用
- 興味の深さに基づく動的タグ関係
- ユーザーの興味深度設定に基づいて変化するカラーグラデーション
- 階層タグのインタラクティブなノード展開

### レスポンシブグリッドシステム
- CSS Gridを使用したMasonryスタイルグリッド
- "話題性スコア"に基づく動的記事サイズ
- ホバー効果とマッチングタグハイライト

### 記事処理
- タグ数とトレンドキーワードに基づく話題性スコア（10-100）の計算
- 一貫したレイアウトのための静的グリッドサイズ生成
- 選択されたタグと興味コンテキストによる記事フィルタリング

## お気に入り機能・レポート生成

### お気に入り機能
- **トグル機能**: ピンアイコンをクリックで追加・削除を自動切り替え
- **視覚的フィードバック**: 追加済み（青・塗りつぶし）vs 未追加（グレー・輪郭）
- **完了アニメーション**: 追加/削除/既存時にチェックマーク＋リップル効果
- **お気に入りリスト**: ナビゲーションから一覧表示・復元・削除可能
- **削除機能**: サムネイル長押し or リストのバツボタンで削除

### レポート生成・集約機能
- **タグ選択必須**: マップのタグノードまたは記事のタグをクリックして選択
- **集約レポート**: 選択タグに関連する記事の自動集約とレポート表示
- **お気に入り登録**: レポート全体をお気に入りに保存可能
- **履歴管理**: LocalStorageで最大5件のレポート履歴を保持

### フォント選択システム
- **動的フォント切り替え**: 標準フォント + 4種の手書き風フォント（Zen Kurenaido, Klee One, Yusei Magic, Hachi Maru Pop）
- **永続化**: LocalStorageでフォント設定を保存
- **全画面適用**: レポート、モーダル、記事詳細全てに適用

## 状態管理・データ永続化

### 主要な状態変数
- `selectedTags`: 選択されたタグ配列（レポート生成の基盤）
- `showFavorites`: お気に入り集約画面の表示制御
- `currentView`: メイン画面の表示モード ('map', 'favorites')
- `selectedFont`: フォント選択状態（LocalStorageと連携）
- `favoriteReports`: お気に入りレポートの配列（LocalStorageと連携）

### LocalStorage活用
- `favoriteReports`: お気に入り記事・レポートデータ
- `selectedFont`: フォント設定の永続化
- 最大5件の制限でデータ管理

## 重要な注意事項

- 外部JSONファイル読み込み時のCORS制限により、アプリケーションはローカルHTTPサーバーが必要
- すべてのReactコンポーネントはフック（useState、useEffect、useRef）を使用する関数コンポーネント
- D3.js統合はSVG操作とCanvasパーティクル効果の両方を処理
- 興味の深さスライダーはアプリケーションの動作とデータ関係を根本的に変更
- タグ階層がネットワーク関係と記事関連性を決定
- SVG要素の属性は React 形式（`fillRule`, `clipRule`）を使用
- アニメーション処理では `setAttribute` でSVG要素の`className`を安全に操作
- フォントクラスは動的に `font-${selectedFont}` パターンで適用される
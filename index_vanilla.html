<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LifeSyncMap - ËààÂë≥„Éû„ÉÉ„Éî„É≥„Ç∞„Ç¢„Éó„É™</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        * {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }
        
        .slider-thumb::-webkit-slider-thumb {
            appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: white;
            border: 2px solid #f1f5f9;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .slider-thumb::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 12px rgba(0,0,0,0.2);
        }
        
        .slider-thumb::-moz-range-thumb {
            height: 24px;
            width: 24px;
            border-radius: 50%;
            background: white;
            border: 2px solid #e2e8f0;
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            cursor: pointer;
        }
        
        .particle-canvas {
            position: fixed;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 1000;
        }
        
        .tag-node {
            transition: all 0.3s ease-in-out;
        }
        
        .tag-node:hover {
            transform: scale(1.1);
            filter: brightness(1.2);
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }

        .hidden { display: none; }
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root">
        <!-- „É°„Ç§„É≥„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥ -->
        <div class="h-screen bg-gray-50 overflow-hidden relative">
            <!-- „Éò„ÉÉ„ÉÄ„Éº -->
            <header id="header" class="bg-white shadow-sm border-b p-4 z-10 relative">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg flex items-center justify-center">
                            <span class="text-white font-bold text-sm">LS</span>
                        </div>
                        <h1 class="text-xl font-semibold text-gray-900">LifeSyncMap</h1>
                    </div>
                    
                    <!-- Ê§úÁ¥¢„Éú„ÉÉ„ÇØ„Çπ -->
                    <div class="relative max-w-md w-full mx-4">
                        <input 
                            type="text" 
                            id="searchInput"
                            placeholder="Ë®ò‰∫ã„ÇÑ„Çø„Ç∞„ÇíÊ§úÁ¥¢..." 
                            class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        >
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center">
                            <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                            </svg>
                        </div>
                    </div>
                    
                    <!-- Ë®≠ÂÆö„Éú„Çø„É≥ -->
                    <button id="settingsBtn" class="p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                    </button>
                </div>
            </header>

            <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
            <main class="flex h-full pt-0 pb-16">
                <!-- „Çµ„Ç§„Éâ„Éê„ÉºÔºà„Çø„Ç∞ÈÅ∏ÊäûÔºâ -->
                <div id="sidebar" class="w-80 bg-white shadow-sm border-r overflow-hidden flex flex-col">
                    <!-- „Çø„Ç∞„Éï„Ç£„É´„Çø„Éº -->
                    <div class="p-4 border-b bg-gray-50">
                        <h2 class="text-sm font-semibold text-gray-900 mb-3">ËààÂë≥„Çø„Ç∞„Åß„Éï„Ç£„É´„Çø„Éº</h2>
                        <div id="tagContainer" class="flex flex-wrap gap-2 max-h-60 overflow-y-auto scrollbar-hide">
                            <!-- „Çø„Ç∞„Åå„Åì„Åì„Å´ÂãïÁöÑ„Å´ËøΩÂä†„Åï„Çå„Åæ„Åô -->
                        </div>
                    </div>
                    
                    <!-- Ë®ò‰∫ã„É™„Çπ„Éà -->
                    <div class="flex-1 overflow-y-auto scrollbar-hide">
                        <div class="p-4">
                            <div class="flex items-center justify-between mb-3">
                                <h3 class="text-sm font-semibold text-gray-900">Ë®ò‰∫ã‰∏ÄË¶ß</h3>
                                <span id="articleCount" class="text-xs text-gray-500">0‰ª∂</span>
                            </div>
                            <div id="articleList" class="space-y-3">
                                <!-- Ë®ò‰∫ã„Åå„Åì„Åì„Å´ÂãïÁöÑ„Å´ËøΩÂä†„Åï„Çå„Åæ„Åô -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- „Éû„ÉÉ„Éó„Éì„É•„Éº„Ç®„É™„Ç¢ -->
                <div id="mapArea" class="flex-1 bg-gray-50 overflow-hidden relative">
                    <div class="absolute inset-0 flex flex-col">
                        <!-- „Éû„ÉÉ„Éó„Ç≥„É≥„Éà„É≠„Éº„É´ -->
                        <div class="p-4 bg-white/80 backdrop-blur-sm border-b border-gray-200/50">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-4">
                                    <div class="flex items-center space-x-2">
                                        <label class="text-sm font-medium text-gray-700">„Éì„É•„Éº„É¢„Éº„Éâ:</label>
                                        <select id="viewModeSelect" class="px-3 py-1 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500">
                                            <option value="grid">„Ç∞„É™„ÉÉ„Éâ</option>
                                            <option value="node">„Éé„Éº„Éâ</option>
                                        </select>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <label class="text-sm text-gray-700">Ë©±È°åÂ∫¶:</label>
                                        <input type="range" id="topicalitySlider" min="0" max="100" value="0" class="slider-thumb">
                                        <span id="topicalityValue" class="text-sm font-medium text-gray-700">0</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- „Éû„ÉÉ„Éó„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
                        <div class="flex-1 overflow-hidden">
                            <!-- „Ç∞„É™„ÉÉ„Éâ„Éì„É•„Éº -->
                            <div id="gridView" class="w-full h-full overflow-auto p-4">
                                <div id="gridContainer" class="grid gap-1 w-full overflow-hidden -mx-1" style="grid-template-columns: repeat(auto-fit, minmax(60px, 1fr)); grid-auto-flow: dense; grid-auto-rows: minmax(60px, 1fr); align-items: stretch; width: calc(100% + 0.5rem);">
                                    <!-- „Ç∞„É™„ÉÉ„Éâ„Ç¢„Ç§„ÉÜ„É†„Åå„Åì„Åì„Å´ÂãïÁöÑ„Å´ËøΩÂä†„Åï„Çå„Åæ„Åô -->
                                </div>
                            </div>
                            
                            <!-- „Éé„Éº„Éâ„Éì„É•„Éº -->
                            <div id="nodeView" class="w-full h-full hidden">
                                <svg id="nodeSvg" class="w-full h-full"></svg>
                            </div>
                        </div>
                    </div>
                </div>
            </main>

            <!-- ‰∏ãÈÉ®„É°„Éã„É•„Éº„Éê„Éº -->
            <nav class="fixed bottom-0 left-0 right-0 bg-white/20 backdrop-blur-sm border-t border-gray-200/30 shadow-lg z-50">
                <div class="flex items-center justify-between px-4 py-2">
                    <!-- „Éõ„Éº„É†„Éú„Çø„É≥ -->
                    <button id="homeBtn" class="w-10 h-10 rounded-full flex items-center justify-center transition-all bg-gray-100 text-gray-600 hover:bg-gray-200">
                        <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M17.3892 7.44191L10.4827 0.60791C9.66124 -0.20459 8.33874 -0.20459 7.51724 0.60791L0.614244 7.43891C0.221244 7.82741 0.000244141 8.35791 0.000244141 8.91091V16.9999C0.000244141 17.5524 0.447744 17.9999 1.00024 17.9999H7.00024V12.2499C7.00024 12.1119 7.11174 11.9999 7.25024 11.9999H10.7502C10.7502 12.1119 11.0002 12.1119 11.0002 12.2499V17.9999H17.0002C17.5522 17.9999 18.0002 17.5524 18.0002 16.9999V8.90591C18.0002 8.35591 17.7797 7.82891 17.3892 7.44191" fill="black" fill-opacity="0.73"/>
                        </svg>
                    </button>
                    
                    <!-- Âè≥ÂØÑ„Åõ„Éú„Çø„É≥„Ç≥„É≥„ÉÜ„Éä -->
                    <div class="flex items-center bg-gray-100 rounded-full px-1">
                        <!-- „Ç´„É°„É©„Éú„Çø„É≥ -->
                        <button id="cameraBtn" class="w-10 h-10 rounded-full bg-white flex items-center justify-center text-gray-700 hover:bg-gray-50 transition-all mx-0.5">
                            <svg width="18" height="16" viewBox="0 0 18 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M15.5 6C14.948 6 14.5 5.5525 14.5 4.999C14.5 4.4475 14.948 4 15.5 4C16.052 4 16.5 4.4475 16.5 4.999C16.5 5.5525 16.052 6 15.5 6M9 13.5C6.515 13.5 4.5 11.483 4.5 9C4.5 6.5165 6.515 4.5 9 4.5C11.483 4.5 13.5 6.5165 13.5 9C13.5 11.483 11.483 13.5 9 13.5M16 2H13.5L11.793 0.293C11.6055 0.1055 11.351 0 11.0855 0H6.9145C6.649 0 6.3945 0.1055 6.207 0.293L4.5 2H2C0.9 2 0 2.9 0 4V14C0 15.1 0.9 16 2 16H16C17.1 16 18 15.1 18 14V4C18 2.9 17.1 2 16 2M9 6.30005C7.511 6.30005 6.3 7.51105 6.3 9.00005C6.3 10.4886 7.511 11.7001 9 11.7001C10.489 11.7001 11.7 10.4886 11.7 9.00005C11.7 7.51105 10.489 6.30005 9 6.30005" fill="black" fill-opacity="0.73"/>
                            </svg>
                        </button>
                        
                        <!-- Èü≥Â£∞„Éú„Çø„É≥ -->
                        <button id="voiceBtn" class="w-10 h-10 rounded-full bg-white flex items-center justify-center text-gray-700 hover:bg-gray-50 transition-all mx-0.5">
                            <svg width="12" height="20" viewBox="0 0 12 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M1.5 9.5V10.5C1.5 12.9815 3.519 15 6 15C8.481 15 10.5 12.9815 10.5 10.5V9.5H12V10.5C12 13.4675 9.83297 15.9312 7 16.4092V18H8.75C9.1645 18 9.5 18.3355 9.5 18.75C9.5 19.1645 9.1645 19.5 8.75 19.5H3.25C2.8355 19.5 2.5 19.1645 2.5 18.75C2.5 18.3355 2.8355 18 3.25 18H5V16.4092C2.16703 15.9312 0 13.4675 0 10.5V9.5H1.5ZM6 0.5C7.6565 0.5 9 1.8435 9 3.5V10.5C9 12.1565 7.6565 13.5 6 13.5C4.3435 13.5 3 12.1565 3 10.5V3.5C3 1.8435 4.3435 0.5 6 0.5Z" fill="black" fill-opacity="0.73"/>
                            </svg>
                        </button>
                        
                        <!-- „Éï„Ç©„É≠„Éº„Éú„Çø„É≥ -->
                        <button id="followBtn" class="w-10 h-10 rounded-full bg-white flex items-center justify-center text-gray-700 hover:bg-gray-50 transition-all mx-0.5">
                            <svg width="18" height="22" viewBox="0 0 18 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M15.725 11.55V19.8H7.47496V11.55H15.725ZM15.725 9.35H7.47496C6.25946 9.35 5.27496 10.3345 5.27496 11.55V19.8C5.27496 21.0155 6.25946 22 7.47496 22H15.725C16.9405 22 17.925 21.0155 17.925 19.8V11.55C17.925 10.3345 16.9405 9.35 15.725 9.35Z" fill="black" fill-opacity="0.73"/>
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M13.8 14.85H12.425V13.475C12.425 13.0185 12.0565 12.65 11.6 12.65C11.1435 12.65 10.775 13.0185 10.775 13.475V14.85H9.40001C8.94351 14.85 8.57501 15.2185 8.57501 15.675C8.57501 16.1315 8.94351 16.5 9.40001 16.5H10.775V17.875C10.775 18.3315 11.1435 18.7 11.6 18.7C12.0565 18.7 12.425 18.3315 12.425 17.875V16.5H13.8C14.2565 16.5 14.625 16.1315 14.625 15.675C14.625 15.2185 14.2565 14.85 13.8 14.85Z" fill="black" fill-opacity="0.73"/>
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M15.725 7.7H17.925V6.0445C17.925 5.753 17.8095 5.4725 17.606 5.269L12.678 0.3245C12.469 0.1155 12.1885 0 11.897 0H2.52501C1.30951 0 0.325012 0.9845 0.325012 2.2V19.8C0.325012 21.0155 1.30951 22 2.52501 22H3.62501V19.8H2.52501V2.2H11.391V5.5C11.391 6.105 11.886 6.6 12.491 6.6H15.725V7.7Z" fill="black" fill-opacity="0.73"/>
                            </svg>
                        </button>
                    </div>
                </div>
                
                <!-- „Ç´„É°„É©„É°„Éã„É•„Éº -->
                <div id="cameraMenu" class="absolute bottom-20 right-4 bg-white rounded-lg shadow-xl border p-4 w-48 hidden">
                    <div class="text-sm font-medium text-gray-900 mb-3">„Ç´„É°„É©Ê©üËÉΩ</div>
                    <div class="space-y-2">
                        <button class="w-full text-left px-3 py-2 text-sm text-gray-600 hover:bg-gray-50 rounded">
                            üîç ÁîªÂÉèÊ§úÁ¥¢
                        </button>
                    </div>
                    <button id="closeCameraMenu" class="absolute top-2 right-2 w-6 h-6 bg-gray-100 hover:bg-gray-200 rounded-full flex items-center justify-center text-xs">
                        √ó
                    </button>
                </div>
                
                <!-- Èü≥Â£∞„É°„Éã„É•„Éº -->
                <div id="voiceMenu" class="absolute bottom-20 right-4 bg-white rounded-lg shadow-xl border p-4 w-48 hidden">
                    <div class="text-sm font-medium text-gray-900 mb-3">Èü≥Â£∞Ê©üËÉΩ</div>
                    <div class="space-y-2">
                        <button class="w-full text-left px-3 py-2 text-sm text-gray-600 hover:bg-gray-50 rounded">
                            üó£Ô∏è Èü≥Â£∞Ê§úÁ¥¢
                        </button>
                    </div>
                    <button id="closeVoiceMenu" class="absolute top-2 right-2 w-6 h-6 bg-gray-100 hover:bg-gray-200 rounded-full flex items-center justify-center text-xs">
                        √ó
                    </button>
                </div>
            </nav>
        </div>
    </div>
    <canvas id="particle-canvas" class="particle-canvas"></canvas>
    
    <script>
        // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞„Åß„Éá„Éº„Çø„Çí‰øùÊåÅ
        let inlineData = {
            articles: [],
            hierarchical_tags: {}
        };

        // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞
        let selectedTags = [];
        let topicalityThreshold = 0;
        let viewMode = 'grid';
        let filteredArticles = [];
        let allTags = [];

        // „Éá„Éº„Çø„ÇíÂ§ñÈÉ®„Éï„Ç°„Ç§„É´„Åã„ÇâË™≠„ÅøËæº„Åø
        async function loadData() {
            try {
                // Ë®ò‰∫ã„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø
                const articlesResponse = await fetch('./data/articles.json');
                inlineData.articles = await articlesResponse.json();
                
                // ÈöéÂ±§„Çø„Ç∞„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø
                const tagsResponse = await fetch('./data/hierarchical_tags.json');
                inlineData.hierarchical_tags = await tagsResponse.json();
                
                console.log('„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü');
                return true;
            } catch (error) {
                console.error('„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:', error);
                // „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ: ÊúÄÂ∞èÈôê„ÅÆ„Éá„Éº„Çø
                inlineData.articles = [
                    {
                        title: "„Çµ„É≥„Éó„É´Ë®ò‰∫ã",
                        tags: ["ÊäÄË°ì"],
                        source: "„Çµ„É≥„Éó„É´",
                        snippet: "„Éá„Éº„Çø„Éï„Ç°„Ç§„É´„ÅåË™≠„ÅøËæº„ÇÅ„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ"
                    }
                ];
                inlineData.hierarchical_tags = { "ÊäÄË°ì": [] };
                return false;
            }
        }

        // ÂàùÊúüÂåñ
        async function init() {
            // „Éá„Éº„Çø„ÇíÂ§ñÈÉ®„Éï„Ç°„Ç§„É´„Åã„ÇâË™≠„ÅøËæº„Åø
            await loadData();
            
            // Ë©±È°åÂ∫¶„ÇíÂêÑË®ò‰∫ã„Å´„É©„É≥„ÉÄ„É†„Å´ËøΩÂä†
            inlineData.articles.forEach(article => {
                article.topicalityScore = Math.floor(Math.random() * 100);
                article.staticGridSize = {
                    gridColumnEnd: `span ${Math.floor(Math.random() * 2) + 1}`,
                    gridRowEnd: `span ${Math.floor(Math.random() * 2) + 1}`
                };
            });

            // ÂÖ®„Çø„Ç∞„ÅÆÊäΩÂá∫
            const tagSet = new Set();
            inlineData.articles.forEach(article => {
                article.tags.forEach(tag => tagSet.add(tag));
            });
            allTags = Array.from(tagSet);

            // ÂàùÊúüË°®Á§∫
            renderTags();
            updateFilteredArticles();
            renderArticles();
            renderMap();
            setupEventListeners();
        }

        // „Çø„Ç∞„ÅÆÊèèÁîª
        function renderTags() {
            const tagContainer = document.getElementById('tagContainer');
            tagContainer.innerHTML = '';

            allTags.forEach(tag => {
                const tagElement = document.createElement('button');
                tagElement.className = `px-3 py-1 text-sm rounded-full border transition-all ${
                    selectedTags.includes(tag)
                        ? 'bg-blue-500 text-white border-blue-500'
                        : 'bg-white text-gray-700 border-gray-300 hover:border-blue-300'
                }`;
                tagElement.textContent = tag;
                tagElement.onclick = () => toggleTag(tag);
                tagContainer.appendChild(tagElement);
            });
        }

        // „Çø„Ç∞„ÅÆÂàá„ÇäÊõø„Åà
        function toggleTag(tag) {
            const index = selectedTags.indexOf(tag);
            if (index > -1) {
                selectedTags.splice(index, 1);
            } else {
                selectedTags.push(tag);
            }
            renderTags();
            updateFilteredArticles();
            renderArticles();
            renderMap();
        }

        // „Éï„Ç£„É´„Çø„É™„É≥„Ç∞Ê∏à„ÅøË®ò‰∫ã„ÅÆÊõ¥Êñ∞
        function updateFilteredArticles() {
            filteredArticles = inlineData.articles.filter(article => {
                // Ë©±È°åÂ∫¶„Éï„Ç£„É´„Çø„Éº
                if (article.topicalityScore < topicalityThreshold) return false;
                
                // „Çø„Ç∞„Éï„Ç£„É´„Çø„Éº
                if (selectedTags.length > 0) {
                    return selectedTags.some(tag => article.tags.includes(tag));
                }
                
                return true;
            });
        }

        // Ë®ò‰∫ã„É™„Çπ„Éà„ÅÆÊèèÁîª
        function renderArticles() {
            const articleList = document.getElementById('articleList');
            const articleCount = document.getElementById('articleCount');
            
            articleList.innerHTML = '';
            articleCount.textContent = `${filteredArticles.length}‰ª∂`;

            filteredArticles.forEach((article, index) => {
                const matchingTags = article.tags.filter(tag => selectedTags.includes(tag));
                
                const articleElement = document.createElement('div');
                articleElement.className = `p-3 bg-white rounded-lg border hover:border-blue-200 transition-all cursor-pointer ${
                    matchingTags.length > 0 ? 'ring-1 ring-yellow-300' : ''
                }`;
                
                articleElement.innerHTML = `
                    <h4 class="font-medium text-gray-900 text-sm mb-2 line-clamp-2">${article.title}</h4>
                    <p class="text-xs text-gray-600 mb-2 line-clamp-2">${article.snippet}</p>
                    <div class="flex items-center justify-between">
                        <span class="text-xs text-gray-500">${article.source}</span>
                        <span class="text-xs px-2 py-1 rounded-full ${
                            article.topicalityScore >= 80 ? 'bg-red-100 text-red-800' : 
                            article.topicalityScore >= 60 ? 'bg-orange-100 text-orange-800' : 
                            article.topicalityScore >= 40 ? 'bg-yellow-100 text-yellow-800' : 'bg-gray-100 text-gray-800'
                        }">
                            Ë©±È°åÂ∫¶: ${Math.round(article.topicalityScore)}
                        </span>
                    </div>
                    <div class="flex flex-wrap gap-1 mt-2">
                        ${article.tags.map(tag => `
                            <span class="px-2 py-0.5 text-xs rounded-full ${
                                selectedTags.includes(tag) ? 'bg-blue-100 text-blue-800' : 'bg-gray-100 text-gray-600'
                            }">${tag}</span>
                        `).join('')}
                    </div>
                `;
                
                articleElement.onclick = () => handleArticleRead(article);
                articleList.appendChild(articleElement);
            });
        }

        // „Éû„ÉÉ„Éó„ÅÆÊèèÁîª
        function renderMap() {
            if (viewMode === 'grid') {
                renderGridView();
            } else {
                renderNodeView();
            }
        }

        // „Ç∞„É™„ÉÉ„Éâ„Éì„É•„Éº„ÅÆÊèèÁîª
        function renderGridView() {
            const gridView = document.getElementById('gridView');
            const nodeView = document.getElementById('nodeView');
            const gridContainer = document.getElementById('gridContainer');
            
            gridView.classList.remove('hidden');
            nodeView.classList.add('hidden');
            
            gridContainer.innerHTML = '';

            filteredArticles.forEach((article, index) => {
                const matchingTags = article.tags.filter(tag => selectedTags.includes(tag));
                
                const gridItem = document.createElement('div');
                gridItem.className = `relative overflow-hidden cursor-pointer group aspect-square ${
                    matchingTags.length > 0 ? 'ring-2 ring-yellow-300' : ''
                }`;
                gridItem.style.gridColumnEnd = article.staticGridSize.gridColumnEnd;
                gridItem.style.gridRowEnd = article.staticGridSize.gridRowEnd;
                
                gridItem.innerHTML = `
                    <img 
                        src="https://s.yimg.jp/images/ksk/tool/img/photo01.png" 
                        alt="${article.title}"
                        class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-300"
                    />
                    
                    <div class="${`absolute inset-0 bg-gradient-to-t from-black/70 via-transparent to-transparent transition-opacity duration-300 ${
                        article.topicalityScore >= 60 
                        ? 'opacity-100' 
                        : 'opacity-0 group-hover:opacity-100'
                    }`}">
                        <div class="absolute bottom-0 left-0 right-0 p-2">
                            <h4 class="text-white font-medium text-xs line-clamp-2 mb-1">
                                ${article.title}
                            </h4>
                            <div class="text-white/80 text-xs">
                                Ë©±È°åÂ∫¶: ${Math.round(article.topicalityScore)}
                            </div>
                        </div>
                    </div>
                    
                    ${matchingTags.length > 0 ? `
                        <div class="absolute top-2 left-2 bg-yellow-500 text-black text-xs px-1.5 py-0.5 rounded-full font-medium">
                            ${matchingTags.length}
                        </div>
                    ` : ''}
                    
                    <div class="${`absolute top-2 right-2 text-white text-xs px-1.5 py-0.5 rounded-full ${
                        article.topicalityScore >= 80 ? 'bg-red-500' : 
                        article.topicalityScore >= 60 ? 'bg-orange-500' : 
                        article.topicalityScore >= 40 ? 'bg-yellow-600' : 'bg-gray-500/70'
                    }`}">
                        ${Math.round(article.topicalityScore)}
                    </div>
                    
                    ${article.topicalityScore >= 80 ? `
                        <div class="absolute bottom-2 left-2 bg-red-500 text-white text-xs px-1.5 py-0.5 rounded-full font-bold">
                            HOT
                        </div>
                    ` : ''}
                `;
                
                gridItem.onclick = () => handleArticleRead(article);
                gridContainer.appendChild(gridItem);
            });
        }

        // „Éé„Éº„Éâ„Éì„É•„Éº„ÅÆÊèèÁîª
        function renderNodeView() {
            const gridView = document.getElementById('gridView');
            const nodeView = document.getElementById('nodeView');
            const svg = document.getElementById('nodeSvg');
            
            gridView.classList.add('hidden');
            nodeView.classList.remove('hidden');
            
            // D3.js„Çí‰Ωø„Å£„Åü„Éé„Éº„Éâ„Éì„É•„Éº„ÅÆÂÆüË£ÖÔºàÁ∞°ÊòìÁâàÔºâ
            const width = svg.clientWidth || 800;
            const height = svg.clientHeight || 600;
            
            d3.select(svg).selectAll("*").remove();
            
            const svgElement = d3.select(svg)
                .attr('width', width)
                .attr('height', height);
            
            // „Éé„Éº„Éâ„Å®„É™„É≥„ÇØ„ÅÆÁîüÊàê
            const nodes = filteredArticles.map((article, i) => ({
                id: i,
                title: article.title,
                tags: article.tags,
                topicalityScore: article.topicalityScore,
                x: width / 2 + (Math.random() - 0.5) * 400,
                y: height / 2 + (Math.random() - 0.5) * 300
            }));
            
            // „Éé„Éº„Éâ„ÅÆÊèèÁîª
            svgElement.selectAll('circle')
                .data(nodes)
                .enter()
                .append('circle')
                .attr('cx', d => d.x)
                .attr('cy', d => d.y)
                .attr('r', d => Math.max(5, d.topicalityScore / 10))
                .attr('fill', d => {
                    if (d.topicalityScore >= 80) return '#ef4444';
                    if (d.topicalityScore >= 60) return '#f97316';
                    if (d.topicalityScore >= 40) return '#eab308';
                    return '#6b7280';
                })
                .attr('stroke', '#fff')
                .attr('stroke-width', 2)
                .style('cursor', 'pointer')
                .on('click', (event, d) => {
                    handleArticleRead(filteredArticles[d.id]);
                });
            
            // „É©„Éô„É´„ÅÆÊèèÁîª
            svgElement.selectAll('text')
                .data(nodes)
                .enter()
                .append('text')
                .attr('x', d => d.x)
                .attr('y', d => d.y + 25)
                .attr('text-anchor', 'middle')
                .attr('font-size', '10px')
                .attr('fill', '#374151')
                .text(d => d.title.length > 20 ? d.title.substring(0, 20) + '...' : d.title);
        }

        // Ë®ò‰∫ãË™≠„ÅøËæº„ÅøÂá¶ÁêÜ
        function handleArticleRead(article) {
            console.log('Ë®ò‰∫ã„ÅåË™≠„Åæ„Çå„Åæ„Åó„Åü:', article.title);
            alert(`Ë®ò‰∫ã„Äå${article.title}„Äç„ÇíÈñã„Åç„Åæ„Åô`);
        }

        // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÅÆË®≠ÂÆö
        function setupEventListeners() {
            // Ê§úÁ¥¢
            document.getElementById('searchInput').addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase();
                if (query) {
                    filteredArticles = inlineData.articles.filter(article =>
                        article.title.toLowerCase().includes(query) ||
                        article.tags.some(tag => tag.toLowerCase().includes(query))
                    );
                } else {
                    updateFilteredArticles();
                }
                renderArticles();
                renderMap();
            });

            // Ë©±È°åÂ∫¶„Çπ„É©„Ç§„ÉÄ„Éº
            const slider = document.getElementById('topicalitySlider');
            const valueDisplay = document.getElementById('topicalityValue');
            
            slider.addEventListener('input', (e) => {
                topicalityThreshold = parseInt(e.target.value);
                valueDisplay.textContent = topicalityThreshold;
                updateFilteredArticles();
                renderArticles();
                renderMap();
            });

            // „Éì„É•„Éº„É¢„Éº„ÉâÂàá„ÇäÊõø„Åà
            document.getElementById('viewModeSelect').addEventListener('change', (e) => {
                viewMode = e.target.value;
                renderMap();
            });

            // „É°„Éã„É•„Éº„Éú„Çø„É≥
            document.getElementById('cameraBtn').addEventListener('click', () => {
                const menu = document.getElementById('cameraMenu');
                menu.classList.toggle('hidden');
                document.getElementById('voiceMenu').classList.add('hidden');
            });

            document.getElementById('voiceBtn').addEventListener('click', () => {
                const menu = document.getElementById('voiceMenu');
                menu.classList.toggle('hidden');
                document.getElementById('cameraMenu').classList.add('hidden');
            });

            document.getElementById('closeCameraMenu').addEventListener('click', () => {
                document.getElementById('cameraMenu').classList.add('hidden');
            });

            document.getElementById('closeVoiceMenu').addEventListener('click', () => {
                document.getElementById('voiceMenu').classList.add('hidden');
            });

            document.getElementById('homeBtn').addEventListener('click', () => {
                console.log('„Éõ„Éº„É†„Éú„Çø„É≥„Åå„ÇØ„É™„ÉÉ„ÇØ„Åï„Çå„Åæ„Åó„Åü');
            });

            document.getElementById('followBtn').addEventListener('click', () => {
                console.log('„Éï„Ç©„É≠„Éº„Éú„Çø„É≥„Åå„ÇØ„É™„ÉÉ„ÇØ„Åï„Çå„Åæ„Åó„Åü');
            });

            document.getElementById('settingsBtn').addEventListener('click', () => {
                console.log('Ë®≠ÂÆö„Éú„Çø„É≥„Åå„ÇØ„É™„ÉÉ„ÇØ„Åï„Çå„Åæ„Åó„Åü');
            });
        }

        // ÂàùÊúüÂåñÂÆüË°å
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
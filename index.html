<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>testApp - ËààÂë≥„Éû„ÉÉ„Éî„É≥„Ç∞„Ç¢„Éó„É™</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link rel="stylesheet" href="./css/styles.css">
</head>
<body class="bg-gray-50">
    <div id="root"></div>
    <canvas id="particle-canvas" class="particle-canvas"></canvas>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // „Éá„Éº„Çø„ÇíÂ§ñÈÉ®„Éï„Ç°„Ç§„É´„Åã„ÇâË™≠„ÅøËæº„Åø
        let inlineData = {
            articles: [],
            hierarchical_tags: {}
        };

        // „Éá„Éº„ÇøË™≠„ÅøËæº„ÅøÈñ¢Êï∞
        const loadData = async () => {
            try {
                console.log('üîÑ „Éá„Éº„Çø„Éï„Ç°„Ç§„É´Ë™≠„ÅøËæº„ÅøÈñãÂßã...');
                
                const [articlesResponse, tagsResponse] = await Promise.all([
                    fetch('./data/articles.json'),
                    fetch('./data/hierarchical_tags.json')
                ]);
                
                if (!articlesResponse.ok) {
                    throw new Error(`Articles fetch failed: ${articlesResponse.status}`);
                }
                if (!tagsResponse.ok) {
                    throw new Error(`Tags fetch failed: ${tagsResponse.status}`);
                }
                
                const articles = await articlesResponse.json();
                const hierarchical_tags = await tagsResponse.json();
                
                inlineData = { articles, hierarchical_tags };
                console.log('‚úÖ Â§ñÈÉ®„Éá„Éº„Çø„Éï„Ç°„Ç§„É´„Åã„ÇâË™≠„ÅøËæº„ÅøÂÆå‰∫Ü');
                console.log(`üì∞ Ë®ò‰∫ãÊï∞: ${articles.length}`);
                console.log(`üè∑Ô∏è „Çø„Ç∞Êï∞: ${Object.keys(hierarchical_tags).length}`);
                return true;
            } catch (error) {
                console.error('‚ùå „Éá„Éº„Çø„Éï„Ç°„Ç§„É´Ë™≠„ÅøËæº„Åø„Ç®„É©„Éº:', error);
                console.warn('üîÑ „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ„Éá„Éº„Çø„Çí‰ΩøÁî®');
                
                // ÂÆåÂÖ®„Å™„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ„Éá„Éº„ÇøÔºàÂÖÉ„ÅÆinlineData„Å®Âêå„ÅòÔºâ
                inlineData = {
                    articles: [
                        {
                            "title": "AI„ÅåÁîüÊàê„Åô„ÇãÊñ∞„Åó„ÅÑÈü≥Ê•Ω„ÅÆÂèØËÉΩÊÄß",
                            "tags": ["AI", "Èü≥Ê•Ω", "ÊäÄË°ì"],
                            "source": "Tech Journal",
                            "snippet": "‰∫∫Â∑•Áü•ËÉΩ„ÅÆÈÄ≤Âåñ„Å´„Çà„Çä„ÄÅ‰ΩúÊõ≤„ÇÑÊºîÂ•è„ÅÆÂàÜÈáé„ÅßÊñ∞„Åü„Å™ÂèØËÉΩÊÄß„ÅåÂ∫É„Åå„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ"
                        },
                        {
                            "title": "ÈõªÊ∞óËá™ÂãïËªä„ÄÅ„Éê„ÉÉ„ÉÜ„É™„ÉºÊäÄË°ì„ÅÆÊ¨°‰∏ñ‰ª£„Éà„É¨„É≥„Éâ",
                            "tags": ["ÈõªÊ∞óËá™ÂãïËªä", "ÊäÄË°ì", "„Ç®„Éç„É´„ÇÆ„Éº", "SDGs"],
                            "source": "Future Daily",
                            "snippet": "ÂÖ®Âõ∫‰ΩìÈõªÊ±†„ÇÑÊñ∞„Åó„ÅÑÂÖÖÈõªÊäÄË°ì„Å™„Å©„ÄÅÈõªÊ∞óËá™ÂãïËªä„ÅÆËà™Á∂öË∑ùÈõ¢„Å®„Ç≥„Çπ„Éà„ÇíÊîπÂñÑ„Åô„Çã„Ç§„Éé„Éô„Éº„Ç∑„Éß„É≥„ÅåÊ≥®ÁõÆ„ÇíÈõÜ„ÇÅ„Å¶„ÅÑ„Åæ„Åô„ÄÇ"
                        },
                        {
                            "title": "ÂÆáÂÆôÊóÖË°å„ÄÅ‰∏ÄËà¨‰∫∫Âêë„Åë„ÉÑ„Ç¢„Éº„ÅÆÊúÄÊñ∞ÂãïÂêë",
                            "tags": ["ÂÆáÂÆô", "ÊóÖË°å", "„É≠„Ç±„ÉÉ„Éà"],
                            "source": "Space Today",
                            "snippet": "ÂÆáÂÆô„Å∏„ÅÆÊóÖË°å„Åå„ÄÅ‰∏ÄÈÉ®„ÅÆÂØåË£ïÂ±§„Å†„Åë„Åß„Å™„Åè„ÄÅ‰∏ÄËà¨„ÅÆ‰∫∫„ÄÖ„Å´„ÇÇÊâã„ÅÆÂ±ä„ÅèÊôÇ‰ª£„Å´„Å™„Çä„Å§„Å§„ÅÇ„Çä„Åæ„Åô„ÄÇ"
                        },
                        {
                            "title": "„É°„Çø„Éê„Éº„Çπ„Å®VR„ÅåÂ§â„Åà„Çã„Éì„Ç∏„Éç„Çπ„ÅÆÊú™Êù•",
                            "tags": ["„É°„Çø„Éê„Éº„Çπ", "VR", "„Éì„Ç∏„Éç„Çπ"],
                            "source": "Business Insights",
                            "snippet": "‰ªÆÊÉ≥Á©∫Èñì„Åß„ÅÆ‰ºöË≠∞„ÇÑÂïÜÂìÅÂ±ïÁ§∫„ÄÅ„Ç§„Éô„É≥„ÉàÈñãÂÇ¨„Å™„Å©„ÄÅ„É°„Çø„Éê„Éº„Çπ„Åå„ÇÇ„Åü„Çâ„ÅôÊñ∞„Åó„ÅÑ„Éì„Ç∏„Éç„Çπ„É¢„Éá„É´„ÅåÊ¨°„ÄÖ„Å®ÁôªÂ†¥„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ"
                        },
                        {
                            "title": "„Çµ„Çπ„ÉÜ„Ç£„Éä„Éñ„É´„Éï„Ç°„ÉÉ„Ç∑„Éß„É≥ÔºöÂæ™Áí∞ÂûãÁ§æ‰ºö„Å∏„ÅÆÊåëÊà¶",
                            "tags": ["SDGs", "„Éï„Ç°„ÉÉ„Ç∑„Éß„É≥", "„Çµ„Çπ„ÉÜ„Ç£„Éä„Éñ„É´"],
                            "source": "Eco Life",
                            "snippet": "Áí∞Â¢É„Å´ÈÖçÊÖÆ„Åó„ÅüÁ¥†ÊùêÈÅ∏„Å≥„ÇÑË£ΩÈÄ†„Éó„É≠„Çª„Çπ„ÄÅÂè§ÁùÄ„ÅÆ„É™„Çµ„Ç§„ÇØ„É´„Å™„Å©„ÄÅ„Éï„Ç°„ÉÉ„Ç∑„Éß„É≥Ê•≠Áïå„Åß„ÇÇ„Çµ„Çπ„ÉÜ„Ç£„Éä„Éì„É™„ÉÜ„Ç£„Å∏„ÅÆÂèñ„ÇäÁµÑ„Åø„ÅåÂä†ÈÄü„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ"
                        },
                        {
                            "title": "Áä¨Á®ÆÂõ≥ÈëëÔºöÊü¥Áä¨„ÅÆÈ≠ÖÂäõ",
                            "tags": ["ÂãïÁâ©", "Áä¨", "„Éö„ÉÉ„Éà"],
                            "source": "Animal World",
                            "snippet": "Êó•Êú¨„ÅÆ‰ª£Ë°®ÁöÑ„Å™Áä¨Á®Æ„Åß„ÅÇ„ÇãÊü¥Áä¨„ÄÇ„Åù„ÅÆÊ≠¥Âè≤„ÇÑÊÄßÊ†º„ÄÅÈ£ºËÇ≤„ÅÆ„Éù„Ç§„É≥„Éà„ÇíËß£Ë™¨„Åó„Åæ„Åô„ÄÇ"
                        }
                    ],
                    hierarchical_tags: {
                        "AI": ["Ê©üÊ¢∞Â≠¶Áøí", "Ëá™ÁÑ∂Ë®ÄË™ûÂá¶ÁêÜ", "ÁîªÂÉèË™çË≠ò"],
                        "ÊäÄË°ì": ["ÂçäÂ∞é‰Ωì", "ÈáèÂ≠ê„Ç≥„É≥„Éî„É•„Éº„Çø„Éº", "„ÇØ„É©„Ç¶„Éâ"],
                        "SDGs": ["Âæ™Áí∞ÂûãÁµåÊ∏à", "ÂÜçÁîüÂèØËÉΩ„Ç®„Éç„É´„ÇÆ„Éº", "„Çµ„Çπ„ÉÜ„Ç£„Éä„Éñ„É´"],
                        "Èü≥Ê•Ω": ["DTM", "Ê•ΩÂô®", "„É©„Ç§„Éñ"],
                        "ÈõªÊ∞óËá™ÂãïËªä": ["„Éê„ÉÉ„ÉÜ„É™„Éº", "ÂÖÖÈõªÊäÄË°ì"],
                        "ÂÆáÂÆô": ["ISS", "„Çπ„Éö„Éº„Çπ„Ç∑„É£„Éà„É´", "Â§©‰ΩìË¶≥Ê∏¨"],
                        "ÊóÖË°å": ["ÁßòÂ¢É", "„ÉÑ„Ç¢„Éº", "‰∏ñÁïåÈÅ∫Áî£", "ÂõΩÂÜÖÊóÖË°å"],
                        "„Éì„Ç∏„Éç„Çπ": ["„Çπ„Çø„Éº„Éà„Ç¢„ÉÉ„Éó", "„Éû„Éº„Ç±„ÉÜ„Ç£„É≥„Ç∞", "ÁµåÂñ∂Êà¶Áï•"],
                        "„Éï„Ç°„ÉÉ„Ç∑„Éß„É≥": ["„Ç¢„Éë„É¨„É´", "„Éá„Ç∂„Ç§„É≥", "ZOZO"],
                        "ÂãïÁâ©": ["Áä¨", "Áå´", "È≠ö"],
                        "Áä¨": ["Áä¨Á®Æ", "È£ºËÇ≤"],
                        "„Éö„ÉÉ„Éà": ["È£ºËÇ≤", "Áî®ÂìÅ", "ÁóÖÊ∞ó"]
                    }
                };
                return false;
            }
        };

        // „Éë„Éº„ÉÜ„Ç£„ÇØ„É´„Ç∑„Çπ„ÉÜ„É†
        function ParticleSystem() {
            const canvasRef = useRef();
            const particles = useRef([]);
            const animationFrame = useRef();

            const startParticleEffect = (startX, startY, tags) => {
                const canvas = canvasRef.current;
                if (!canvas) return;

                const ctx = canvas.getContext('2d');
                particles.current = [];

                // „Éâ„ÉÉ„Éà„Éë„Éº„ÉÜ„Ç£„ÇØ„É´„ÅÆÁîüÊàê
                for (let i = 0; i < 30; i++) {
                    const angle = Math.random() * Math.PI * 2;
                    const speed = 2 + Math.random() * 4;
                    particles.current.push({
                        x: startX,
                        y: startY,
                        vx: Math.cos(angle) * speed,
                        vy: Math.sin(angle) * speed - 2,
                        size: 2 + Math.random() * 3,
                        color: `hsl(${Math.random() * 360}, 70%, 65%)`,
                        opacity: 1,
                        type: 'dot'
                    });
                }

                // „Çø„Ç∞„ÉÜ„Ç≠„Çπ„Éà„Éë„Éº„ÉÜ„Ç£„ÇØ„É´„ÅÆÁîüÊàê
                tags.forEach((tag, index) => {
                    const angle = (index / tags.length) * Math.PI * 2;
                    const speed = 1.5 + Math.random() * 2;
                    particles.current.push({
                        x: startX,
                        y: startY,
                        vx: Math.cos(angle) * speed,
                        vy: Math.sin(angle) * speed - 1,
                        size: 14,
                        color: '#ffffff',
                        opacity: 1,
                        type: 'text',
                        text: tag
                    });
                });

                animateParticles(ctx);
            };

            const animateParticles = (ctx) => {
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);

                particles.current = particles.current.filter(particle => {
                    particle.x += particle.vx;
                    particle.y += particle.vy;
                    particle.vy += 0.03;
                    particle.opacity -= 0.008;
                    particle.vx *= 0.99;

                    if (particle.type === 'dot') {
                        ctx.save();
                        ctx.globalAlpha = particle.opacity;
                        ctx.fillStyle = particle.color;
                        ctx.beginPath();
                        ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
                        ctx.fill();
                        ctx.restore();
                    } else if (particle.type === 'text') {
                        ctx.save();
                        ctx.globalAlpha = particle.opacity;
                        ctx.font = `600 ${particle.size}px Inter`;
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'middle';
                        
                        const textWidth = ctx.measureText(particle.text).width;
                        const padding = 8;
                        const rectX = particle.x - textWidth / 2 - padding;
                        const rectY = particle.y - particle.size / 2 - padding;
                        const rectWidth = textWidth + padding * 2;
                        const rectHeight = particle.size + padding * 2;
                        
                        ctx.fillStyle = `rgba(255, 255, 255, ${0.9 * particle.opacity})`;
                        ctx.roundRect = ctx.roundRect || function(x, y, w, h, r) {
                            ctx.beginPath();
                            ctx.moveTo(x + r, y);
                            ctx.lineTo(x + w - r, y);
                            ctx.arcTo(x + w, y, x + w, y + r, r);
                            ctx.lineTo(x + w, y + h - r);
                            ctx.arcTo(x + w, y + h, x + w - r, y + h, r);
                            ctx.lineTo(x + r, y + h);
                            ctx.arcTo(x, y + h, x, y + h - r, r);
                            ctx.lineTo(x, y + r);
                            ctx.arcTo(x, y, x + r, y, r);
                            ctx.closePath();
                        };
                        
                        ctx.roundRect(rectX, rectY, rectWidth, rectHeight, rectHeight / 2);
                        ctx.fill();
                        
                        ctx.fillStyle = `rgba(30, 41, 59, ${particle.opacity})`;
                        ctx.fillText(particle.text, particle.x, particle.y);
                        ctx.restore();
                    }

                    return particle.opacity > 0;
                });

                if (particles.current.length > 0) {
                    animationFrame.current = requestAnimationFrame(() => animateParticles(ctx));
                }
            };

            useEffect(() => {
                const canvas = canvasRef.current;
                if (!canvas) return;

                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;

                window.startParticleEffect = startParticleEffect;

                const handleResize = () => {
                    canvas.width = window.innerWidth;
                    canvas.height = window.innerHeight;
                };

                window.addEventListener('resize', handleResize);

                return () => {
                    window.removeEventListener('resize', handleResize);
                    if (animationFrame.current) {
                        cancelAnimationFrame(animationFrame.current);
                    }
                };
            }, []);

            return <canvas ref={canvasRef} className="particle-canvas" />;
        }

        function App() {
            const [currentView, setCurrentView] = useState('map');
            const [collectedTags, setCollectedTags] = useState(new Map());
            const [tagLinks, setTagLinks] = useState([]);
            const [isArticleAreaExpanded, setIsArticleAreaExpanded] = useState(false);
            const [selectedTags, setSelectedTags] = useState([]);
            const [mapArticleAreaHeight, setMapArticleAreaHeight] = useState(50); // „Éû„ÉÉ„ÉóÁîªÈù¢„Åß„ÅÆË®ò‰∫ã„Ç®„É™„Ç¢È´ò„Åï(%)
            const [isDragging, setIsDragging] = useState(false);
            const [dataLoaded, setDataLoaded] = useState(false);
            const [articles, setArticles] = useState([]);
            const [hierarchicalTags, setHierarchicalTags] = useState({});
            const [showBalanceInfo, setShowBalanceInfo] = useState(false);
            const [showCameraMenu, setShowCameraMenu] = useState(false);
            const [showVoiceMenu, setShowVoiceMenu] = useState(false);
            const [viewMode, setViewMode] = useState('grid');
            const [mapViewMode, setMapViewMode] = useState('list');
            const [favoritesViewMode, setFavoritesViewMode] = useState('grid'); // „ÅäÊ∞ó„Å´ÂÖ•„ÇäÈõÜÁ¥ÑÁîªÈù¢Â∞ÇÁî®
            const [selectedArticle, setSelectedArticle] = useState(null);
            const [showArticleDetail, setShowArticleDetail] = useState(false);
            const [showFavorites, setShowFavorites] = useState(false);
            const [showAiHelp, setShowAiHelp] = useState(false);
            const [previousView, setPreviousView] = useState(null); // Ââç„ÅÆÁîªÈù¢„ÇíËøΩË∑°
            const [interestDepth, setInterestDepth] = useState(50); // ËààÂë≥„ÅÆÊ∑±„ÅïÔºà0-100Ôºâ
            //const [favoriteReports, setFavoriteReports] = useState([]); // „ÅäÊ∞ó„Å´ÂÖ•„Çä„É¨„Éù„Éº„Éà„É™„Çπ„Éà
            const [favoriteReports, setFavoriteReports] = useState(() => {
                // „É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Åã„Çâ„ÅäÊ∞ó„Å´ÂÖ•„Çä„ÇíË™≠„ÅøËæº„Åø
                try {
                    const saved = localStorage.getItem('favoriteReports');
                    return saved ? JSON.parse(saved) : [];
                } catch (error) {
                    console.error('„ÅäÊ∞ó„Å´ÂÖ•„ÇäË™≠„ÅøËæº„Åø„Ç®„É©„Éº:', error);
                    return [];
                }
            }); // „ÅäÊ∞ó„Å´ÂÖ•„Çä„É¨„Éù„Éº„Éà„É™„Çπ„Éà
            const [showFavoritesList, setShowFavoritesList] = useState(false); // „ÅäÊ∞ó„Å´ÂÖ•„Çä„É™„Çπ„ÉàË°®Á§∫Áä∂ÊÖã
            // ÂàùÊúü„Çø„Ç∞„ÅÆË®≠ÂÆö
            const initializeDefaultTags = () => {
                const defaultTags = new Map();
                const defaultLinks = [];
                
                // ‰∏ÄËà¨ÁöÑ„Å™Â§ß„Ç´„ÉÜ„Ç¥„É™„Çø„Ç∞„Çí‰∫ãÂâçÈÖçÁΩÆ
                const initialTags = [
                    { id: 'AI', size: 1.5, x: 200, y: 150 },
                    { id: 'ÊäÄË°ì', size: 1.3, x: 350, y: 200 },
                    { id: '„Éì„Ç∏„Éç„Çπ', size: 1.2, x: 500, y: 150 },
                    { id: 'ÊñôÁêÜ', size: 1.0, x: 150, y: 300 },
                    { id: 'ÊóÖË°å', size: 1.1, x: 400, y: 350 },
                    { id: 'ÂãïÁâ©', size: 0.9, x: 600, y: 280 },
                    { id: 'SDGs', size: 1.1, x: 300, y: 100 },
                    { id: '„Éï„Ç°„ÉÉ„Ç∑„Éß„É≥', size: 0.8, x: 550, y: 400 }
                ];
                
                initialTags.forEach(tag => {
                    defaultTags.set(tag.id, {
                        id: tag.id,
                        count: 1,
                        size: tag.size,
                        x: tag.x,
                        y: tag.y
                    });
                });
                
                // „Çø„Ç∞Èñì„ÅÆÈñ¢ÈÄ£ÊÄß„É™„É≥„ÇØ
                const tagRelations = [
                    ['AI', 'ÊäÄË°ì'],
                    ['ÊäÄË°ì', '„Éì„Ç∏„Éç„Çπ'],
                    ['SDGs', '„Éì„Ç∏„Éç„Çπ'],
                    ['ÊóÖË°å', 'ÊñôÁêÜ'],
                    ['„Éï„Ç°„ÉÉ„Ç∑„Éß„É≥', '„Éì„Ç∏„Éç„Çπ']
                ];
                
                tagRelations.forEach(([source, target]) => {
                    defaultLinks.push({ source, target });
                });
                
                return { defaultTags, defaultLinks };
            };
            
            // Ë®ò‰∫ã„ÅÆË©±È°åÊÄß„Çπ„Ç≥„Ç¢„ÇíË®àÁÆóÔºàÂàùÊúüË™≠„ÅøËæº„ÅøÊôÇ„ÅÆ„ÅøÔºâ
            const calculateTopicalityScore = (article) => {
                let score = 0;
                
                // „Çø„Ç∞Êï∞„Å´„Çà„ÇãÂü∫Êú¨„Çπ„Ç≥„Ç¢ÔºàÂ§ö„ÅÑ„Åª„Å©Ë©±È°åÊÄß„ÅåÈ´ò„ÅÑÔºâ
                score += article.tags.length * 15;
                
                // ÁâπÂÆö„ÅÆË©±È°åÊÄß„ÅÆÈ´ò„ÅÑ„Çø„Ç∞„Å´„Çà„ÇãËøΩÂä†„Çπ„Ç≥„Ç¢
                const hotTags = ['AI', 'ÊäÄË°ì', '„Éì„Ç∏„Éç„Çπ', 'SDGs', '„Ç§„Éé„Éô„Éº„Ç∑„Éß„É≥'];
                const trendingTags = article.tags.filter(tag => hotTags.includes(tag));
                score += trendingTags.length * 25;
                
                // „É©„É≥„ÉÄ„É†Ë¶ÅÁ¥†ÔºàË®ò‰∫ã„ÅÆÂ§öÊßòÊÄß„ÇíÁ¢∫‰øùÔºâ
                score += Math.random() * 20;
                
                return Math.max(10, Math.min(100, score)); // 10-100„ÅÆÁØÑÂõ≤
            };

            // Ë©±È°åÊÄß„Çπ„Ç≥„Ç¢„Å´Âü∫„Å•„Åè„Ç∞„É™„ÉÉ„Éâ„Çµ„Ç§„Ç∫„ÇíÊ±∫ÂÆöÔºà„Åô„Åπ„Å¶Ê≠£ÊñπÂΩ¢„ÅÆÁµÑ„ÅøÂêà„Çè„ÅõÔºâ
            const getStaticGridSize = (score) => {
                if (score >= 80) return { gridColumn: 'span 2', gridRow: 'span 2' }; // Â§ßÊ≠£ÊñπÂΩ¢ (2x2)
                if (score >= 60) return { gridColumn: 'span 2', gridRow: 'span 2' }; // Â§ßÊ≠£ÊñπÂΩ¢ (2x2)
                if (score >= 40) return { gridColumn: 'span 1', gridRow: 'span 1' }; // Â∞èÊ≠£ÊñπÂΩ¢ (1x1)
                return { gridColumn: 'span 1', gridRow: 'span 1' }; // Â∞èÊ≠£ÊñπÂΩ¢ (1x1)
            };

            // ËààÂë≥„ÅÆÊ∑±„ÅïÊÉÖÂ†±„ÇíÂèñÂæó„Åô„ÇãÈñ¢Êï∞
            const getDepthInfo = (depth) => {
                if (depth <= 30) {
                    return {
                        label: 'ÁßÅÁöÑËààÂë≥',
                        description: 'ÂÄã‰∫∫ÁöÑ„Å™Ë∂£Âë≥„ÇÑÈñ¢ÂøÉ‰∫ã„Å´ÁÑ¶ÁÇπ„ÇíÂΩì„Å¶„ÅüË®ò‰∫ã„Åå‰∏≠ÂøÉ„Å®„Å™„Çä„Åæ„Åô„ÄÇ'
                    };
                } else if (depth <= 70) {
                    return {
                        label: '„Éê„É©„É≥„Çπ',
                        description: 'Êßò„ÄÖ„Å™„Ç∏„É£„É≥„É´„ÅÆË®ò‰∫ã„Çí„Éê„É©„É≥„ÇπËâØ„ÅèË°®Á§∫„Åó„Åæ„Åô„ÄÇ'
                    };
                } else {
                    return {
                        label: '„Éë„Éº„ÇΩ„Éä„É´',
                        description: '„Éì„Ç∏„Éç„Çπ„ÉªÊäÄË°ìÁ≥ª„ÅÆÂ∞ÇÈñÄÁöÑ„Å™Ë®ò‰∫ã„Åå‰∏≠ÂøÉ„Å®„Å™„Çä„Åæ„Åô„ÄÇ'
                    };
                }
            };

            // „ÅäÊ∞ó„Å´ÂÖ•„Çä„É¨„Éù„Éº„ÉàÁÆ°ÁêÜÔºà„Éà„Ç∞„É´Ê©üËÉΩ‰ªò„ÅçÔºâ
            const toggleFavorites = (reportData, event) => {
                const newReport = {
                    title: reportData.title,
                    type: reportData.type,
                    tags: reportData.tags,
                    timestamp: new Date().toISOString(),
                    articleCount: reportData.articleCount
                };
                
                setFavoriteReports(prev => {
                    // Êó¢Â≠ò„ÉÅ„Çß„ÉÉ„ÇØ
                    const existingIndex = prev.findIndex(report =>
                        report.type === newReport.type &&
                        JSON.stringify(report.tags.sort()) === JSON.stringify(newReport.tags.sort())
                    );

                    let updatedReports;
                    if (existingIndex !== -1) {
                        // Êó¢Â≠ò„ÅÆÂ†¥Âêà„ÅØÂâäÈô§ÔºàËß£Èô§Ôºâ
                        if (event) {
                            showCompletionAnimation(event.target, 'delete');
                        }
                        updatedReports = prev.filter((_, index) => index !== existingIndex);
                    } else {
                        // Êñ∞Ë¶è„ÅÆÂ†¥Âêà„ÅØËøΩÂä†
                        const reportId = `${reportData.type}_${reportData.tags.join('_')}_${Date.now()}`;
                        const reportWithId = { ...newReport, id: reportId };

                        if (event) {
                            showCompletionAnimation(event.target, 'success');
                        }
                        updatedReports = [...prev, reportWithId];
                    }

                    // „É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Å´‰øùÂ≠ò
                    try {
                        localStorage.setItem('favoriteReports', JSON.stringify(updatedReports));
                        console.log('„ÅäÊ∞ó„Å´ÂÖ•„Çä‰øùÂ≠òÂÆå‰∫Ü:', updatedReports);
                    } catch (error) {
                        console.error('„ÅäÊ∞ó„Å´ÂÖ•„Çä‰øùÂ≠ò„Ç®„É©„Éº:', error);
                    }

                    return updatedReports;
                });
            };
            
            // ÊóßÈñ¢Êï∞Âêç„Å®„ÅÆ‰∫íÊèõÊÄß„ÅÆ„Åü„ÇÅ
            const addToFavorites = toggleFavorites;
            
            // „ÅäÊ∞ó„Å´ÂÖ•„ÇäÁä∂ÊÖã„ÉÅ„Çß„ÉÉ„ÇØ
            const isFavorite = (reportData) => {
                return favoriteReports.some(report => 
                    report.type === reportData.type && 
                    JSON.stringify(report.tags.sort()) === JSON.stringify(reportData.tags.sort())
                );
            };

            const removeFromFavorites = (reportId, event) => {
                setFavoriteReports(prev => {
                    const updatedReports = prev.filter(report => report.id !== reportId);

                    // „É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Å´‰øùÂ≠ò
                    try {
                        localStorage.setItem('favoriteReports', JSON.stringify(updatedReports));
                    } catch (error) {
                        console.error('„ÅäÊ∞ó„Å´ÂÖ•„ÇäÂâäÈô§‰øùÂ≠ò„Ç®„É©„Éº:', error);
                    }

                    return updatedReports;
                });

                // ÂâäÈô§ÊôÇ„ÅÆÂÆå‰∫Ü„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
                if (event) {
                    showCompletionAnimation(event.target, 'delete');
                }
            };

            // ‰ΩúÊ•≠ÂÆå‰∫ÜÊÑü„ÅÆ„ÅÇ„Çã„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
            const showCompletionAnimation = (target, type) => {
                if (!target) return;
                
                // „Éú„Çø„É≥„ÅÆ‰∏ÄÊôÇÁöÑ„Å™Â§âÊõ¥
                const originalHTML = target.innerHTML;
                const originalClass = target.getAttribute('class') || target.className || '';
                
                // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥Áä∂ÊÖã„Å´Â§âÊõ¥
                target.style.transform = 'scale(1.2)';
                target.style.transition = 'all 0.2s cubic-bezier(0.68, -0.55, 0.265, 1.55)';
                
                if (type === 'success') {
                    target.innerHTML = `
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                            <path d="M20 6L9 17l-5-5"/>
                        </svg>
                    `;
                    target.setAttribute('class', String(originalClass).replace('text-gray-400', 'text-green-500'));
                } else if (type === 'existing') {
                    target.innerHTML = `
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="M12 6v6l4 2"/>
                        </svg>
                    `;
                    target.setAttribute('class', String(originalClass).replace('text-gray-400', 'text-orange-500'));
                } else if (type === 'delete') {
                    target.innerHTML = `
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                            <path d="M20 6L9 17l-5-5"/>
                        </svg>
                    `;
                    target.setAttribute('class', String(originalClass).replace('text-gray-400', 'text-red-500'));
                }
                
                // Ê≥¢Á¥ã„Ç®„Éï„Çß„ÇØ„Éà
                const ripple = document.createElement('div');
                ripple.style.position = 'absolute';
                ripple.style.borderRadius = '50%';
                ripple.style.background = type === 'success' ? 'rgba(34, 197, 94, 0.3)' : 
                                         type === 'existing' ? 'rgba(249, 115, 22, 0.3)' : 
                                         'rgba(239, 68, 68, 0.3)';
                ripple.style.transform = 'scale(0)';
                ripple.style.animation = 'ripple 0.6s linear';
                ripple.style.width = '40px';
                ripple.style.height = '40px';
                ripple.style.left = '-12px';
                ripple.style.top = '-12px';
                ripple.style.pointerEvents = 'none';
                
                target.style.position = 'relative';
                target.appendChild(ripple);
                
                // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÁµÇ‰∫ÜÂæå„Å´ÂÖÉ„Å´Êàª„Åô
                setTimeout(() => {
                    target.style.transform = 'scale(1)';
                    setTimeout(() => {
                        target.innerHTML = originalHTML;
                        target.setAttribute('class', String(originalClass));
                        target.style.transform = '';
                        target.style.transition = '';
                        if (ripple.parentNode) {
                            ripple.parentNode.removeChild(ripple);
                        }
                    }, 200);
                }, 400);
            };

            // „Éá„Éº„ÇøË™≠„ÅøËæº„Åø
            useEffect(() => {
                const initializeData = async () => {
                    await loadData();
                    
                    console.log('‚úÖ „Éá„Éº„Çø„Çí‰ΩøÁî®');
                    console.log('Ë®ò‰∫ãÊï∞:', inlineData.articles.length);
                    
                    // Ë®ò‰∫ã„Å´Ë©±È°åÊÄß„Çπ„Ç≥„Ç¢„Å®ÈùôÁöÑ„Çµ„Ç§„Ç∫„ÇíËøΩÂä†
                    const articlesWithTopicality = inlineData.articles.map(article => {
                        const topicalityScore = calculateTopicalityScore(article);
                        const staticGridSize = getStaticGridSize(topicalityScore);
                        return {
                            ...article,
                            topicalityScore,
                            staticGridSize
                        };
                    });
                    
                    console.log('Ë©±È°åÊÄß„Çπ„Ç≥„Ç¢‰ªò„ÅçË®ò‰∫ã:', articlesWithTopicality.map(a => ({ 
                        title: a.title, 
                        score: a.topicalityScore,
                        size: a.staticGridSize
                    })));
                    
                    setArticles(articlesWithTopicality);
                    setHierarchicalTags(inlineData.hierarchical_tags);
                    
                    // ÂàùÊúü„Çø„Ç∞„Å®„É™„É≥„ÇØ„ÇíË®≠ÂÆö
                    const { defaultTags, defaultLinks } = initializeDefaultTags();
                    setCollectedTags(defaultTags);
                    setTagLinks(defaultLinks);
                    
                    setDataLoaded(true);
                };
                
                initializeData();
            }, []);

            const handleArticleRead = (article, event) => {
                console.log('handleArticleReadÂÆüË°å:', { article, showFavorites, currentView });
                // ÁèæÂú®„ÅÆÁîªÈù¢Áä∂ÊÖã„Çí‰øùÂ≠ò
                if (showFavorites) {
                    setPreviousView('favorites');
                } else if (currentView === 'favorites') {
                    setPreviousView('favoritesList');
                } else {
                    setPreviousView('main');
                }

                // Ë®ò‰∫ãË©≥Á¥∞Ë°®Á§∫
                console.log('Ë®ò‰∫ãË©≥Á¥∞Ë°®Á§∫Ë®≠ÂÆö‰∏≠...');
                setSelectedArticle(article);
                setShowArticleDetail(true);
                console.log('Ë®ò‰∫ãË©≥Á¥∞Ë°®Á§∫Ë®≠ÂÆöÂÆå‰∫Ü');

                // „Éë„Éº„ÉÜ„Ç£„ÇØ„É´„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÈñãÂßã
                const rect = event.target.getBoundingClientRect();
                const startX = rect.left + rect.width / 2;
                const startY = rect.top + rect.height / 2;
                
                if (window.startParticleEffect) {
                    window.startParticleEffect(startX, startY, article.tags);
                }

                // „Çø„Ç∞„ÇíÂèéÈõÜ
                const newTags = new Map(collectedTags);
                const newLinks = [...tagLinks];

                article.tags.forEach(tagId => {
                    if (newTags.has(tagId)) {
                        const existingTag = newTags.get(tagId);
                        existingTag.count++;
                        existingTag.size = 1 + existingTag.count * 0.3;
                        newTags.set(tagId, existingTag);
                    } else {
                        newTags.set(tagId, {
                            id: tagId,
                            count: 1,
                            size: 1,
                            x: Math.random() * 800 + 100,
                            y: Math.random() * 400 + 100
                        });
                    }
                });

                // „Çø„Ç∞Èñì„ÅÆ„É™„É≥„ÇØ„ÇíÁîüÊàê
                for (let i = 0; i < article.tags.length; i++) {
                    for (let j = i + 1; j < article.tags.length; j++) {
                        const sourceTag = article.tags[i];
                        const targetTag = article.tags[j];
                        
                        const linkExists = newLinks.some(link =>
                            (link.source === sourceTag && link.target === targetTag) ||
                            (link.source === targetTag && link.target === sourceTag)
                        );

                        if (!linkExists) {
                            newLinks.push({ source: sourceTag, target: targetTag });
                        }
                    }
                }

                setCollectedTags(newTags);
                setTagLinks(newLinks);
            };

            const handleTagClick = (tagId) => {
                // „Çø„Ç∞ÈÅ∏Êäû„ÅÆÂàá„ÇäÊõø„Åà
                setSelectedTags(prev => {
                    if (prev.includes(tagId)) {
                        return prev.filter(id => id !== tagId);
                    } else {
                        return [...prev, tagId];
                    }
                });
            };

            const handleTagExpand = (tagId) => {
                const children = hierarchicalTags[tagId];
                if (!children) return;

                const newTags = new Map(collectedTags);
                const newLinks = [...tagLinks];
                
                if (newTags.has(tagId)) {
                    const parentTag = newTags.get(tagId);
                    parentTag.isExpanded = true;
                    newTags.set(tagId, parentTag);
                }

                children.forEach(childTag => {
                    if (!newTags.has(childTag)) {
                        newTags.set(childTag, {
                            id: childTag,
                            count: 1,
                            size: 0.7,
                            x: Math.random() * 800 + 100,
                            y: Math.random() * 400 + 100,
                            parent: tagId,
                            isChild: true
                        });

                        newLinks.push({ source: tagId, target: childTag });
                    }
                });

                setCollectedTags(newTags);
                setTagLinks(newLinks);
            };

            // „Ç∞„É©„Éá„Éº„Ç∑„Éß„É≥Ëâ≤„ÇíÂèñÂæó„Åô„ÇãÈñ¢Êï∞
            const getGradientColor = (depth) => {
                // „Éê„É©„É≥„Çπ„Éê„Éº„Å®Âêå„Åò„Ç∞„É©„Éá„Éº„Ç∑„Éß„É≥: „Éî„É≥„ÇØ -> Èùí -> Ê∞¥Ëâ≤ -> Á∑ë
                if (depth <= 33) {
                    // „Éî„É≥„ÇØ„Åã„ÇâÈùí„Å∏ (0-33%)
                    const ratio = depth / 33;
                    const r = Math.round(236 + (59 - 236) * ratio);  // #ec4899 -> #3b82f6
                    const g = Math.round(72 + (130 - 72) * ratio);
                    const b = Math.round(153 + (246 - 153) * ratio);
                    return `rgb(${r}, ${g}, ${b})`;
                } else if (depth <= 66) {
                    // Èùí„Åã„ÇâÊ∞¥Ëâ≤„Å∏ (33-66%)
                    const ratio = (depth - 33) / 33;
                    const r = Math.round(59 + (6 - 59) * ratio);     // #3b82f6 -> #06b6d4
                    const g = Math.round(130 + (182 - 130) * ratio);
                    const b = Math.round(246 + (212 - 246) * ratio);
                    return `rgb(${r}, ${g}, ${b})`;
                } else {
                    // Ê∞¥Ëâ≤„Åã„ÇâÁ∑ë„Å∏ (66-100%)
                    const ratio = (depth - 66) / 34;
                    const r = Math.round(6 + (16 - 6) * ratio);      // #06b6d4 -> #10b981
                    const g = Math.round(182 + (185 - 182) * ratio);
                    const b = Math.round(212 + (129 - 212) * ratio);
                    return `rgb(${r}, ${g}, ${b})`;
                }
            };
            

            // „Éû„ÉÉ„ÉóÁîªÈù¢Áî®ÔºöÈÅ∏Êäû„Åï„Çå„Åü„Çø„Ç∞„Å´Èñ¢ÈÄ£„Åô„ÇãË®ò‰∫ã„Çí„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
            const getMapFilteredArticles = () => {
                let baseArticles = articles;
                
                if (selectedTags.length > 0) {
                    const mainSelectedTag = selectedTags[0];
                    
                    // 1. ÈÅ∏Êäû„Çø„Ç∞„Å´Áõ¥Êé•Èñ¢ÈÄ£„Åô„ÇãË®ò‰∫ã„ÇíÂèñÂæó
                    const directMatches = baseArticles.filter(article =>
                        article.tags.includes(mainSelectedTag)
                    );
                    
                    // 2. ÈÅ∏Êäû„Çø„Ç∞„ÅÆ„Ç≥„É≥„ÉÜ„Ç≠„Çπ„ÉàÔºàÁßÅÁöÑ/ÂÖ¨ÁöÑÔºâ„Å´Âü∫„Å•„ÅÑ„Å¶Ë®ò‰∫ã„Çí„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
                    const contextualTags = getContextualTags(mainSelectedTag, 50);
                    const contextualMatches = baseArticles.filter(article =>
                        article.tags.some(tag => contextualTags.includes(tag))
                    );
                    
                    // 3. ÂÖ®Ë®ò‰∫ã„ÇíËøΩÂä†Ôºà„Éï„Ç£„Éº„Éâ„Éì„É•„Éº„ÅåÂâäÈô§„Åï„Çå„Åü„Åü„ÇÅÔºâ
                    const additionalArticles = baseArticles;
                    
                    // 4. ÈáçË§á„ÇíÈô§„ÅÑ„Å¶ÂÑ™ÂÖàÈ†Ü‰Ωç„Åß„ÇΩ„Éº„Éà
                    const allArticles = [...directMatches, ...contextualMatches, ...additionalArticles];
                    const uniqueArticles = Array.from(
                        new Map(allArticles.map(article => [article.title, article])).values()
                    );
                    
                    // 5. Èñ¢ÈÄ£Â∫¶„Åß„ÇΩ„Éº„Éà
                    uniqueArticles.sort((a, b) => {
                        const aDirectMatch = a.tags.includes(mainSelectedTag) ? 3 : 0;
                        const aContextMatch = a.tags.some(tag => contextualTags.includes(tag)) ? 2 : 0;
                        const aTagCount = a.tags.filter(tag => selectedTags.includes(tag)).length;
                        
                        const bDirectMatch = b.tags.includes(mainSelectedTag) ? 3 : 0;
                        const bContextMatch = b.tags.some(tag => contextualTags.includes(tag)) ? 2 : 0;
                        const bTagCount = b.tags.filter(tag => selectedTags.includes(tag)).length;
                        
                        const aScore = aDirectMatch + aContextMatch + aTagCount;
                        const bScore = bDirectMatch + bContextMatch + bTagCount;
                        
                        return bScore - aScore;
                    });
                    
                    return uniqueArticles;
                } else {
                    // ÈÅ∏Êäû„Çø„Ç∞„Å™„Åó„ÅÆÂ†¥Âêà„ÅØÂÖ®Ë®ò‰∫ãË°®Á§∫
                    return articles;
                }
            };

            const tagsArray = Array.from(collectedTags.values());
            
            // „Éû„ÉÉ„Éó„Éì„É•„ÉºÂ∞ÇÁî®„ÅÆ„Åü„ÇÅ„ÄÅÂÖ®Ë®ò‰∫ã„ÇíË°®Á§∫
            const filteredArticles = articles;

            // D3.js„Éû„ÉÉ„Éó„ÅÆÂàùÊúüÂåñ„Å®„Ç¢„ÉÉ„Éó„Éá„Éº„Éà
            useEffect(() => {
                if (currentView !== 'map' || tagsArray.length === 0) return;

                const container = document.getElementById('map-container');
                const svg = d3.select("#mapSvg");
                
                if (!container || !svg.node()) return;

                const width = container.clientWidth;
                const height = container.clientHeight;

                // Êó¢Â≠ò„ÅÆË¶ÅÁ¥†„Çí„ÇØ„É™„Ç¢
                svg.selectAll("*").remove();

                // ËÉåÊôØ„ÅÆÈÄèÊòé„Å™Áü©ÂΩ¢„ÇíËøΩÂä†Ôºà„ÇØ„É™„ÉÉ„ÇØÈ†òÂüü„Å®„Åó„Å¶Ôºâ
                const background = svg.append("rect")
                    .attr("width", width)
                    .attr("height", height)
                    .attr("fill", "transparent")
                    .style("cursor", "pointer");

                // „Ç∞„É´„Éº„Éó„ÅÆ‰ΩúÊàê
                const linkGroup = svg.append("g").attr("class", "links");
                const nodeGroup = svg.append("g").attr("class", "nodes");
                const textGroup = svg.append("g").attr("class", "texts");

                // „Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥„ÅÆ„Çª„ÉÉ„Éà„Ç¢„ÉÉ„ÉóÔºàÂÆâÂÆöÂåñÔºâ
                const simulation = d3.forceSimulation(tagsArray)
                    .force("link", d3.forceLink(tagLinks)
                        .id(d => d.id)
                        .distance(80)
                        .strength(0.3))
                    .force("charge", d3.forceManyBody()
                        .strength(-150)
                        .distanceMin(30)
                        .distanceMax(200))
                    .force("center", d3.forceCenter(width / 2, height / 2)
                        .strength(0.05))
                    .force("collision", d3.forceCollide()
                        .radius(d => 25 + d.size * 5)
                        .strength(0.7))
                    .alphaDecay(0.02)
                    .velocityDecay(0.3);

                // „É™„É≥„ÇØ„ÅÆÊèèÁîª
                const links = linkGroup
                    .selectAll("line")
                    .data(tagLinks)
                    .enter()
                    .append("line")
                    .style("stroke", "rgba(255, 255, 255, 0.2)")
                    .style("stroke-width", 2);

                // „Éé„Éº„Éâ„ÅÆÊèèÁîª
                const nodes = nodeGroup
                    .selectAll("circle")
                    .data(tagsArray)
                    .enter()
                    .append("circle")
                    .attr("r", d => 15 + d.size * 8)
                    .style("fill", d => {
                        if (d.isChild) {
                            // Â≠ê„Çø„Ç∞„ÅØÂ∞ë„ÅóÊöó„ÇÅ„Å´
                            const baseColor = getGradientColor(interestDepth);
                            const rgb = baseColor.match(/\d+/g);
                            const r = Math.max(0, parseInt(rgb[0]) - 30);
                            const g = Math.max(0, parseInt(rgb[1]) - 30);
                            const b = Math.max(0, parseInt(rgb[2]) - 30);
                            return `rgb(${r}, ${g}, ${b})`;
                        }
                        return getGradientColor(interestDepth);
                    })
                    .style("stroke", "rgba(255, 255, 255, 0.8)")
                    .style("stroke-width", 2)
                    .style("cursor", "pointer")
                    .style("filter", "drop-shadow(0 4px 8px rgba(0,0,0,0.3))")
                    .style("stroke-width", d => selectedTags.includes(d.id) ? 4 : 2)
                    .style("stroke", d => selectedTags.includes(d.id) ? "#fbbf24" : "rgba(255, 255, 255, 0.8)")
                    .on("click", (event, d) => {
                        event.stopPropagation();
                        if (event.shiftKey) {
                            // Shift„ÇØ„É™„ÉÉ„ÇØ„ÅßÈÅ∏Êäû„ÅÆ„Åø
                            handleTagClick(d.id);
                        } else {
                            // ÈÄöÂ∏∏„ÇØ„É™„ÉÉ„ÇØ„ÅßÂ±ïÈñã
                            const children = hierarchicalTags[d.id];
                            if (children && !d.isExpanded) {
                                handleTagExpand(d.id);
                            } else {
                                // Â±ïÈñãÊ∏à„Åø„Åæ„Åü„ÅØÂ≠ê„Çø„Ç∞„Åå„Å™„ÅÑÂ†¥Âêà„ÅØÈÅ∏Êäû
                                handleTagClick(d.id);
                            }
                        }
                    })
                    .on("mouseover", function(event, d) {
                        d3.select(this)
                            .transition()
                            .duration(200)
                            .attr("r", (15 + d.size * 8) * 1.2)
                            .style("filter", "drop-shadow(0 6px 12px rgba(0,0,0,0.4))");
                    })
                    .on("mouseout", function(event, d) {
                        d3.select(this)
                            .transition()
                            .duration(200)
                            .attr("r", 15 + d.size * 8)
                            .style("filter", "drop-shadow(0 4px 8px rgba(0,0,0,0.3))");
                    });

                // „ÉÜ„Ç≠„Çπ„Éà„É©„Éô„É´„ÅÆÊèèÁîª
                const texts = textGroup
                    .selectAll("text")
                    .data(tagsArray)
                    .enter()
                    .append("text")
                    .text(d => d.id)
                    .style("fill", "white")
                    .style("font-size", d => `${12 + d.size * 2}px`)
                    .style("font-weight", "600")
                    .style("text-anchor", "middle")
                    .style("dominant-baseline", "central")
                    .style("pointer-events", "none")
                    .style("text-shadow", "1px 1px 2px rgba(0,0,0,0.8)");

                // „Éâ„É©„ÉÉ„Ç∞Âá¶ÁêÜÔºàÊªë„Çâ„Åã„Å´Ôºâ
                const drag = d3.drag()
                    .on("start", (event, d) => {
                        if (!event.active) simulation.alphaTarget(0.1).restart();
                        d.fx = d.x;
                        d.fy = d.y;
                        // „Éâ„É©„ÉÉ„Ç∞‰∏≠„ÅØÈÄüÂ∫¶„ÇíÂà∂Èôê
                        d.vx = d.vx * 0.1;
                        d.vy = d.vy * 0.1;
                    })
                    .on("drag", (event, d) => {
                        d.fx = event.x;
                        d.fy = event.y;
                    })
                    .on("end", (event, d) => {
                        if (!event.active) simulation.alphaTarget(0.05);
                        // „Éâ„É©„ÉÉ„Ç∞ÁµÇ‰∫ÜÂæå„ÇÇ‰ΩçÁΩÆ„Çí‰øùÊåÅ„Åó„Å™„ÅÑ
                        setTimeout(() => {
                            d.fx = null;
                            d.fy = null;
                        }, 500);
                    });

                nodes.call(drag);

                // „Ç∫„Éº„É†Âá¶ÁêÜ
                const zoom = d3.zoom()
                    .scaleExtent([0.5, 3])
                    .filter((event) => {
                        // ËÉåÊôØÁü©ÂΩ¢„ÅÆ„ÇØ„É™„ÉÉ„ÇØ„ÅØÈÄö„Åô„ÄÅ‰ªñ„ÅÆ„Ç∫„Éº„É†Êìç‰Ωú„ÅØÂà∂Èôê
                        return !event.button && (event.type !== 'click');
                    })
                    .on("zoom", (event) => {
                        linkGroup.attr("transform", event.transform);
                        nodeGroup.attr("transform", event.transform);
                        textGroup.attr("transform", event.transform);
                    });

                svg.call(zoom);
                
                // „Éé„Éº„Éâ„Çí‰∏≠Â§Æ„Å´„É™„Çª„ÉÉ„Éà„Åô„ÇãÈñ¢Êï∞
                const resetNodesPosition = () => {
                    console.log("„É™„Çª„ÉÉ„ÉàÈñãÂßã");
                    
                    // 1. Âõ∫ÂÆö‰ΩçÁΩÆ„Å®ÈÄüÂ∫¶„Çí„ÇØ„É™„Ç¢
                    tagsArray.forEach(d => {
                        d.fx = null;
                        d.fy = null;
                        d.vx = 0;
                        d.vy = 0;
                        // ‰∏≠Â§Æ‰ªòËøë„Å´„Ç≥„É≥„Éë„ÇØ„Éà„Å´ÈÖçÁΩÆ
                        d.x = width/2 + (Math.random() - 0.5) * 60;
                        d.y = height/2 + (Math.random() - 0.5) * 60;
                    });
                    
                    // 2. „Ç∫„Éº„É†„É™„Çª„ÉÉ„Éà
                    svg.call(zoom.transform, d3.zoomIdentity);
                    
                    // 3. „Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥„ÇíÁ©è„ÇÑ„Åã„Å´ÂÜçÈñã
                    simulation
                        .alpha(0.2)
                        .alphaTarget(0.05)
                        .restart();
                    
                    console.log("„É™„Çª„ÉÉ„ÉàÂÆå‰∫Ü");
                };
                
                // ËÉåÊôØÁü©ÂΩ¢„ÅÆ„ÇØ„É™„ÉÉ„ÇØ„Åß„É™„Çª„ÉÉ„Éà
                background.on("click", (event) => {
                    console.log("ËÉåÊôØ„ÇØ„É™„ÉÉ„ÇØÊ§úÁü•!", event);
                    resetNodesPosition();
                });
                
                // SVG„ÅÆ„Éá„Éï„Ç©„É´„Éà„Ç∫„Éº„É†Âãï‰Ωú„ÇíÁÑ°ÂäπÂåñ
                svg.on("dblclick.zoom", null);

                // „Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥„ÅÆÊõ¥Êñ∞
                simulation.on("tick", () => {
                    links
                        .attr("x1", d => d.source.x)
                        .attr("y1", d => d.source.y)
                        .attr("x2", d => d.target.x)
                        .attr("y2", d => d.target.y);

                    nodes
                        .attr("cx", d => d.x)
                        .attr("cy", d => d.y);

                    texts
                        .attr("x", d => d.x)
                        .attr("y", d => d.y);
                });

            }, [currentView, tagsArray, tagLinks, interestDepth, selectedTags]);
            
            // ÈÅ∏Êäû„Éé„Éº„Éâ„Å´Èñ¢ÈÄ£„Åô„Çã„Ç≥„É≥„ÉÜ„Ç≠„Çπ„Éà„Çø„Ç∞„ÇíÂèñÂæó
            const getContextualTags = (selectedTag, interestLevel) => {
                const tagContexts = {
                    'ÊóÖË°å': {
                        private: ['ÊñôÁêÜ', 'Ê∏©Ê≥â', '„Ç∞„É´„É°', '„É™„Çæ„Éº„Éà', '„Éï„Ç©„Éà', '‰ºëÊó•'],
                        professional: ['Âá∫Âºµ', '‰ºöË≠∞', '„Éì„Ç∏„Éç„Çπ„Éõ„ÉÜ„É´', '„Éç„ÉÉ„Éà„ÉØ„Éº„Ç≠„É≥„Ç∞', 'ÊñáÂåñ‰∫§ÊµÅ'],
                        balanced: ['ÊñôÁêÜ', 'ÊñáÂåñ', 'Ê≠¥Âè≤', '‰∫§ÈÄö', '„Éõ„ÉÜ„É´']
                    },
                    'ÊñôÁêÜ': {
                        private: ['ÊâãÊñôÁêÜ', '„Çπ„Ç§„Éº„ÉÑ', 'ÂÆ∂Â∫≠ÊñôÁêÜ', '„É¨„Ç∑„Éî', '„Åä„ÇÑ„Å§'],
                        professional: ['„É¨„Çπ„Éà„É©„É≥', '„Éï„Éº„Éâ„Éì„Ç∏„Éç„Çπ', 'Ê†ÑÈ§äÂ≠¶', '„Éï„Éº„Éâ„ÉÜ„ÉÉ„ÇØ'],
                        balanced: ['ÂíåÈ£ü', 'ÂØøÂè∏', '„Ç∞„É´„É°', 'ÊóÖË°å', 'ÊñáÂåñ']
                    },
                    'AI': {
                        private: ['„ÉÅ„É£„ÉÉ„Éà„Éú„ÉÉ„Éà', '„Ç≤„Éº„É†', '„Ç¢„Éó„É™', 'Èü≥Â£∞„Ç¢„Ç∑„Çπ„Çø„É≥„Éà'],
                        professional: ['Ê©üÊ¢∞Â≠¶Áøí', 'ÊäÄË°ì', '„Éì„Ç∏„Éç„Çπ', '„Éá„Éº„ÇøÂàÜÊûê', 'Ëá™ÂãïÂåñ'],
                        balanced: ['ÊäÄË°ì', '„Ç§„Éé„Éô„Éº„Ç∑„Éß„É≥', 'Êú™Êù•', 'Á§æ‰ºö']
                    },
                    'ÂãïÁâ©': {
                        private: ['„Éö„ÉÉ„Éà', 'Áå´', 'Áä¨', '„Ç¢„Éã„Éû„É´„Ç´„Éï„Çß', 'ÂãïÁâ©Âúí'],
                        professional: ['Áç£ÂåªÂ≠¶', 'ÁîüÊÖãÂ≠¶', 'Áµ∂ÊªÖ‰øùË≠∑', 'SDGs', 'Áí∞Â¢É'],
                        balanced: ['„Éö„ÉÉ„Éà', 'Ëá™ÁÑ∂', 'Áí∞Â¢É', '‰øùË≠∑']
                    }
                };
                
                const context = tagContexts[selectedTag];
                if (!context) return [];
                
                if (interestLevel < 30) return context.private || [];
                if (interestLevel > 70) return context.professional || [];
                return context.balanced || [];
            };
            
            // ËààÂë≥„ÅÆÊ∑±„Åï„Å´Âøú„Åò„ÅüÂãïÁöÑ„Çø„Ç∞ÁîüÊàê
            const generateDynamicTags = (depth) => {
                if (depth <= 30) {
                    // ÁßÅÁöÑËààÂë≥ÔºöÂÖ∑‰ΩìÁöÑ„ÅßÂÄã‰∫∫ÁöÑ„Å™„Çø„Ç∞
                    return [
                        { id: 'ÂåóÊµ∑ÈÅì', size: 1.2, x: 180, y: 120, category: 'private' },
                        { id: 'Ê≤ñÁ∏Ñ', size: 1.1, x: 320, y: 100, category: 'private' },
                        { id: 'Ê∏©Ê≥â', size: 1.0, x: 460, y: 130, category: 'private' },
                        { id: 'ÂÆ∂Â∫≠ÊñôÁêÜ', size: 1.0, x: 200, y: 280, category: 'private' },
                        { id: '„Éö„ÉÉ„Éà', size: 1.0, x: 380, y: 320, category: 'private' },
                        { id: 'Áå´', size: 0.9, x: 520, y: 260, category: 'private' },
                        { id: '„Ç¢„Éã„É°', size: 0.8, x: 150, y: 350, category: 'private' },
                        { id: '„Ç≤„Éº„É†', size: 0.8, x: 580, y: 180, category: 'private' }
                    ];
                } else if (depth <= 70) {
                    // „Éê„É©„É≥„ÇπÔºö‰∏ÄËà¨ÁöÑ„Å™„Çø„Ç∞
                    return [
                        { id: 'AI', size: 1.2, x: 180, y: 120, category: 'balanced' },
                        { id: 'ÊäÄË°ì', size: 1.1, x: 320, y: 100, category: 'balanced' },
                        { id: '„Éì„Ç∏„Éç„Çπ', size: 1.0, x: 460, y: 130, category: 'balanced' },
                        { id: 'ÊñôÁêÜ', size: 1.0, x: 200, y: 280, category: 'balanced' },
                        { id: 'ÊóÖË°å', size: 1.0, x: 380, y: 320, category: 'balanced' },
                        { id: 'ÂãïÁâ©', size: 0.9, x: 520, y: 260, category: 'balanced' },
                        { id: '„Éï„Ç°„ÉÉ„Ç∑„Éß„É≥', size: 0.8, x: 150, y: 350, category: 'balanced' },
                        { id: 'SDGs', size: 0.8, x: 580, y: 180, category: 'balanced' }
                    ];
                } else {
                    // „Éë„Éº„ÇΩ„Éä„É´Ôºö„Éì„Ç∏„Éç„Çπ„ÉªÂ∞ÇÈñÄÁöÑ„Å™„Çø„Ç∞
                    return [
                        { id: 'Ê©üÊ¢∞Â≠¶Áøí', size: 1.2, x: 180, y: 120, category: 'professional' },
                        { id: '„Çπ„Çø„Éº„Éà„Ç¢„ÉÉ„Éó', size: 1.1, x: 320, y: 100, category: 'professional' },
                        { id: '„Éû„Éº„Ç±„ÉÜ„Ç£„É≥„Ç∞', size: 1.0, x: 460, y: 130, category: 'professional' },
                        { id: '„Éï„Éº„Éâ„ÉÜ„ÉÉ„ÇØ', size: 1.0, x: 200, y: 280, category: 'professional' },
                        { id: 'Êµ∑Â§ñÊóÖË°å', size: 1.0, x: 380, y: 320, category: 'professional' },
                        { id: '„ÉÑ„Ç¢„Éº', size: 0.9, x: 520, y: 260, category: 'professional' },
                        { id: 'E„Ç≥„Éû„Éº„Çπ', size: 0.8, x: 150, y: 350, category: 'professional' },
                        { id: '„Éá„Éº„ÇøÂàÜÊûê', size: 0.8, x: 580, y: 180, category: 'professional' }
                    ];
                }
            };

            // „Éû„ÉÉ„ÉóÁî®„ÅÆ„Çø„Ç∞„Çª„ÉÉ„Éà„ÇíÂàùÊúüÂåñ
            useEffect(() => {
                if (currentView === 'map') {
                    const currentTags = generateDynamicTags(interestDepth);
                    
                    // „Çø„Ç∞„Éû„ÉÉ„Éó„Çí‰ΩúÊàê
                    const updatedTags = new Map();
                    currentTags.forEach(tag => {
                        const existingTag = collectedTags.get(tag.id);
                        updatedTags.set(tag.id, {
                            id: tag.id,
                            count: existingTag ? existingTag.count : 1,
                            size: tag.size,
                            x: existingTag ? existingTag.x : tag.x,
                            y: existingTag ? existingTag.y : tag.y,
                            category: tag.category,
                            fx: existingTag ? existingTag.fx : null,
                            fy: existingTag ? existingTag.fy : null
                        });
                    });
                    
                    // ÂãïÁöÑ„É™„É≥„ÇØÈñ¢‰øÇ„Çí‰ΩúÊàê
                    let updatedLinks = [];
                    if (interestDepth <= 30) {
                        // ÁßÅÁöÑËààÂë≥„ÅÆ„É™„É≥„ÇØ
                        updatedLinks = [
                            { source: 'ÂåóÊµ∑ÈÅì', target: 'Ê∏©Ê≥â' },
                            { source: 'Ê≤ñÁ∏Ñ', target: 'Ê∏©Ê≥â' },
                            { source: 'ÂÆ∂Â∫≠ÊñôÁêÜ', target: '„Éö„ÉÉ„Éà' },
                            { source: 'Áå´', target: '„Éö„ÉÉ„Éà' },
                            { source: '„Ç¢„Éã„É°', target: '„Ç≤„Éº„É†' }
                        ];
                    } else if (interestDepth <= 70) {
                        // „Éê„É©„É≥„Çπ„ÅÆ„É™„É≥„ÇØ
                        updatedLinks = [
                            { source: 'AI', target: 'ÊäÄË°ì' },
                            { source: 'ÊäÄË°ì', target: '„Éì„Ç∏„Éç„Çπ' },
                            { source: 'ÊñôÁêÜ', target: 'ÊóÖË°å' },
                            { source: 'ÂãïÁâ©', target: '„Éï„Ç°„ÉÉ„Ç∑„Éß„É≥' },
                            { source: '„Éì„Ç∏„Éç„Çπ', target: 'SDGs' }
                        ];
                    } else {
                        // „Éë„Éº„ÇΩ„Éä„É´„ÉªÂ∞ÇÈñÄÁöÑ„Å™„É™„É≥„ÇØ
                        updatedLinks = [
                            { source: 'Ê©üÊ¢∞Â≠¶Áøí', target: '„Éá„Éº„ÇøÂàÜÊûê' },
                            { source: '„Çπ„Çø„Éº„Éà„Ç¢„ÉÉ„Éó', target: '„Éû„Éº„Ç±„ÉÜ„Ç£„É≥„Ç∞' },
                            { source: '„Éï„Éº„Éâ„ÉÜ„ÉÉ„ÇØ', target: 'E„Ç≥„Éû„Éº„Çπ' },
                            { source: 'Êµ∑Â§ñÊóÖË°å', target: '„ÉÑ„Ç¢„Éº' },
                            { source: '„Éû„Éº„Ç±„ÉÜ„Ç£„É≥„Ç∞', target: '„Éá„Éº„ÇøÂàÜÊûê' }
                        ];
                    }
                    
                    setCollectedTags(updatedTags);
                    setTagLinks(updatedLinks);
                }
            }, [currentView, interestDepth, selectedTags]);

            // „Éá„Éº„ÇøË™≠„ÅøËæº„Åø‰∏≠„ÅÆË°®Á§∫
            if (!dataLoaded) {
                return (
                    <div className="min-h-screen bg-gray-50 flex items-center justify-center">
                        <div className="text-center">
                            <div className="w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
                            <p className="text-gray-600">„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Çì„Åß„ÅÑ„Åæ„Åô...</p>
                        </div>
                    </div>
                );
            }

            // ÁèæÂú®„ÅÆ„Éì„É•„Éº„Å´Âøú„Åò„Å¶„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà„ÇíË°®Á§∫
            if (currentView === 'favorites') {
                return (
                    <div className="min-h-screen bg-gray-50">
                        <ParticleSystem />

                        {/* Ë®ò‰∫ãË©≥Á¥∞„É¢„Éº„ÉÄ„É´ */}
                        {showArticleDetail && selectedArticle && (
                            <div className="fixed inset-0 bg-black/50 backdrop-blur-sm z-[60] flex items-center justify-center p-4">
                                <div className="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden shadow-2xl">
                                    {/* Âõ∫ÂÆö„Éò„ÉÉ„ÉÄ„ÉºÔºàÈñâ„Åò„Çã„Éú„Çø„É≥„ÅÆ„ÅøÔºâ */}
                                    <div className="absolute top-0 left-0 right-0 z-10 p-4 flex justify-end">
                                        <button
                                            onClick={() => {
                                                setShowArticleDetail(false);
                                                // Ââç„ÅÆÁîªÈù¢„Å´Êàª„Çã
                                                if (previousView === 'favorites') {
                                                    setShowFavorites(true);
                                                } else if (previousView === 'favoritesList') {
                                                    // „ÅäÊ∞ó„Å´ÂÖ•„Çä„É™„Çπ„ÉàÁîªÈù¢„Å´„ÅØ„Åù„ÅÆ„Åæ„ÅæÊÆã„Çã
                                                } else {
                                                    setCurrentView('map');
                                                }
                                            }}
                                            className="w-10 h-10 bg-black/20 hover:bg-black/40 rounded-full flex items-center justify-center text-white transition-all"
                                        >
                                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M15 5L5 15M5 5l10 10" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
                                            </svg>
                                        </button>
                                    </div>

                                    {/* „Çπ„ÇØ„É≠„Éº„É´ÂèØËÉΩ„Å™„Ç≥„É≥„ÉÜ„É≥„ÉÑ */}
                                    <div className="overflow-y-auto max-h-[90vh]">
                                        {/* Ë®ò‰∫ãÁîªÂÉè */}
                                        <div className="relative">
                                            <div className="h-48 bg-gradient-to-br from-blue-500 to-purple-600 relative overflow-hidden">
                                                <img
                                                    src="https://s.yimg.jp/images/ksk/tool/img/photo01.png"
                                                    alt={selectedArticle.title}
                                                    className="w-full h-full object-cover opacity-80"
                                                />
                                                <div className="absolute inset-0 bg-gradient-to-t from-black/40 to-transparent"></div>

                                                {/* Ë©±È°åÂ∫¶„Éê„ÉÉ„Ç∏ */}
                                                <div className={`absolute top-4 left-4 px-3 py-1 rounded-full text-white text-sm font-medium ${
                                                    (selectedArticle.topicalityScore || 50) >= 80 ? 'bg-red-500' :
                                                    (selectedArticle.topicalityScore || 50) >= 60 ? 'bg-orange-500' :
                                                    (selectedArticle.topicalityScore || 50) >= 40 ? 'bg-yellow-500' : 'bg-gray-500'
                                                }`}>
                                                    Ë©±È°åÂ∫¶ {Math.round(selectedArticle.topicalityScore || 50)}
                                                </div>
                                            </div>
                                        </div>

                                        {/* „Ç≥„É≥„ÉÜ„É≥„ÉÑ */}
                                        <div className="p-6">
                                            {/* „Çø„Ç§„Éà„É´ */}
                                            <h1 className="text-2xl font-bold text-gray-900 mb-4 leading-tight">
                                                {selectedArticle.title}
                                            </h1>

                                            {/* „É°„ÇøÊÉÖÂ†± */}
                                            <div className="flex items-center gap-4 mb-6 text-sm text-gray-500">
                                                <span className="flex items-center gap-2">
                                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                        <path d="M8 0C3.6 0 0 3.6 0 8s3.6 8 8 8 8-3.6 8-8-3.6-8-8-8zm0 14c-3.3 0-6-2.7-6-6s2.7-6 6-6 6 2.7 6 6-2.7 6-6 6zm1-10H7v5l4 2.4.8-1.2-3.8-2.2V4z" fill="currentColor"/>
                                                    </svg>
                                                    {new Date().toLocaleDateString('ja-JP')}
                                                </span>
                                                <span className="flex items-center gap-2">
                                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                        <path d="M2 4.5C2 3.67157 2.67157 3 3.5 3H12.5C13.3284 3 14 3.67157 14 4.5V11.5C14 12.3284 13.3284 13 12.5 13H3.5C2.67157 13 2 12.3284 2 11.5V4.5ZM3.5 4C3.22386 4 3 4.22386 3 4.5V5.5L8 8.5L13 5.5V4.5C13 4.22386 12.7761 4 12.5 4H3.5ZM13 6.5L8 9.5L3 6.5V11.5C3 11.7761 3.22386 12 3.5 12H12.5C12.7761 12 13 11.7761 13 11.5V6.5Z" fill="currentColor"/>
                                                    </svg>
                                                    {selectedArticle.source}
                                                </span>
                                            </div>

                                            {/* Ë®ò‰∫ãÊú¨Êñá */}
                                            <div className="prose max-w-none mb-6">
                                                <p className="text-gray-700 leading-relaxed text-base mb-4">
                                                    {selectedArticle.snippet}
                                                </p>

                                                {/* Ë©≥Á¥∞ÂÜÖÂÆπÔºà„Çµ„É≥„Éó„É´Ôºâ */}
                                                <p className="text-gray-700 leading-relaxed text-base mb-4">
                                                    „Åì„ÅÆË®ò‰∫ã„Åß„ÅØ„ÄÅ{selectedArticle.title}„Å´„Å§„ÅÑ„Å¶Ë©≥„Åó„ÅèËß£Ë™¨„Åó„Åæ„Åô„ÄÇÊúÄÊñ∞„ÅÆÂãïÂêë„ÇÑÊäÄË°ìÁöÑ„Å™Ë©≥Á¥∞„ÄÅ‰ªäÂæå„ÅÆÂ±ïÊúõ„Å´„Å§„ÅÑ„Å¶„ÇÇËß¶„Çå„Å™„Åå„Çâ„ÄÅË™≠ËÄÖ„ÅÆÁöÜÊßò„Å´„Å®„Å£„Å¶ÊúâÁõä„Å™ÊÉÖÂ†±„Çí„ÅäÂ±ä„Åë„Åó„Åæ„Åô„ÄÇ
                                                </p>

                                                <p className="text-gray-700 leading-relaxed text-base mb-4">
                                                    {(selectedArticle.tags || []).includes('AI') && 'AIÊäÄË°ì„ÅÆÈÄ≤Ê≠©„Å´„Çà„Çä„ÄÅÁßÅ„Åü„Å°„ÅÆÁîüÊ¥ª„ÅØÂ§ß„Åç„ÅèÂ§âÂåñ„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ'}
                                                    {(selectedArticle.tags || []).includes('ÊäÄË°ì') && '„Åì„ÅÆÊäÄË°ìÈù©Êñ∞„ÅØ„ÄÅÁî£Ê•≠ÁïåÂÖ®‰Ωì„Å´ÂΩ±Èüø„Çí‰∏é„Åà„Å¶„ÅÑ„Åæ„Åô„ÄÇ'}
                                                    {(selectedArticle.tags || []).includes('„Éì„Ç∏„Éç„Çπ') && '„Éì„Ç∏„Éç„Çπ„ÅÆ‰∏ñÁïå„Åß„ÅØ„ÄÅÊñ∞„Åó„ÅÑ„Éì„Ç∏„Éç„Çπ„É¢„Éá„É´„ÅåÊ¨°„ÄÖ„Å®Áîü„Åæ„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ'}
                                                    {(selectedArticle.tags || []).includes('ÊñôÁêÜ') && 'È£üÊñáÂåñ„ÅÆÂ§öÊßòÊÄß„Å®‰ºùÁµ±„ÅÆÁ∂ôÊâø„Å´„Å§„ÅÑ„Å¶ËÄÉ„Åà„ÇãÊ©ü‰ºö„Å®„Å™„Çä„Åæ„Åô„ÄÇ'}
                                                    ‰ªäÂæå„ÅÆÂãïÂêë„Å´„ÇÇÊ≥®ÁõÆ„Åó„Å¶„ÅÑ„ÅèÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ
                                                </p>
                                            </div>

                                            {/* „Çø„Ç∞ */}
                                            <div className="mb-6">
                                                <h3 className="text-sm font-semibold text-gray-600 mb-3">Èñ¢ÈÄ£„Çø„Ç∞</h3>
                                                <div className="flex flex-wrap gap-2">
                                                    {(selectedArticle.tags || []).map((tag, index) => (
                                                        <span
                                                            key={index}
                                                            className="px-3 py-1.5 bg-blue-100 text-blue-700 text-sm rounded-full font-medium hover:bg-blue-200 transition-colors cursor-pointer"
                                                            onClick={() => {
                                                                handleTagClick(tag);
                                                                setShowArticleDetail(false);
                                                                setCurrentView('map');
                                                            }}
                                                        >
                                                            #{tag}
                                                        </span>
                                                    ))}
                                                </div>
                                            </div>

                                            {/* „Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥ */}
                                            <div className="flex justify-center pt-4 border-t">
                                                <button
                                                    onClick={() => setShowArticleDetail(false)}
                                                    className="px-6 py-3 border border-gray-300 hover:border-gray-400 text-gray-700 rounded-lg font-medium transition-colors"
                                                >
                                                    Èñâ„Åò„Çã
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* „Éò„ÉÉ„ÉÄ„Éº */}
                        <header className="bg-white shadow-sm border-b relative">
                            <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                                <div className="flex items-center justify-center h-16 relative">
                                    <h1 className="text-lg font-medium text-gray-900">„ÅäÊ∞ó„Å´ÂÖ•„ÇäÈõÜÁ¥Ñ</h1>
                                    <button
                                        onClick={() => setShowAiHelp(!showAiHelp)}
                                        className="absolute right-0 w-8 h-8 bg-gray-100 hover:bg-gray-200 rounded-full flex items-center justify-center text-sm font-bold text-gray-600 transition-colors"
                                        title="AIË¶ÅÁ¥Ñ„Å´„Å§„ÅÑ„Å¶"
                                    >
                                        i
                                    </button>
                                </div>

                                {/* AI„Éò„É´„Éó„Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó */}
                                {showAiHelp && (
                                    <div className="absolute top-full right-4 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg p-4 w-80 z-30">
                                        <div className="flex justify-between items-start mb-3">
                                            <h4 className="font-semibold text-gray-900">AIË¶ÅÁ¥ÑÊ©üËÉΩ„Å´„Å§„ÅÑ„Å¶</h4>
                                            <button
                                                onClick={() => setShowAiHelp(false)}
                                                className="text-gray-400 hover:text-gray-600 ml-2"
                                            >
                                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                    <path d="M12 4L4 12M4 4l8 8" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"/>
                                                </svg>
                                            </button>
                                        </div>
                                        <div className="text-sm text-gray-600 space-y-2">
                                            <p>ÂêÑ„É¨„Éù„Éº„Éà„Å´„ÅØË¶ÅÁ¥ÑÊ©üËÉΩ„Åå„ÅÇ„Çä„Åæ„ÅôÔºö</p>
                                            <ul className="list-disc pl-4 space-y-1">
                                                <li>„É¨„Éù„Éº„Éà„ÇíÈñã„Åè„Å®„ÄÅÈñ¢ÈÄ£Ë®ò‰∫ã„ÅÆË¶ÅÁ¥Ñ„ÅåËá™ÂãïÁîüÊàê„Åï„Çå„Åæ„Åô</li>
                                                <li>Ë§áÊï∞„ÅÆË®ò‰∫ã„Åã„Çâ‰∏ªË¶Å„Å™„Éù„Ç§„É≥„Éà„ÇíÊäΩÂá∫„Åó„Åæ„Åô</li>
                                                <li>ÂäπÁéáÁöÑ„Å´ÊÉÖÂ†±„ÇíÊääÊè°„Åß„Åç„Åæ„Åô</li>
                                            </ul>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </header>

                        {/* „Ç≥„É≥„ÉÜ„É≥„ÉÑ */}
                        <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                            {/* ÈõÜÁ¥Ñ„É¨„Éù„Éº„Éà „Çª„ÇØ„Ç∑„Éß„É≥ */}
                            <div className="mb-8">
                                <h2 className="text-xl font-bold text-gray-900 mb-6">„É¨„Éù„Éº„Éà</h2>
                                {favoriteReports.length === 0 ? (
                                <div className="text-center py-12">
                                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1" className="mx-auto mb-4 text-gray-300">
                                        <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/>
                                    </svg>
                                    <h3 className="text-lg font-medium text-gray-900 mb-2">„ÅäÊ∞ó„Å´ÂÖ•„Çä„É¨„Éù„Éº„Éà„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</h3>
                                    <p className="text-gray-500">„É¨„Éù„Éº„Éà„ÅÆ„Éî„É≥„Ç¢„Ç§„Ç≥„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶ËøΩÂä†„Åß„Åç„Åæ„Åô</p>
                                </div>
                            ) : (
                                    <div className="space-y-3">
                                    {favoriteReports.map((report, index) => (
                                        <div
                                            key={report.id || index}
                                            className="bg-white rounded-xl border border-gray-200 p-4 hover:shadow-md hover:border-blue-200 transition-all cursor-pointer"
                                            onClick={() => {
                                                // „É¨„Éù„Éº„Éà„ÇíÂÜçÁèæ„Åó„Å¶„É°„Ç§„É≥„Éö„Éº„Ç∏„Å´Êàª„Çã
                                                setSelectedTags(report.tags || []);
                                                setPreviousView('favoritesList'); // „ÅäÊ∞ó„Å´ÂÖ•„Çä„É™„Çπ„Éà„Åã„ÇâÊù•„Åü„Åì„Å®„ÇíË®òÈå≤
                                                setShowFavorites(true);
                                                setCurrentView('map');
                                            }}
                                        >
                                                <div className="flex items-center justify-between">
                                                    <div className="flex items-center flex-1">
                                                        <span className="text-lg font-medium text-gray-900">
                                                            {(report.tags || []).join(' √ó ') || 'ÁÑ°È°å„ÅÆ„É¨„Éù„Éº„Éà'}
                                                        </span>
                                                    </div>
                                                    <div className="flex items-center space-x-3 ml-4">
                                                        {/* ÊôÇË®à„Ç¢„Ç§„Ç≥„É≥ */}
                                                        <button
                                                            className="p-2 text-gray-400 hover:text-gray-600 transition-colors"
                                                            title="ÊúÄÁµÇÊõ¥Êñ∞Êó•ÊôÇ"
                                                        >
                                                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                                                                <circle cx="12" cy="12" r="10"/>
                                                                <polyline points="12,6 12,12 16,14"/>
                                                            </svg>
                                                        </button>
                                                        {/* „Ç¥„ÉüÁÆ±„Ç¢„Ç§„Ç≥„É≥ */}
                                                        <button
                                                            onClick={(e) => {
                                                                e.stopPropagation();
                                                                removeFromFavorites(report.id, e);
                                                            }}
                                                            className="p-2 text-gray-400 hover:text-red-500 transition-colors"
                                                            title="ÂâäÈô§"
                                                        >
                                                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                                                                <path d="M3 6h18M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6m3 0V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
                                                            </svg>
                                                        </button>
                                                    </div>
                                                </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                            </div>

                            {/* Ë®ò‰∫ã„Çª„ÇØ„Ç∑„Éß„É≥ */}
                            <div>
                                <div className="flex items-center justify-between mb-4">
                                    <h2 className="text-lg font-medium text-gray-900">Ë®ò‰∫ã</h2>
                                    <div className="flex bg-gray-100 rounded-lg p-1 shadow-sm">
                                        <button
                                            onClick={() => setFavoritesViewMode('grid')}
                                            className={`p-1.5 rounded transition-all ${
                                                favoritesViewMode === 'grid'
                                                ? 'bg-white text-gray-900 shadow-sm'
                                                : 'text-gray-500 hover:text-gray-700'
                                            }`}
                                        >
                                            <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <rect x="1" y="1" width="5" height="5" rx="1" fill="currentColor"/>
                                                <rect x="8" y="1" width="5" height="5" rx="1" fill="currentColor"/>
                                                <rect x="1" y="8" width="5" height="5" rx="1" fill="currentColor"/>
                                                <rect x="8" y="8" width="5" height="5" rx="1" fill="currentColor"/>
                                            </svg>
                                        </button>
                                        <button
                                            onClick={() => setFavoritesViewMode('list')}
                                            className={`p-1.5 rounded transition-all ${
                                                favoritesViewMode === 'list'
                                                ? 'bg-white text-gray-900 shadow-sm'
                                                : 'text-gray-500 hover:text-gray-700'
                                            }`}
                                        >
                                            <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <rect x="1" y="2" width="12" height="1.5" rx="0.75" fill="currentColor"/>
                                                <rect x="1" y="6" width="12" height="1.5" rx="0.75" fill="currentColor"/>
                                                <rect x="1" y="10" width="12" height="1.5" rx="0.75" fill="currentColor"/>
                                            </svg>
                                        </button>
                                    </div>
                                </div>

                                {/* Ë®ò‰∫ãË°®Á§∫ */}
                                {(() => {
                                    const favoriteArticles = favoriteReports.filter(report => report.type === 'article');
                                    console.log('„ÅäÊ∞ó„Å´ÂÖ•„ÇäË®ò‰∫ã‰∏ÄË¶ß:', favoriteArticles);

                                    if (favoritesViewMode === 'grid') {
                                        return (
                                            <div className="grid grid-cols-3 gap-2">
                                                {favoriteArticles.length === 0 ? (
                                                    <div className="col-span-3 text-center py-8 text-gray-500">
                                                        „ÅäÊ∞ó„Å´ÂÖ•„ÇäË®ò‰∫ã„Åå„ÅÇ„Çä„Åæ„Åõ„Çì
                                                    </div>
                                                ) : (
                                                    favoriteArticles.map((report, index) => (
                                                        <div
                                                            key={report.id || index}
                                                            className="aspect-square bg-white border border-gray-200 rounded cursor-pointer hover:shadow-md transition-shadow overflow-hidden"
                                                            onClick={(e) => {
                                                                console.log('„ÅäÊ∞ó„Å´ÂÖ•„ÇäË®ò‰∫ã„ÇØ„É™„ÉÉ„ÇØ:', report);
                                                                const article = report.articleData || {
                                                                    title: report.title?.replace('Ë®ò‰∫ã: ', '') || 'ÁÑ°È°å„ÅÆË®ò‰∫ã',
                                                                    tags: report.tags || [],
                                                                    snippet: 'Ë®ò‰∫ã„ÅÆË©≥Á¥∞',
                                                                    source: '„ÅäÊ∞ó„Å´ÂÖ•„Çä'
                                                                };
                                                                console.log('Ë®ò‰∫ã„Éá„Éº„Çø:', article);
                                                                try {
                                                                    handleArticleRead(article, e);
                                                                } catch (error) {
                                                                    console.error('Ë®ò‰∫ãË©≥Á¥∞Ë°®Á§∫„Ç®„É©„Éº:', error);
                                                                }
                                                            }}
                                                        >
                                                            <div className="h-full flex flex-col p-2">
                                                                <div className="flex-1 flex items-center justify-center bg-gray-100 rounded mb-2">
                                                                    <img
                                                                        src="https://s.yimg.jp/images/ksk/tool/img/photo01.png"
                                                                        alt={report.articleData?.title || 'Article'}
                                                                        className="w-full h-full object-cover rounded"
                                                                    />
                                                                </div>
                                                                <div className="text-xs text-gray-900 font-medium line-clamp-2">
                                                                    {report.articleData?.title || report.title?.replace('Ë®ò‰∫ã: ', '')}
                                                                </div>
                                                            </div>
                                                        </div>
                                                    ))
                                                )}
                                            </div>
                                        );
                                    } else {
                                        // „É™„Çπ„Éà„Éì„É•„Éº
                                        return (
                                            <div className="space-y-3">
                                                {favoriteArticles.length === 0 ? (
                                                    <div className="text-center py-8 text-gray-500">
                                                        „ÅäÊ∞ó„Å´ÂÖ•„ÇäË®ò‰∫ã„Åå„ÅÇ„Çä„Åæ„Åõ„Çì
                                                    </div>
                                                ) : (
                                                    favoriteArticles.map((report, index) => (
                                                        <div
                                                            key={report.id || index}
                                                            className="bg-white rounded-lg p-3 shadow-sm border hover:shadow-md transition-all cursor-pointer"
                                                            onClick={(e) => {
                                                                console.log('„ÅäÊ∞ó„Å´ÂÖ•„ÇäË®ò‰∫ã„ÇØ„É™„ÉÉ„ÇØ:', report);
                                                                const article = report.articleData || {
                                                                    title: report.title?.replace('Ë®ò‰∫ã: ', '') || 'ÁÑ°È°å„ÅÆË®ò‰∫ã',
                                                                    tags: report.tags || [],
                                                                    snippet: 'Ë®ò‰∫ã„ÅÆË©≥Á¥∞',
                                                                    source: '„ÅäÊ∞ó„Å´ÂÖ•„Çä'
                                                                };
                                                                console.log('Ë®ò‰∫ã„Éá„Éº„Çø:', article);
                                                                try {
                                                                    handleArticleRead(article, e);
                                                                } catch (error) {
                                                                    console.error('Ë®ò‰∫ãË©≥Á¥∞Ë°®Á§∫„Ç®„É©„Éº:', error);
                                                                }
                                                            }}
                                                        >
                                                            <div className="flex gap-3">
                                                                <div className="w-16 h-16 bg-gray-100 rounded overflow-hidden flex-shrink-0">
                                                                    <img
                                                                        src="https://s.yimg.jp/images/ksk/tool/img/photo01.png"
                                                                        alt={report.articleData?.title || 'Article'}
                                                                        className="w-full h-full object-cover"
                                                                    />
                                                                </div>
                                                                <div className="flex-1 min-w-0">
                                                                    <h4 className="font-medium text-gray-900 line-clamp-2 mb-1">
                                                                        {report.articleData?.title || report.title?.replace('Ë®ò‰∫ã: ', '')}
                                                                    </h4>
                                                                    <p className="text-sm text-gray-600 line-clamp-2 mb-2">
                                                                        {report.articleData?.snippet || 'Ë®ò‰∫ã„ÅÆË©≥Á¥∞'}
                                                                    </p>
                                                                    <div className="flex items-center justify-between text-xs text-gray-400">
                                                                        <span>{report.articleData?.source || '„ÇΩ„Éº„Çπ‰∏çÊòé'}</span>
                                                                        <span>„ÅäÊ∞ó„Å´ÂÖ•„Çä</span>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    ))
                                                )}
                                            </div>
                                        );
                                    }
                                })()}
                            </div>
                        </main>

                        {/* ‰∏ãÈÉ®„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥ */}
                        <nav className="fixed bottom-0 left-0 right-0 bg-white/20 backdrop-blur-sm border-t border-gray-200/30 shadow-lg z-50">
                            <div className="flex items-center justify-between px-4 py-2">
                                {/* Â∑¶ÂØÑ„Åõ: „Éõ„Éº„É†„Éú„Çø„É≥ */}
                                <button
                                    onClick={() => setCurrentView('map')}
                                    className="w-10 h-10 rounded-full flex items-center justify-center transition-all bg-gray-100 text-gray-600 hover:bg-gray-200"
                                >
                                    <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path fillRule="evenodd" clipRule="evenodd" d="M17.3892 7.44191L10.4827 0.60791C9.66124 -0.20459 8.33874 -0.20459 7.51724 0.60791L0.614244 7.43891C0.221244 7.82741 0.000244141 8.35791 0.000244141 8.91091V16.9999C0.000244141 17.5524 0.447744 17.9999 1.00024 17.9999H7.00024V12.2499C7.00024 12.1119 7.11174 11.9999 7.25024 11.9999H10.7502C10.8882 11.9999 11.0002 12.1119 11.0002 12.2499V17.9999H17.0002C17.5522 17.9999 18.0002 17.5524 18.0002 16.9999V8.90591C18.0002 8.35591 17.7797 7.82891 17.3892 7.44191" fill="black" fillOpacity="0.73"/>
                                    </svg>
                                </button>

                                {/* Âè≥ÂØÑ„Åõ: „Ç´„É°„É©„ÉªÈü≥Â£∞„Éª„Éû„ÉÉ„Éó„Éú„Çø„É≥„Ç≥„É≥„ÉÜ„Éä */}
                                <div className="flex items-center bg-gray-100 rounded-full px-1">
                                    {/* „Ç´„É°„É©„Éú„Çø„É≥ */}
                                    <button
                                        onClick={() => setShowCameraMenu(!showCameraMenu)}
                                        className="w-10 h-10 rounded-full bg-white flex items-center justify-center text-gray-700 hover:bg-gray-50 transition-all mx-0.5"
                                    >
                                        <svg width="18" height="16" viewBox="0 0 18 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path fillRule="evenodd" clipRule="evenodd" d="M15.5 6C14.948 6 14.5 5.5525 14.5 4.999C14.5 4.4475 14.948 4 15.5 4C16.052 4 16.5 4.4475 16.5 4.999C16.5 5.5525 16.052 6 15.5 6M9 13.5C6.515 13.5 4.5 11.483 4.5 9C4.5 6.5165 6.515 4.5 9 4.5C11.483 4.5 13.5 6.5165 13.5 9C13.5 11.483 11.483 13.5 9 13.5M16 2H13.5L11.793 0.293C11.6055 0.1055 11.351 0 11.0855 0H6.9145C6.649 0 6.3945 0.1055 6.207 0.293L4.5 2H2C0.9 2 0 2.9 0 4V14C0 15.1 0.9 16 2 16H16C17.1 16 18 15.1 18 14V4C18 2.9 17.1 2 16 2M9 6.30005C7.511 6.30005 6.3 7.51105 6.3 9.00005C6.3 10.4886 7.511 11.7001 9 11.7001C10.489 11.7001 11.7 10.4886 11.7 9.00005C11.7 7.51105 10.489 6.30005 9 6.30005" fill="black" fillOpacity="0.73"/>
                                        </svg>
                                    </button>

                                    {/* Èü≥Â£∞„Éú„Çø„É≥ */}
                                    <button
                                        onClick={() => setShowVoiceMenu(!showVoiceMenu)}
                                        className="w-10 h-10 rounded-full bg-white flex items-center justify-center text-gray-700 hover:bg-gray-50 transition-all mx-0.5"
                                    >
                                        <svg width="12" height="20" viewBox="0 0 12 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M1.5 9.5V10.5C1.5 12.9815 3.519 15 6 15C8.481 15 10.5 12.9815 10.5 10.5V9.5H12V10.5C12 13.4675 9.83297 15.9312 7 16.4092V18H8.75C9.1645 18 9.5 18.3355 9.5 18.75C9.5 19.1645 9.1645 19.5 8.75 19.5H3.25C2.8355 19.5 2.5 19.1645 2.5 18.75C2.5 18.3355 2.8355 18 3.25 18H5V16.4092C2.16703 15.9312 0 13.4675 0 10.5V9.5H1.5ZM6 0.5C7.6565 0.5 9 1.8435 9 3.5V10.5C9 12.1565 7.6565 13.5 6 13.5C4.3435 13.5 3 12.1565 3 10.5V3.5C3 1.8435 4.3435 0.5 6 0.5Z" fill="black" fillOpacity="0.73"/>
                                        </svg>
                                    </button>

                                    {/* „ÅäÊ∞ó„Å´ÂÖ•„Çä„É™„Çπ„Éà„Éú„Çø„É≥Ôºà„Ç¢„ÇØ„ÉÜ„Ç£„ÉñÁä∂ÊÖãÔºâ */}
                                    <button
                                        onClick={() => {
                                            try {
                                                console.log('„ÅäÊ∞ó„Å´ÂÖ•„Çä„Éö„Éº„Ç∏„Åß„Éú„Çø„É≥„ÇØ„É™„ÉÉ„ÇØ„ÄÅ„É°„Ç§„É≥„Éö„Éº„Ç∏„Å´Êàª„Çã');
                                                setCurrentView('map');
                                            } catch (error) {
                                                console.error('„É°„Ç§„É≥„Éö„Éº„Ç∏Êàª„Çä„Ç®„É©„Éº:', error);
                                            }
                                        }}
                                        className="w-10 h-10 rounded-full bg-blue-500 hover:bg-blue-600 flex items-center justify-center text-white transition-all mx-0.5 relative"
                                        title="„ÅäÊ∞ó„Å´ÂÖ•„Çä„É™„Çπ„ÉàÔºà„É°„Ç§„É≥„Éö„Éº„Ç∏„Å´Êàª„ÇãÔºâ"
                                    >
                                        <svg width="16" height="20" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                            <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/>
                                        </svg>
                                        {favoriteReports.length > 0 && (
                                            <div className="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">
                                                {favoriteReports.length}
                                            </div>
                                        )}
                                    </button>
                                </div>
                            </div>
                        </nav>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gray-50">
                    <ParticleSystem />
                    
                    {/* Ë®ò‰∫ãË©≥Á¥∞„É¢„Éº„ÉÄ„É´ */}
                    {console.log('„É¢„Éº„ÉÄ„É´Ë°®Á§∫„ÉÅ„Çß„ÉÉ„ÇØ:', { showArticleDetail, selectedArticle: !!selectedArticle, currentView })}
                    {showArticleDetail && selectedArticle && (
                        <div className="fixed inset-0 bg-black/50 backdrop-blur-sm z-[60] flex items-center justify-center p-4">
                            <div className="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden shadow-2xl">
                                {/* Âõ∫ÂÆö„Éò„ÉÉ„ÉÄ„ÉºÔºàÈñâ„Åò„Çã„Éú„Çø„É≥„ÅÆ„ÅøÔºâ */}
                                <div className="absolute top-0 left-0 right-0 z-10 p-4 flex justify-end">
                                    <button
                                        onClick={() => {
                                            setShowArticleDetail(false);
                                            // Ââç„ÅÆÁîªÈù¢„Å´Êàª„Çã
                                            if (previousView === 'favorites') {
                                                setShowFavorites(true);
                                            } else if (previousView === 'favoritesList') {
                                                setCurrentView('favorites');
                                            }
                                            // „É°„Ç§„É≥ÁîªÈù¢„ÅÆÂ†¥Âêà„ÅØ‰Ωï„ÇÇ„Åó„Å™„ÅÑÔºàÊó¢„Å´Ë°®Á§∫„Åï„Çå„Å¶„ÅÑ„ÇãÔºâ
                                            setPreviousView(null); // „É™„Çª„ÉÉ„Éà
                                        }}
                                        className="w-10 h-10 bg-black/20 hover:bg-black/40 rounded-full flex items-center justify-center text-white transition-all"
                                    >
                                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M15 5L5 15M5 5l10 10" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
                                        </svg>
                                    </button>
                                </div>

                                {/* „Çπ„ÇØ„É≠„Éº„É´ÂèØËÉΩ„Å™„Ç≥„É≥„ÉÜ„É≥„ÉÑ */}
                                <div className="overflow-y-auto max-h-[90vh]">
                                    {/* Ë®ò‰∫ãÁîªÂÉè */}
                                    <div className="relative">
                                        <div className="h-48 bg-gradient-to-br from-blue-500 to-purple-600 relative overflow-hidden">
                                            <img 
                                                src="https://s.yimg.jp/images/ksk/tool/img/photo01.png" 
                                                alt={selectedArticle.title}
                                                className="w-full h-full object-cover opacity-80"
                                            />
                                            <div className="absolute inset-0 bg-gradient-to-t from-black/40 to-transparent"></div>
                                            
                                            {/* Ë©±È°åÂ∫¶„Éê„ÉÉ„Ç∏ */}
                                            <div className={`absolute top-4 left-4 px-3 py-1 rounded-full text-white text-sm font-medium ${
                                                selectedArticle.topicalityScore >= 80 ? 'bg-red-500' : 
                                                selectedArticle.topicalityScore >= 60 ? 'bg-orange-500' : 
                                                selectedArticle.topicalityScore >= 40 ? 'bg-yellow-500' : 'bg-gray-500'
                                            }`}>
                                                Ë©±È°åÂ∫¶ {Math.round(selectedArticle.topicalityScore)}
                                            </div>
                                        </div>
                                    </div>

                                    {/* „Ç≥„É≥„ÉÜ„É≥„ÉÑ */}
                                    <div className="p-6">
                                    {/* „Çø„Ç§„Éà„É´ */}
                                    <h1 className="text-2xl font-bold text-gray-900 mb-4 leading-tight">
                                        {selectedArticle.title}
                                    </h1>
                                    
                                    {/* „É°„ÇøÊÉÖÂ†± */}
                                    <div className="flex items-center gap-4 mb-6 text-sm text-gray-500">
                                        <span className="flex items-center gap-2">
                                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M8 0C3.6 0 0 3.6 0 8s3.6 8 8 8 8-3.6 8-8-3.6-8-8-8zm0 14c-3.3 0-6-2.7-6-6s2.7-6 6-6 6 2.7 6 6-2.7 6-6 6zm1-10H7v5l4 2.4.8-1.2-3.8-2.2V4z" fill="currentColor"/>
                                            </svg>
                                            {new Date().toLocaleDateString('ja-JP')}
                                        </span>
                                        <span className="flex items-center gap-2">
                                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M2 4.5C2 3.67157 2.67157 3 3.5 3H12.5C13.3284 3 14 3.67157 14 4.5V11.5C14 12.3284 13.3284 13 12.5 13H3.5C2.67157 13 2 12.3284 2 11.5V4.5ZM3.5 4C3.22386 4 3 4.22386 3 4.5V5.5L8 8.5L13 5.5V4.5C13 4.22386 12.7761 4 12.5 4H3.5ZM13 6.5L8 9.5L3 6.5V11.5C3 11.7761 3.22386 12 3.5 12H12.5C12.7761 12 13 11.7761 13 11.5V6.5Z" fill="currentColor"/>
                                            </svg>
                                            {selectedArticle.source}
                                        </span>
                                    </div>
                                    
                                    {/* Ë®ò‰∫ãÊú¨Êñá */}
                                    <div className="prose max-w-none mb-6">
                                        <p className="text-gray-700 leading-relaxed text-base mb-4">
                                            {selectedArticle.snippet}
                                        </p>
                                        
                                        {/* Ë©≥Á¥∞ÂÜÖÂÆπÔºà„Çµ„É≥„Éó„É´Ôºâ */}
                                        <p className="text-gray-700 leading-relaxed text-base mb-4">
                                            „Åì„ÅÆË®ò‰∫ã„Åß„ÅØ„ÄÅ{selectedArticle.title}„Å´„Å§„ÅÑ„Å¶Ë©≥„Åó„ÅèËß£Ë™¨„Åó„Åæ„Åô„ÄÇÊúÄÊñ∞„ÅÆÂãïÂêë„ÇÑÊäÄË°ìÁöÑ„Å™Ë©≥Á¥∞„ÄÅ‰ªäÂæå„ÅÆÂ±ïÊúõ„Å´„Å§„ÅÑ„Å¶„ÇÇËß¶„Çå„Å™„Åå„Çâ„ÄÅË™≠ËÄÖ„ÅÆÁöÜÊßò„Å´„Å®„Å£„Å¶ÊúâÁõä„Å™ÊÉÖÂ†±„Çí„ÅäÂ±ä„Åë„Åó„Åæ„Åô„ÄÇ
                                        </p>
                                        
                                        <p className="text-gray-700 leading-relaxed text-base mb-4">
                                            {selectedArticle.tags.includes('AI') && 'AIÊäÄË°ì„ÅÆÈÄ≤Ê≠©„Å´„Çà„Çä„ÄÅÁßÅ„Åü„Å°„ÅÆÁîüÊ¥ª„ÅØÂ§ß„Åç„ÅèÂ§âÂåñ„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ'}
                                            {selectedArticle.tags.includes('ÊäÄË°ì') && '„Åì„ÅÆÊäÄË°ìÈù©Êñ∞„ÅØ„ÄÅÁî£Ê•≠ÁïåÂÖ®‰Ωì„Å´ÂΩ±Èüø„Çí‰∏é„Åà„Å¶„ÅÑ„Åæ„Åô„ÄÇ'}
                                            {selectedArticle.tags.includes('„Éì„Ç∏„Éç„Çπ') && '„Éì„Ç∏„Éç„Çπ„ÅÆ‰∏ñÁïå„Åß„ÅØ„ÄÅÊñ∞„Åó„ÅÑ„Éì„Ç∏„Éç„Çπ„É¢„Éá„É´„ÅåÊ¨°„ÄÖ„Å®Áîü„Åæ„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ'}
                                            {selectedArticle.tags.includes('ÊñôÁêÜ') && 'È£üÊñáÂåñ„ÅÆÂ§öÊßòÊÄß„Å®‰ºùÁµ±„ÅÆÁ∂ôÊâø„Å´„Å§„ÅÑ„Å¶ËÄÉ„Åà„ÇãÊ©ü‰ºö„Å®„Å™„Çä„Åæ„Åô„ÄÇ'}
                                            ‰ªäÂæå„ÅÆÂãïÂêë„Å´„ÇÇÊ≥®ÁõÆ„Åó„Å¶„ÅÑ„ÅèÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ
                                        </p>
                                    </div>
                                    
                                    {/* „Çø„Ç∞ */}
                                    <div className="mb-6">
                                        <h3 className="text-sm font-semibold text-gray-600 mb-3">Èñ¢ÈÄ£„Çø„Ç∞</h3>
                                        <div className="flex flex-wrap gap-2">
                                            {selectedArticle.tags.map(tag => (
                                                <span
                                                    key={tag}
                                                    className="px-3 py-1.5 bg-blue-100 text-blue-700 text-sm rounded-full font-medium hover:bg-blue-200 transition-colors cursor-pointer"
                                                    onClick={() => {
                                                        handleTagClick(tag);
                                                        setShowArticleDetail(false);
                                                        setCurrentView('map');
                                                    }}
                                                >
                                                    #{tag}
                                                </span>
                                            ))}
                                        </div>
                                    </div>
                                    
                                    {/* „Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥ */}
                                    <div className="flex justify-center pt-4 border-t">
                                        <button
                                            onClick={() => setShowArticleDetail(false)}
                                            className="px-6 py-3 border border-gray-300 hover:border-gray-400 text-gray-700 rounded-lg font-medium transition-colors"
                                        >
                                            Èñâ„Åò„Çã
                                        </button>
                                    </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* „ÅäÊ∞ó„Å´ÂÖ•„ÇäÈõÜÁ¥Ñ„Éö„Éº„Ç∏ */}
                    {showFavorites && (
                        <div className="fixed inset-0 bg-white z-50 overflow-y-auto">
                            {/* „Éò„ÉÉ„ÉÄ„Éº */}
                            <div className="bg-white border-b border-gray-200 sticky top-0 z-10 relative">
                                <div className="flex items-center justify-between p-4">
                                    {/* Â∑¶ÂÅ¥ÔºöÈñâ„Åò„Çã„Éú„Çø„É≥ */}
                                    <button
                                        onClick={() => {
                                            console.log('ÈõÜÁ¥Ñ„É¨„Éù„Éº„ÉàÈñâ„Åò„Çã„Éú„Çø„É≥„ÄÅpreviousView:', previousView);
                                            setShowFavorites(false);
                                            // Ââç„ÅÆÁîªÈù¢„Å´Êàª„Çã
                                            if (previousView === 'favoritesList') {
                                                console.log('„ÅäÊ∞ó„Å´ÂÖ•„Çä„É™„Çπ„Éà„Å´Êàª„Çã');
                                                setCurrentView('favorites');
                                                setPreviousView(null);
                                            } else if (previousView === 'main') {
                                                console.log('„Éû„ÉÉ„Éó„Éì„É•„Éº„Å´Êàª„Çã');
                                                setCurrentView('map');
                                                setPreviousView(null);
                                            } else {
                                                console.log('„É°„Ç§„É≥ÁîªÈù¢„Å´Êàª„Çã');
                                            }
                                        }}
                                        className="w-10 h-10 rounded-full bg-gray-200 hover:bg-gray-300 flex items-center justify-center transition-colors"
                                    >
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                            <line x1="18" y1="6" x2="6" y2="18"></line>
                                            <line x1="6" y1="6" x2="18" y2="18"></line>
                                        </svg>
                                    </button>

                                    {/* ‰∏≠Â§ÆÔºöÈõÜÁ¥Ñ„É¨„Éù„Éº„Éà„É©„Éô„É´„Å®„Çø„Ç∞ */}
                                    <div className="flex-1 flex flex-col items-center">
                                        <div className="flex items-center gap-3">
                                            <div className="text-lg font-medium text-gray-900">
                                                {selectedTags.length > 0 ? selectedTags.join(' √ó ') : 'Êú™ÈÅ∏Êäû'}
                                            </div>
                                            {/* „ÅäÊ∞ó„Å´ÂÖ•„Çä„Éú„Çø„É≥ */}
                                            <button
                                                onClick={(e) => {
                                                    e.stopPropagation();
                                                    toggleFavorites({
                                                        title: `ÈõÜÁ¥Ñ„É¨„Éù„Éº„Éà: ${selectedTags.join(' √ó ')}`,
                                                        type: 'aggregated',
                                                        tags: selectedTags,
                                                        articleCount: getMapFilteredArticles().length
                                                    }, e);
                                                }}
                                                className={`w-8 h-8 rounded-full flex items-center justify-center transition-colors ${
                                                    isFavorite({
                                                        title: `ÈõÜÁ¥Ñ„É¨„Éù„Éº„Éà: ${selectedTags.join(' √ó ')}`,
                                                        type: 'aggregated',
                                                        tags: selectedTags
                                                    }) ? 'text-blue-600' : 'text-gray-400 hover:text-gray-600'
                                                }`}
                                                title={isFavorite({
                                                    title: `ÈõÜÁ¥Ñ„É¨„Éù„Éº„Éà: ${selectedTags.join(' √ó ')}`,
                                                    type: 'aggregated',
                                                    tags: selectedTags
                                                }) ? "„ÅäÊ∞ó„Å´ÂÖ•„Çä„Åã„ÇâÂâäÈô§" : "„ÅäÊ∞ó„Å´ÂÖ•„Çä„Å´ËøΩÂä†"}
                                            >
                                                <svg width="16" height="16" viewBox="0 0 24 24" fill={isFavorite({
                                                    title: `ÈõÜÁ¥Ñ„É¨„Éù„Éº„Éà: ${selectedTags.join(' √ó ')}`,
                                                    type: 'aggregated',
                                                    tags: selectedTags
                                                }) ? "currentColor" : "none"} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                                    <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/>
                                                </svg>
                                            </button>
                                        </div>
                                    </div>

                                    {/* Âè≥ÂÅ¥Ôºö„Çπ„Éö„Éº„Çπ */}
                                    <div className="w-10 h-10"></div>
                                </div>
                                
                                {/* AI„Éò„É´„Éó„Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó */}
                                {showAiHelp && (
                                    <div className="absolute top-full right-4 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg p-4 w-80 z-30">
                                        <div className="flex justify-between items-start mb-3">
                                            <h4 className="font-semibold text-gray-900">AIË¶ÅÁ¥ÑÊ©üËÉΩ„Å´„Å§„ÅÑ„Å¶</h4>
                                            <button
                                                onClick={() => setShowAiHelp(false)}
                                                className="text-gray-400 hover:text-gray-600"
                                            >
                                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                    <path d="M12 4L4 12M4 4l8 8" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"/>
                                                </svg>
                                            </button>
                                        </div>
                                        <p className="text-sm text-gray-600 leading-relaxed">
                                            ÈÅ∏Êäû„Åï„Çå„Åü„Çø„Ç∞„Å´Èñ¢ÈÄ£„Åô„ÇãË®ò‰∫ã„Åã„Çâ„ÄÅÊúÄÊñ∞„ÅÆ„Éà„É¨„É≥„Éâ„Å®ÈáçË¶Å„Å™„Éù„Ç§„É≥„Éà„ÇíÊäΩÂá∫„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ„Åì„Çå„Çâ„ÅÆÂàÜÈáé„Åß„ÅÆÊÉÖÂ†±„ÇÑÂãïÂêë„Å´„Å§„ÅÑ„Å¶„ÄÅÂåÖÊã¨ÁöÑ„Å™Ë¶ñÁÇπ„ÅßÂàÜÊûê„Åó„ÄÅË¶ÅÁ¥Ñ„ÇíÁîüÊàê„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ
                                        </p>
                                    </div>
                                )}
                            </div>

                            {/* „Ç≥„É≥„ÉÜ„É≥„ÉÑ */}
                            <div className="py-4">
                                {selectedTags.length > 0 ? (
                                    <>
                                        {/* ÈÅ∏Êäû„Çø„Ç∞„ÅÆË¶ÅÁ¥Ñ */}
                                        <div className="bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg mx-4 px-4 mb-4">
                                            <div className="mb-3">
                                                <div className="flex-1">
                                                </div>
                                            </div>
                                        </div>

                                        {/* „Ç´„ÉÜ„Ç¥„É™„Éº„Çø„Éñ */}
                                        <div className="mb-4">
                                            <div className="flex gap-2 overflow-x-auto pb-2 px-4">
                                                {(() => {
                                                    // ÈÅ∏Êäû„Çø„Ç∞„Å´Âøú„Åò„Åü„Ç´„ÉÜ„Ç¥„É™„Éº„É°„Éã„É•„Éº„ÇíÂãïÁöÑ„Å´ÁîüÊàê
                                                    if (selectedTags.includes('ÊóÖË°å') || selectedTags.includes('Ê≤ñÁ∏Ñ')) {
                                                        return ['„Éó„É©„É≥', '„Ç∞„É´„É°', 'Ë¶≥ÂÖâ', 'ÂÜôÁúü', '„Ç¢„ÇØ„ÉÜ„Ç£„Éì„ÉÜ„Ç£'];
                                                    } else if (selectedTags.includes('ÊñôÁêÜ') || selectedTags.includes('ÂíåÈ£ü')) {
                                                        return ['„É¨„Ç∑„Éî', '„É¨„Çπ„Éà„É©„É≥', 'È£üÊùê', 'Ë™øÁêÜÊ≥ï', 'Ê†ÑÈ§ä'];
                                                    } else if (selectedTags.includes('AI') || selectedTags.includes('ÊäÄË°ì')) {
                                                        return ['„Éà„É¨„É≥„Éâ', '„ÉÑ„Éº„É´', '‰∫ã‰æã', 'Â≠¶Áøí', 'Á†îÁ©∂'];
                                                    } else if (selectedTags.includes('„Éì„Ç∏„Éç„Çπ')) {
                                                        return ['Êà¶Áï•', '„Éû„Éº„Ç±„ÉÜ„Ç£„É≥„Ç∞', '‰∫ã‰æã', '„ÉÑ„Éº„É´', '„Éã„É•„Éº„Çπ'];
                                                    } else if (selectedTags.includes('ÂãïÁâ©') || selectedTags.includes('„Éö„ÉÉ„Éà')) {
                                                        return ['È£ºËÇ≤', 'ÂÅ•Â∫∑', 'Áî®ÂìÅ', '„Éà„É¨„Éº„Éã„É≥„Ç∞', 'Á®ÆÈ°û'];
                                                    } else if (selectedTags.includes('„Éï„Ç°„ÉÉ„Ç∑„Éß„É≥')) {
                                                        return ['„Éà„É¨„É≥„Éâ', '„Éñ„É©„É≥„Éâ', '„Ç≥„Éº„Éá', '„Ç¢„Ç§„ÉÜ„É†', '„Çª„Éº„É´'];
                                                    } else {
                                                        return ['„Åä„Åô„Åô„ÇÅ', '„Éà„É¨„É≥„Éâ', '„Éã„É•„Éº„Çπ', '„Ç¨„Ç§„Éâ', '„É¨„Éì„É•„Éº'];
                                                    }
                                                })().map((category, index) => (
                                                    <button
                                                        key={category}
                                                        className={`px-4 py-2 rounded-full whitespace-nowrap transition-all ${
                                                            index === 0 
                                                                ? 'bg-blue-600 text-white'
                                                                : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                                                        }`}
                                                    >
                                                        {category}
                                                    </button>
                                                ))}
                                            </div>
                                        </div>

                                        {/* Èñ¢ÈÄ£Ë®ò‰∫ã */}
                                        <div>
                                            {/* „Éà„ÉÉ„Éó5Ë®ò‰∫ãÔºà„Ç´„É´„Éº„Çª„É´Ôºâ */}
                                            <div className="mb-6">
                                                <h3 className="text-lg font-semibold text-gray-900 mb-3 mx-4">Ê≥®ÁõÆË®ò‰∫ã</h3>
                                                <div className="flex gap-4 overflow-x-auto pb-4 scrollbar-hide pl-4">
                                                    {getMapFilteredArticles().slice(0, 5).map((article, index) => (
                                                        <div
                                                            key={index}
                                                            className={`flex-shrink-0 w-72 bg-white rounded-lg border border-gray-200 overflow-hidden hover:shadow-lg transition-shadow cursor-pointer ${index === 4 ? 'mr-4' : ''}`}
                                                            onClick={(e) => {
                                                                console.log('„Ç´„É´„Éº„Çª„É´Ë®ò‰∫ã„ÇØ„É™„ÉÉ„ÇØ:', article.title);
                                                                handleArticleRead(article, e);
                                                            }}
                                                        >
                                                            <div className="aspect-video bg-gray-200 relative">
                                                                <img 
                                                                    src="https://s.yimg.jp/images/ksk/tool/img/photo01.png"
                                                                    alt={article.title}
                                                                    className="w-full h-full object-cover"
                                                                />
                                                                <div className="absolute top-2 right-2 bg-black/70 text-white px-2 py-1 rounded text-xs">
                                                                    #{index + 1}
                                                                </div>
                                                            </div>
                                                            <div className="p-4">
                                                                <h3 className="font-semibold text-gray-900 mb-2 line-clamp-2">
                                                                    {article.title}
                                                                </h3>
                                                                <p className="text-sm text-gray-600 mb-3 line-clamp-2">
                                                                    {article.snippet}
                                                                </p>
                                                                <div className="flex items-center justify-between text-xs text-gray-400">
                                                                    <span>{article.source}</span>
                                                                    <span>Ë©±È°åÂ∫¶: {Math.round(article.topicalityScore)}</span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>

                                            {/* ÊÆã„Çä„ÅÆË®ò‰∫ãÔºà„É™„Çπ„ÉàÔºâ */}
                                            {getMapFilteredArticles().length > 5 && (
                                                <div className="mx-4">
                                                    <h3 className="text-lg font-semibold text-gray-900 mb-3">„Åù„ÅÆ‰ªñ„ÅÆË®ò‰∫ã</h3>
                                                    <div className="space-y-3">
                                                        {getMapFilteredArticles().slice(5).map((article, index) => (
                                                            <div
                                                                key={index + 5}
                                                                className="bg-white rounded-lg border border-gray-200 p-4 hover:shadow-md transition-shadow cursor-pointer"
                                                                onClick={(e) => {
                                                                    console.log('„É™„Çπ„ÉàË®ò‰∫ã„ÇØ„É™„ÉÉ„ÇØ:', article.title);
                                                                    handleArticleRead(article, e);
                                                                }}
                                                            >
                                                                <div className="flex gap-4">
                                                                    <div className="w-20 h-20 bg-gray-200 rounded-lg overflow-hidden flex-shrink-0">
                                                                        <img 
                                                                            src="https://s.yimg.jp/images/ksk/tool/img/photo01.png"
                                                                            alt={article.title}
                                                                            className="w-full h-full object-cover"
                                                                        />
                                                                    </div>
                                                                    <div className="flex-1 min-w-0">
                                                                        <div className="flex items-start justify-between mb-2">
                                                                            <h4 className="font-medium text-gray-900 line-clamp-2 flex-1">
                                                                                {article.title}
                                                                            </h4>
                                                                        </div>
                                                                        <p className="text-sm text-gray-600 mb-2 line-clamp-1">
                                                                            {article.snippet}
                                                                        </p>
                                                                        <div className="flex items-center justify-between text-xs text-gray-400">
                                                                            <span>{article.source}</span>
                                                                            <span>Ë©±È°åÂ∫¶: {Math.round(article.topicalityScore)}</span>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    </>
                                ) : (
                                    /* „Çø„Ç∞Êú™ÈÅ∏ÊäûÊôÇ„ÅÆË°®Á§∫ */
                                    <div className="text-center py-16 mx-4">
                                        <div className="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                            <svg width="32" height="26" viewBox="0 0 22 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path fillRule="evenodd" clipRule="evenodd" d="M20.4119 1.54257C18.2944 -0.514191 14.8606 -0.514191 12.7426 1.54257L11.0003 3.23455L9.25744 1.54257C7.13997 -0.514191 3.70618 -0.514191 1.5881 1.54257C-0.529368 3.59754 -0.529368 6.93108 1.5881 8.98665L3.33158 10.6792L3.33097 10.6798L10.7834 17.9127C10.9025 18.0291 11.0975 18.0291 11.2172 17.9127L11.8528 17.2953C11.8534 17.2953 11.8534 17.2953 11.8534 17.2947L18.669 10.6798L18.6684 10.6792L20.4119 8.98665C22.5294 6.93108 22.5294 3.59754 20.4119 1.54257Z" fill="#d1d5db"/>
                                            </svg>
                                        </div>
                                        <h3 className="text-lg font-medium text-gray-900 mb-2">„Çø„Ç∞„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</h3>
                                        <p className="text-gray-600 mb-6">„Éû„ÉÉ„Éó„Åß„Çø„Ç∞„ÇíÈÅ∏Êäû„Åô„Çã„Å®„ÄÅÈñ¢ÈÄ£Ë®ò‰∫ã„ÅÆÈõÜÁ¥Ñ„É¨„Éù„Éº„Éà„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô</p>
                                        <button
                                            onClick={() => {
                                                setShowFavorites(false);
                                                setCurrentView('map');
                                            }}
                                            className="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-colors"
                                        >
                                            „Éû„ÉÉ„Éó„Å´Êàª„Çã
                                        </button>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}

                    <main className="max-w-6xl mx-auto p-4 relative z-10 pb-20">
                        {/* „Éû„ÉÉ„Éó„Éì„É•„ÉºÔºöÂÖ®ÁîªÈù¢„É¨„Ç§„Ç¢„Ç¶„Éà */}
                        {currentView === 'map' && (
                            <div className="fixed inset-0 top-0 bg-gray-50">
                                {/* „Éû„ÉÉ„Éó„Ç®„É™„Ç¢Ôºà‰∏äÂçäÂàÜÔºâ */}
                                <div 
                                    className="relative"
                                    style={{ height: `${100 - mapArticleAreaHeight}vh` }}
                                >
                                    
                                    <div 
                                        id="map-container" 
                                        className="w-full h-full bg-gray-900 relative"
                                    >
                                        <svg 
                                            id="mapSvg" 
                                            className="w-full h-full network-bg"
                                        ></svg>
                                        

                                        {/* „Éê„É©„É≥„Çπ„Éê„Éº („Éû„ÉÉ„Éó‰∏ãÈÉ®) */}
                                        <div className="absolute bottom-2 left-6 right-6 z-10">
                                            <div className="flex items-center gap-3">
                                                <input
                                                    type="range"
                                                    min="0"
                                                    max="100"
                                                    value={interestDepth}
                                                    onChange={(e) => setInterestDepth(Number(e.target.value))}
                                                    className="flex-1 h-2 bg-gray-300 rounded-full appearance-none cursor-pointer slider-thumb balance-bar-bg"
                                                />
                                                <button
                                                    onClick={() => setShowBalanceInfo(!showBalanceInfo)}
                                                    className="w-8 h-8 bg-black text-white rounded-full flex items-center justify-center hover:bg-gray-800 transition-colors border-2 border-white/30 hover:border-white/50"
                                                >
                                                    <span className="text-sm font-bold">!</span>
                                                </button>
                                            </div>
                                            
                                            {/* ÊÉÖÂ†±„Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó */}
                                            {showBalanceInfo && (
                                                <div className="absolute bottom-12 right-0 bg-black text-white p-4 rounded-lg shadow-lg w-80 text-sm">
                                                    <div className="mb-3">
                                                        {(() => {
                                                            const depthInfo = getDepthInfo(interestDepth);
                                                            return (
                                                                <>
                                                                    <div className="font-semibold text-lg mb-2">{depthInfo.label} ({interestDepth}%)</div>
                                                                    <div className="text-gray-300">{depthInfo.description}</div>
                                                                </>
                                                            );
                                                        })()}
                                                    </div>
                                                    
                                                    <div className="space-y-2 text-xs">
                                                        <div className="flex items-center gap-2">
                                                            <span>üíú</span>
                                                            <span className="text-purple-300">0-30%: ÁßÅÁöÑËààÂë≥</span>
                                                        </div>
                                                        <div className="flex items-center gap-2">
                                                            <span>üíô</span>
                                                            <span className="text-blue-300">30-70%: „Éê„É©„É≥„Çπ</span>
                                                        </div>
                                                        <div className="flex items-center gap-2">
                                                            <span>üíö</span>
                                                            <span className="text-green-300">70-100%: „Éë„Éº„ÇΩ„Éä„É´</span>
                                                        </div>
                                                    </div>
                                                    
                                                    <button
                                                        onClick={() => setShowBalanceInfo(false)}
                                                        className="absolute top-2 right-2 w-6 h-6 bg-gray-600 hover:bg-gray-500 rounded-full flex items-center justify-center text-xs"
                                                    >
                                                        √ó
                                                    </button>
                                                </div>
                                            )}
                                        </div>

                                    </div>
                                </div>

                                {/* Ë®ò‰∫ã„Ç®„É™„Ç¢Ôºà‰∏ãÂçäÂàÜÔºâ */}
                                <div 
                                    className="relative bg-white border-t-2 border-gray-200"
                                    style={{ 
                                        height: `${mapArticleAreaHeight}vh`,
                                        transition: isDragging ? 'none' : 'height 0.3s ease'
                                    }}
                                >
                                    {/* „Éâ„É©„ÉÉ„Ç∞„Éè„É≥„Éâ„É´ */}
                                    <div 
                                        className="absolute top-0 left-0 right-0 h-6 flex items-center justify-center cursor-grab active:cursor-grabbing bg-gray-100 hover:bg-gray-200 transition-colors z-10"
                                        onMouseDown={(e) => {
                                            setIsDragging(true);
                                            const startY = e.clientY;
                                            const startHeight = mapArticleAreaHeight;

                                            const handleMouseMove = (e) => {
                                                const deltaY = startY - e.clientY;
                                                const newHeight = Math.min(Math.max(20, startHeight + (deltaY / window.innerHeight) * 100), 80);
                                                setMapArticleAreaHeight(newHeight);
                                            };

                                            const handleMouseUp = () => {
                                                setIsDragging(false);
                                                document.removeEventListener('mousemove', handleMouseMove);
                                                document.removeEventListener('mouseup', handleMouseUp);
                                            };

                                            document.addEventListener('mousemove', handleMouseMove);
                                            document.addEventListener('mouseup', handleMouseUp);
                                        }}
                                        onTouchStart={(e) => {
                                            setIsDragging(true);
                                            const startY = e.touches[0].clientY;
                                            const startHeight = mapArticleAreaHeight;

                                            const handleTouchMove = (e) => {
                                                const deltaY = startY - e.touches[0].clientY;
                                                const newHeight = Math.min(Math.max(20, startHeight + (deltaY / window.innerHeight) * 100), 80);
                                                setMapArticleAreaHeight(newHeight);
                                            };

                                            const handleTouchEnd = () => {
                                                setIsDragging(false);
                                                document.removeEventListener('touchmove', handleTouchMove);
                                                document.removeEventListener('touchend', handleTouchEnd);
                                            };

                                            document.addEventListener('touchmove', handleTouchMove);
                                            document.addEventListener('touchend', handleTouchEnd);
                                        }}
                                    >
                                        <div className="w-12 h-1 bg-gray-300 rounded-full"></div>
                                    </div>

                                    {/* „Éì„É•„ÉºÂàá„ÇäÊõø„Åà„Éú„Çø„É≥ÔºàÂè≥Á´ØÂõ∫ÂÆöÔºâ */}
                                    <div className="absolute top-0 right-4 z-20 flex bg-gray-100 rounded-lg p-1 shadow-lg">
                                        <button
                                            onClick={() => setMapViewMode('grid')}
                                            className={`p-1.5 rounded transition-all ${
                                                mapViewMode === 'grid' 
                                                ? 'bg-white text-gray-900 shadow-sm' 
                                                : 'text-gray-500 hover:text-gray-700'
                                            }`}
                                        >
                                            <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <rect x="1" y="1" width="5" height="5" rx="1" fill="currentColor"/>
                                                <rect x="8" y="1" width="5" height="5" rx="1" fill="currentColor"/>
                                                <rect x="1" y="8" width="5" height="5" rx="1" fill="currentColor"/>
                                                <rect x="8" y="8" width="5" height="5" rx="1" fill="currentColor"/>
                                            </svg>
                                        </button>
                                        <button
                                            onClick={() => setMapViewMode('list')}
                                            className={`p-1.5 rounded transition-all ${
                                                mapViewMode === 'list' 
                                                ? 'bg-white text-gray-900 shadow-sm' 
                                                : 'text-gray-500 hover:text-gray-700'
                                            }`}
                                        >
                                            <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <rect x="1" y="2" width="12" height="1.5" rx="0.75" fill="currentColor"/>
                                                <rect x="1" y="6" width="12" height="1.5" rx="0.75" fill="currentColor"/>
                                                <rect x="1" y="10" width="12" height="1.5" rx="0.75" fill="currentColor"/>
                                            </svg>
                                        </button>
                                        <button
                                            onClick={() => {
                                                console.log('ÈõÜÁ¥Ñ„Éú„Çø„É≥„ÇØ„É™„ÉÉ„ÇØ: „Éû„ÉÉ„Éó„Éì„É•„Éº„Åã„Çâ');
                                                setPreviousView('main'); // „Éû„ÉÉ„Éó„Éì„É•„Éº„Åã„ÇâÊù•„Åü„Åì„Å®„ÇíË®òÈå≤
                                                setShowFavorites(true);
                                            }}
                                            className="p-1.5 rounded transition-all text-gray-500 hover:text-blue-600"
                                            title="„ÅäÊ∞ó„Å´ÂÖ•„ÇäÈõÜÁ¥Ñ"
                                        >
                                            <svg width="16" height="17" viewBox="0 0 302 318" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M200.186 58.1534C199.13 58.0267 198.571 56.8128 199.194 55.9578L223.25 22.4859C227.198 17.0075 226.586 9.48138 221.815 4.71024C216.611 -0.49368 208.229 -0.694237 202.793 4.26691L148.041 54.1633C147.524 54.6383 146.722 54.6489 146.194 54.1739L105.819 18.1053C100.277 13.1547 91.8326 13.387 86.5864 18.6437C81.8153 23.4042 81.1186 30.8882 84.9292 36.451L98.641 56.4961C99.2321 57.3511 98.6832 58.5228 97.6593 58.66C33.4389 67.1995 0.420898 96.6603 0.420898 176.313C0.420898 260.536 37.3234 288.646 108.996 295.254C112.437 295.57 115.889 295.697 119.341 295.644C120.238 295.634 120.924 296.457 120.734 297.333L117.831 310.813C117.092 314.961 121.082 318.392 125.083 317.041L235.642 287.231C236.666 286.915 237.669 286.566 238.672 286.229L238.841 286.165C280.303 271.736 301.499 240.132 301.499 176.313C301.499 94.9819 267.098 65.9856 200.186 58.1534ZM255.709 222.483C252.183 231.329 247.327 237.715 240.403 242.571C224.802 253.538 196.375 258.647 150.955 258.647C105.534 258.647 77.1181 253.538 61.5168 242.571C54.6029 237.715 49.7368 231.318 46.2112 222.483C41.6828 211.125 39.3817 195.588 39.3817 176.313C39.3817 157.038 41.6828 141.511 46.2112 130.153C49.7368 121.308 54.5924 114.921 61.5168 110.066C77.1181 99.0881 105.544 93.9897 150.955 93.9897C196.365 93.9897 224.791 99.0881 240.403 110.066C247.317 114.921 252.183 121.308 255.709 130.153C260.237 141.511 262.538 157.038 262.538 176.313C262.538 195.588 260.237 211.125 255.709 222.483Z" fill="currentColor"/>
                                                <path d="M110.971 146.142C94.6836 146.142 91.2002 161.046 91.2002 176.32C91.2002 191.594 94.6836 206.499 110.971 206.499C127.258 206.499 130.742 191.594 130.742 176.32C130.742 161.046 127.258 146.142 110.971 146.142Z" fill="currentColor"/>
                                                <path d="M190.95 146.142C174.663 146.142 171.18 161.047 171.18 176.321C171.18 191.595 174.663 206.499 190.95 206.499C207.238 206.499 210.732 191.595 210.732 176.321C210.732 161.047 207.248 146.142 190.95 146.142Z" fill="currentColor"/>
                                            </svg>
                                        </button>
                                    </div>

                                    {/* Ë®ò‰∫ã„Ç≥„É≥„ÉÜ„É≥„ÉÑ */}
                                    <div className="pt-11 pb-4 px-4 h-full overflow-y-auto">
                                        {/* „Éï„Ç£„É´„Çø„Éò„ÉÉ„ÉÄ„Éº */}
                                        <div className="mb-3">
                                            {/* „Éï„Ç£„É´„ÇøË°®Á§∫ÔºàÊ®™„Çπ„ÇØ„É≠„Éº„É´1Ë°åÔºâ */}
                                            {selectedTags.length > 0 && (
                                                <div className="flex items-center gap-2 text-sm text-gray-500 overflow-x-auto scrollbar-hide">
                                                    <div className="flex gap-2 flex-nowrap">
                                                        {selectedTags.map(tag => (
                                                            <button
                                                                key={tag}
                                                                onClick={() => {
                                                                    const newTags = selectedTags.filter(t => t !== tag);
                                                                    setSelectedTags(newTags);
                                                                }}
                                                                className="px-2 py-1 bg-blue-100 hover:bg-blue-200 text-blue-600 rounded-full text-xs whitespace-nowrap flex-shrink-0 transition-colors cursor-pointer flex items-center gap-1"
                                                                title={`${tag}„ÇíÂâäÈô§`}
                                                            >
                                                                {tag}
                                                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                                                                    <path d="M18 6L6 18M6 6l12 12"/>
                                                                </svg>
                                                            </button>
                                                        ))}
                                                        <button
                                                            onClick={() => setSelectedTags([])}
                                                            className="text-blue-600 hover:text-blue-800 text-xs whitespace-nowrap flex-shrink-0"
                                                        >
                                                            „ÇØ„É™„Ç¢
                                                        </button>
                                                    </div>
                                                </div>
                                            )}
                                        </div>

                                        {/* Ë®ò‰∫ã‰∏ÄË¶ß */}
                                        {mapViewMode === 'list' && (
                                            <div className="grid gap-3">
                                            {getMapFilteredArticles().map((article, index) => {
                                                const matchingTags = article.tags.filter(tag => selectedTags.includes(tag));
                                                return (
                                                    <div
                                                        key={index}
                                                        className={`bg-white rounded-lg p-3 shadow-sm border hover:shadow-md transition-all cursor-pointer ${
                                                            matchingTags.length > 0 ? 'ring-2 ring-blue-200 bg-blue-50/30' : ''
                                                        }`}
                                                        onClick={(e) => handleArticleRead(article, e)}
                                                    >
                                                        <div className="flex gap-3">
                                                            <div className="w-12 h-12 bg-gradient-to-br from-blue-100 to-blue-200 rounded-lg overflow-hidden flex-shrink-0 relative">
                                                                <img 
                                                                    src="https://s.yimg.jp/images/ksk/tool/img/photo01.png" 
                                                                    alt={article.title}
                                                                    className="w-full h-full object-cover hover:scale-105 transition-transform duration-300"
                                                                />
                                                                {/* Ë©±È°åÂ∫¶„Ç§„É≥„Ç∏„Ç±„Éº„Çø„Éº */}
                                                                <div className={`absolute top-0.5 right-0.5 text-white px-1 py-0.5 rounded text-xs-small ${
                                                                    article.topicalityScore >= 80 ? 'bg-red-500' : 
                                                                    article.topicalityScore >= 60 ? 'bg-orange-500' : 
                                                                    article.topicalityScore >= 40 ? 'bg-yellow-600' : 'bg-gray-500/70'
                                                                }`}>
                                                                    {Math.round(article.topicalityScore)}
                                                                </div>
                                                            </div>
                                                            
                                                            <div className="flex-1 min-w-0">
                                                                <div className="flex justify-between items-start mb-1">
                                                                    <h4 className="font-medium text-gray-900 text-sm line-clamp-2 flex-1">{article.title}</h4>
                                                                    {/* „ÅäÊ∞ó„Å´ÂÖ•„Çä„Éú„Çø„É≥ */}
                                                                    <button
                                                                        onClick={(e) => {
                                                                            e.stopPropagation();
                                                                            toggleFavorites({
                                                                                title: `Ë®ò‰∫ã: ${article.title}`,
                                                                                type: 'article',
                                                                                tags: article.tags,
                                                                                articleCount: 1,
                                                                                articleData: article
                                                                            }, e);
                                                                        }}
                                                                        className={`ml-2 flex-shrink-0 ${
                                                                            isFavorite({
                                                                                title: `Ë®ò‰∫ã: ${article.title}`,
                                                                                type: 'article',
                                                                                tags: article.tags
                                                                            }) ? 'text-blue-600' : 'text-gray-400 hover:text-gray-600'
                                                                        } transition-colors`}
                                                                        title={isFavorite({
                                                                            title: `Ë®ò‰∫ã: ${article.title}`,
                                                                            type: 'article',
                                                                            tags: article.tags
                                                                        }) ? "„ÅäÊ∞ó„Å´ÂÖ•„Çä„Åã„ÇâÂâäÈô§" : "„ÅäÊ∞ó„Å´ÂÖ•„Çä„Å´ËøΩÂä†"}
                                                                    >
                                                                        <svg width="14" height="14" viewBox="0 0 24 24" fill={isFavorite({
                                                                            title: `Ë®ò‰∫ã: ${article.title}`,
                                                                            type: 'article',
                                                                            tags: article.tags
                                                                        }) ? "currentColor" : "none"} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                                                            <polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26"/>
                                                                        </svg>
                                                                    </button>
                                                                </div>
                                                                <p className="text-xs text-gray-600 mb-2 line-clamp-2">{article.snippet}</p>
                                                                <div className="flex items-center justify-between">
                                                                    <span className="text-xs text-gray-400">{article.source}</span>
                                                                    <div className="flex gap-1">
                                                                        {article.tags.slice(0, 2).map(tag => (
                                                                            <span
                                                                                key={tag}
                                                                                className={`px-1.5 py-0.5 text-xs rounded-full ${
                                                                                    selectedTags.includes(tag) 
                                                                                        ? 'bg-yellow-200 text-yellow-800 font-medium'
                                                                                        : 'bg-gray-100 text-gray-600'
                                                                                }`}
                                                                            >
                                                                                {tag}
                                                                            </span>
                                                                        ))}
                                                                        {article.tags.length > 2 && (
                                                                            <span className="px-1.5 py-0.5 bg-gray-100 text-gray-500 text-xs rounded-full">
                                                                                +{article.tags.length - 2}
                                                                            </span>
                                                                        )}
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                            </div>
                                        )}
                                        
                                        {/* „Ç∞„É™„ÉÉ„Éâ„Éì„É•„ÉºÔºàÊ≠£ÊñπÂΩ¢Âõ∫ÂÆöÔºâ */}
                                        {mapViewMode === 'grid' && (
                                            <div className="grid gap-1 w-full overflow-hidden -mx-1 article-grid">
                                                {getMapFilteredArticles().map((article, index) => {
                                                    const matchingTags = article.tags.filter(tag => selectedTags.includes(tag));
                                                    
                                                    return (
                                                        <div
                                                            key={index}
                                                            className={`relative overflow-hidden cursor-pointer group aspect-square ${
                                                                matchingTags.length > 0 ? 'ring-2 ring-yellow-300' : ''
                                                            }`}
                                                            style={article.staticGridSize}
                                                            onClick={(e) => handleArticleRead(article, e)}
                                                        >
                                                            <img 
                                                                src="https://s.yimg.jp/images/ksk/tool/img/photo01.png" 
                                                                alt={article.title}
                                                                className="w-full h-full object-cover group-hover:scale-110 transition-transform duration-300"
                                                            />
                                                            
                                                            {/* „Ç™„Éº„Éê„Éº„É¨„Ç§ - Â§ß„Åç„Å™„Ç¢„Ç§„ÉÜ„É†„ÅØÂ∏∏ÊôÇË°®Á§∫„ÄÅÂ∞è„Åï„Å™„Ç¢„Ç§„ÉÜ„É†„ÅØ„Éõ„Éê„ÉºÊôÇ„ÅÆ„Åø */}
                                                            <div className={`absolute inset-0 bg-gradient-to-t from-black/70 via-transparent to-transparent transition-opacity duration-300 ${
                                                                article.topicalityScore >= 60 
                                                                ? 'opacity-100' 
                                                                : 'opacity-0 group-hover:opacity-100'
                                                            }`}>
                                                                <div className="absolute bottom-0 left-0 right-0 p-2">
                                                                    <h4 className="text-white font-medium text-xs line-clamp-2 mb-1">
                                                                        {article.title}
                                                                    </h4>
                                                                    <div className="text-white/80 text-xs">
                                                                        Ë©±È°åÂ∫¶: {Math.round(article.topicalityScore)}
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            
                                                            {/* „Éû„ÉÉ„ÉÅ„É≥„Ç∞Êï∞„Ç§„É≥„Ç∏„Ç±„Éº„Çø„Éº */}
                                                            {matchingTags.length > 0 && (
                                                                <div className="absolute top-2 left-2 bg-yellow-500 text-black text-xs px-1.5 py-0.5 rounded-full font-medium">
                                                                    {matchingTags.length}
                                                                </div>
                                                            )}
                                                            
                                                            {/* Ë©±È°åÂ∫¶„Ç§„É≥„Ç∏„Ç±„Éº„Çø„Éº */}
                                                            <div className={`absolute top-2 right-2 text-white text-xs px-1.5 py-0.5 rounded-full ${
                                                                article.topicalityScore >= 80 ? 'bg-red-500' : 
                                                                article.topicalityScore >= 60 ? 'bg-orange-500' : 
                                                                article.topicalityScore >= 40 ? 'bg-yellow-600' : 'bg-gray-500/70'
                                                            }`}>
                                                                {Math.round(article.topicalityScore)}
                                                            </div>
                                                            
                                                            {/* HOT„Éê„ÉÉ„Ç∏ */}
                                                            {article.topicalityScore >= 80 && (
                                                                <div className="absolute bottom-2 left-2 bg-red-500 text-white text-xs px-1.5 py-0.5 rounded-full font-bold">
                                                                    HOT
                                                                </div>
                                                            )}
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        )}

                                        {getMapFilteredArticles().length === 0 && (
                                            <div className="text-center py-8 text-gray-500">
                                                <div className="text-4xl mb-2">üì∞</div>
                                                <p className="text-sm">Èñ¢ÈÄ£Ë®ò‰∫ã„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì</p>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>

                    {/* ‰∏ãÈÉ®„É°„Éã„É•„Éº„Éê„Éº */}
                    <nav className="fixed bottom-0 left-0 right-0 bg-white/20 backdrop-blur-sm border-t border-gray-200/30 shadow-lg z-50">
                        <div className="flex items-center justify-between px-4 py-2">
                            {/* Â∑¶ÂØÑ„Åõ: „Éõ„Éº„É†„Éú„Çø„É≥ÔºàÂ∞ÜÊù•ÁöÑ„Å´Âà•ÁîªÈù¢ÈÅ∑ÁßªÁî®Ôºâ */}
                            <button
                                onClick={() => {
                                    // Â∞ÜÊù•ÁöÑ„Å´„Éõ„Éº„É†ÁîªÈù¢„ÇÑÂà•„ÅÆÁîªÈù¢„Å´ÈÅ∑Áßª‰∫àÂÆö
                                    console.log('„Éõ„Éº„É†„Éú„Çø„É≥„Åå„ÇØ„É™„ÉÉ„ÇØ„Åï„Çå„Åæ„Åó„Åü');
                                }}
                                className="w-10 h-10 rounded-full flex items-center justify-center transition-all bg-gray-100 text-gray-600 hover:bg-gray-200"
                            >
                                <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path fillRule="evenodd" clipRule="evenodd" d="M17.3892 7.44191L10.4827 0.60791C9.66124 -0.20459 8.33874 -0.20459 7.51724 0.60791L0.614244 7.43891C0.221244 7.82741 0.000244141 8.35791 0.000244141 8.91091V16.9999C0.000244141 17.5524 0.447744 17.9999 1.00024 17.9999H7.00024V12.2499C7.00024 12.1119 7.11174 11.9999 7.25024 11.9999H10.7502C10.8882 11.9999 11.0002 12.1119 11.0002 12.2499V17.9999H17.0002C17.5522 17.9999 18.0002 17.5524 18.0002 16.9999V8.90591C18.0002 8.35591 17.7797 7.82891 17.3892 7.44191" fill="black" fillOpacity="0.73"/>
                                </svg>
                            </button>
                            
                            {/* Âè≥ÂØÑ„Åõ: „Ç´„É°„É©„ÉªÈü≥Â£∞„Éª„Éû„ÉÉ„Éó„Éú„Çø„É≥„Ç≥„É≥„ÉÜ„Éä */}
                            <div className="flex items-center bg-gray-100 rounded-full px-1">
                                {/* „Ç´„É°„É©„Éú„Çø„É≥ */}
                                <button
                                    onClick={() => setShowCameraMenu(!showCameraMenu)}
                                    className="w-10 h-10 rounded-full bg-white flex items-center justify-center text-gray-700 hover:bg-gray-50 transition-all mx-0.5"
                                >
                                    <svg width="18" height="16" viewBox="0 0 18 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path fillRule="evenodd" clipRule="evenodd" d="M15.5 6C14.948 6 14.5 5.5525 14.5 4.999C14.5 4.4475 14.948 4 15.5 4C16.052 4 16.5 4.4475 16.5 4.999C16.5 5.5525 16.052 6 15.5 6M9 13.5C6.515 13.5 4.5 11.483 4.5 9C4.5 6.5165 6.515 4.5 9 4.5C11.483 4.5 13.5 6.5165 13.5 9C13.5 11.483 11.483 13.5 9 13.5M16 2H13.5L11.793 0.293C11.6055 0.1055 11.351 0 11.0855 0H6.9145C6.649 0 6.3945 0.1055 6.207 0.293L4.5 2H2C0.9 2 0 2.9 0 4V14C0 15.1 0.9 16 2 16H16C17.1 16 18 15.1 18 14V4C18 2.9 17.1 2 16 2M9 6.30005C7.511 6.30005 6.3 7.51105 6.3 9.00005C6.3 10.4886 7.511 11.7001 9 11.7001C10.489 11.7001 11.7 10.4886 11.7 9.00005C11.7 7.51105 10.489 6.30005 9 6.30005" fill="black" fillOpacity="0.73"/>
                                    </svg>
                                </button>
                                
                                {/* Èü≥Â£∞„Éú„Çø„É≥ */}
                                <button
                                    onClick={() => setShowVoiceMenu(!showVoiceMenu)}
                                    className="w-10 h-10 rounded-full bg-white flex items-center justify-center text-gray-700 hover:bg-gray-50 transition-all mx-0.5"
                                >
                                    <svg width="12" height="20" viewBox="0 0 12 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M1.5 9.5V10.5C1.5 12.9815 3.519 15 6 15C8.481 15 10.5 12.9815 10.5 10.5V9.5H12V10.5C12 13.4675 9.83297 15.9312 7 16.4092V18H8.75C9.1645 18 9.5 18.3355 9.5 18.75C9.5 19.1645 9.1645 19.5 8.75 19.5H3.25C2.8355 19.5 2.5 19.1645 2.5 18.75C2.5 18.3355 2.8355 18 3.25 18H5V16.4092C2.16703 15.9312 0 13.4675 0 10.5V9.5H1.5ZM6 0.5C7.6565 0.5 9 1.8435 9 3.5V10.5C9 12.1565 7.6565 13.5 6 13.5C4.3435 13.5 3 12.1565 3 10.5V3.5C3 1.8435 4.3435 0.5 6 0.5Z" fill="black" fillOpacity="0.73"/>
                                    </svg>
                                </button>
                                
                                {/* „ÅäÊ∞ó„Å´ÂÖ•„Çä„É™„Çπ„Éà„Éú„Çø„É≥ */}
                                <button
                                    onClick={() => {
                                        try {
                                            console.log('„ÅäÊ∞ó„Å´ÂÖ•„Çä„Éú„Çø„É≥„ÇØ„É™„ÉÉ„ÇØ„ÄÅÁèæÂú®„ÅÆ„Éì„É•„Éº:', currentView);
                                            console.log('„ÅäÊ∞ó„Å´ÂÖ•„Çä„É¨„Éù„Éº„ÉàÊï∞:', favoriteReports.length);
                                            if (currentView === 'favorites') {
                                                setCurrentView('map');
                                            } else {
                                                setCurrentView('favorites');
                                            }
                                        } catch (error) {
                                            console.error('„ÅäÊ∞ó„Å´ÂÖ•„Çä„Éö„Éº„Ç∏Ë°®Á§∫„Ç®„É©„Éº:', error);
                                        }
                                    }}
                                    className="w-10 h-10 rounded-full bg-white flex items-center justify-center text-gray-700 hover:bg-gray-50 transition-all mx-0.5 relative"
                                    title="„ÅäÊ∞ó„Å´ÂÖ•„Çä„É™„Çπ„Éà"
                                >
                                    <svg width="16" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                        <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/>
                                    </svg>
                                    {favoriteReports.length > 0 && (
                                        <div className="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">
                                            {favoriteReports.length}
                                        </div>
                                    )}
                                </button>
                            </div>
                        </div>
                        
                        {/* „Ç´„É°„É©„É°„Éã„É•„Éº */}
                        {showCameraMenu && (
                            <div className="absolute bottom-20 right-4 bg-white rounded-lg shadow-xl border p-4 w-48">
                                <div className="text-sm font-medium text-gray-900 mb-3">„Ç´„É°„É©Ê©üËÉΩ</div>
                                <div className="space-y-2">
                                    <button className="w-full text-left px-3 py-2 text-sm text-gray-600 hover:bg-gray-50 rounded">
                                        üîç ÁîªÂÉèÊ§úÁ¥¢
                                    </button>
                                </div>
                                <button
                                    onClick={() => setShowCameraMenu(false)}
                                    className="absolute top-2 right-2 w-6 h-6 bg-gray-100 hover:bg-gray-200 rounded-full flex items-center justify-center text-xs"
                                >
                                    √ó
                                </button>
                            </div>
                        )}
                        
                        {/* Èü≥Â£∞„É°„Éã„É•„Éº */}
                        {showVoiceMenu && (
                            <div className="absolute bottom-20 right-4 bg-white rounded-lg shadow-xl border p-4 w-48">
                                <div className="text-sm font-medium text-gray-900 mb-3">Èü≥Â£∞Ê©üËÉΩ</div>
                                <div className="space-y-2">
                                    <button className="w-full text-left px-3 py-2 text-sm text-gray-600 hover:bg-gray-50 rounded">
                                        üó£Ô∏è Èü≥Â£∞Ê§úÁ¥¢
                                    </button>
                                </div>
                                <button
                                    onClick={() => setShowVoiceMenu(false)}
                                    className="absolute top-2 right-2 w-6 h-6 bg-gray-100 hover:bg-gray-200 rounded-full flex items-center justify-center text-xs"
                                >
                                    √ó
                                </button>
                            </div>
                        )}
                        
                    </nav>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>